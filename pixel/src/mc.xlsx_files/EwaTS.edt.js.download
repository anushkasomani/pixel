'use strict';(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[3],{1044:function(y,m,a){a.r(m);a.d(m,"RelativeAndAbsoluteReferencesManager",function(){return D});y=a(0);var c=a(2),b=a(15);class e{}Object(y.a)(e,"Reference",null,[]);class k extends e{constructor(){super();this.column=this.row=null}}Object(y.a)(k,"CellReference",e,[]);class d{constructor(){this.end=this.start=0;this.OA=null}CJh(G,Q){for(let O=0;O<this.OA.length;O++){const J=this.Woc(G,this.OA[O]);Q+=J;O<this.OA.length-
1&&(Q+=":")}return Q}}Object(y.a)(d,"IReferenceSequence",null,[]);var u=a(27),n=a(1020);class v extends d{constructor(){super();this.WLa=!1}vCc(){const {RelativeAndAbsoluteReferencesManager:G}=a(1044),Q=this.OA[0];return G.Yfg(Q.row.kind===n.a.abs,Q.column.kind===n.a.abs)}Woc(G,Q){Q=u.Range.yi(Q.row.index+1,Q.column.index+1);return this.WLa?Q.wBc(1===G||3===G,1===G||2===G):Q.Qga(1===G||3===G,1===G||2===G,!0,!0)}}Object(y.a)(v,"CellReferenceSequence",d,[]);class f extends e{constructor(){super();this.secondColumn=
this.firstColumn=null}}Object(y.a)(f,"ColumnReference",e,[]);class w extends d{constructor(){super()}vCc(){const G=this.OA[0];return a(1044).RelativeAndAbsoluteReferencesManager.deg(G.firstColumn,G.secondColumn).kind===n.a.abs?2:3}Woc(G,Q){return u.Range.mY(Q.firstColumn.index+1,Q.secondColumn.index+1).Qga(1===G||3===G,!0,1===G||3===G,!0)}}Object(y.a)(w,"ColumnReferenceSequence",d,[]);class r extends e{constructor(){super();this.right=this.left=this.bottom=this.top=null}}Object(y.a)(r,"RangeReference",
e,[]);class t extends d{constructor(){super()}vCc(){const {RelativeAndAbsoluteReferencesManager:G}=a(1044),Q=this.OA[0];return G.Yfg(Q.top.kind===n.a.abs,Q.left.kind===n.a.abs)}Woc(G,Q){Q=new u.Range(Q.top.index+1,Q.left.index+1,Q.bottom.index+1,Q.right.index+1,!1,!1);const O=1===G||3===G;G=1===G||2===G;return Q.Qga(O,G,O,G)}}Object(y.a)(t,"RangeReferenceSequence",d,[]);class l extends e{constructor(){super();this.secondRow=this.firstRow=null}}Object(y.a)(l,"RowReference",e,[]);class x extends d{constructor(){super()}vCc(){const G=
this.OA[0];return a(1044).RelativeAndAbsoluteReferencesManager.deg(G.firstRow,G.secondRow).kind===n.a.abs?0:1}Woc(G,Q){return u.Range.$U(Q.firstRow.index+1,Q.secondRow.index+1).Qga(!0,1===G||2===G,!0,1===G||2===G)}}Object(y.a)(x,"RowReferenceSequence",d,[]);var A=a(1230),z=a(1105),F=a(163);class D{constructor(G){this.Mj=G}Sib(G,Q,O){let J,H;J=Q;H=O;if(!G||!F.f(G))return{returnValue:G,n8d:J,m8d:H};var N=this.Mj.nHd(G);if(!N)return b.ULS.sendTraceTag(524039641,0,15,"RelativeAndAbsoluteReferencesManager.CycleThroughRelativeAndAbsoluteReferences: Couldn't extract references (might be invalid formula)"),
{returnValue:null,n8d:J,m8d:H};N=this.vXi(N,G,Q,O);let L=0,Z="",ba=0,K=0;for(;K<N.length;K++)if(this.psf(N[K],Q,O)){L=N[K].vCc();J=N[K].start;break}for(;K<N.length&&this.psf(N[K],Q,O);K++)Z+=G.substring(ba,N[K].start),Z=N[K].CJh(L,Z),ba=N[K].end;ba&&(H=Z.length);Z+=G.substring(ba,G.length);return{returnValue:Z,n8d:J,m8d:H}}vXi(G,Q,O,J){const H=[];for(let ba=0;ba<G.length;ba++){var N=G[ba];if(N.kind===A.a.range)if(N=N.ref,N.type===z.a.cell){var L=N;N=Object(c.a)(new v,{start:N.span.start,end:N.span.end,
OA:[Object(c.a)(new k,{column:L.col,row:L.row})],WLa:this.Mj.hXa(N.span.end,Q)});H.push(N)}else if(N.type===z.a.range)this.qsf(N.topLeftSpan,O,J)&&this.qsf(N.bottomRightSpan,O,J)?(L=new r,N.top.index<=N.bottom.index?(L.top=N.top,L.bottom=N.bottom):(L.bottom=N.top,L.top=N.bottom),N.left.index<=N.right.index?(L.left=N.left,L.right=N.right):(L.right=N.left,L.left=N.right),N=Object(c.a)(new t,{start:N.topLeftSpan.start,end:N.bottomRightSpan.end,OA:[L]}),H.push(N)):(L=Object(c.a)(new v,{start:N.topLeftSpan.start,
end:N.topLeftSpan.end,OA:[Object(c.a)(new k,{column:N.left,row:N.top})],WLa:this.Mj.hXa(N.topLeftSpan.end,Q)}),N=Object(c.a)(new v,{start:N.bottomRightSpan.start,end:N.bottomRightSpan.end,OA:[Object(c.a)(new k,{column:N.right,row:N.bottom})],WLa:this.Mj.hXa(N.topLeftSpan.end,Q)}),H.push(L),H.push(N));else if(N.type===z.a.column){L=N;for(N=Object(c.a)(new w,{start:N.span.start,end:N.span.end,OA:[Object(c.a)(new f,{firstColumn:L.startIndex,secondColumn:L.endIndex})]});N.end<Q.length-1&&":"===Q.charAt(N.end)&&
ba<G.length-1;)if(L=G[ba+1].ref,L.type===z.a.column&&L.span.start===N.end+1){var Z=L;N.OA.push(Object(c.a)(new f,{firstColumn:Z.startIndex,secondColumn:Z.endIndex}));N.end=L.span.end;ba++}else break;H.push(N)}else if(N.type===z.a.row){L=N;for(N=Object(c.a)(new x,{start:N.span.start,end:N.span.end,OA:[Object(c.a)(new l,{firstRow:L.startIndex,secondRow:L.endIndex})]});N.end<Q.length-1&&":"===Q.charAt(N.end)&&ba<G.length-1;)if(L=G[ba+1].ref,L.type===z.a.row&&L.span.start===N.end+1)Z=L,N.OA.push(Object(c.a)(new l,
{firstRow:Z.startIndex,secondRow:Z.endIndex})),N.end=L.span.end,ba++;else break;H.push(N)}}return H}psf(G,Q,O){return!(G.start>O||Q>G.end)}qsf(G,Q,O){return!(G.start>O||Q>G.end)}static deg(G,Q){return G.index<=Q.index?G:Q}static Yfg(G,Q){return Q||G?Q&&G?2:!Q&&G?3:0:1}}Object(y.a)(D,"RelativeAndAbsoluteReferencesManager",null,[728])},1064:function(y,m,a){a.d(m,"h",function(){return u});a.d(m,"g",function(){return v});a.d(m,"f",function(){return f});a.d(m,"b",function(){return w});a.d(m,"c",function(){return r});
a.d(m,"e",function(){return t});a.d(m,"d",function(){return l});a.d(m,"a",function(){return A});y=a(0);var c=a(13),b=a(497),e=a(15),k=a(1412),d=a(28);const u=(D,G,Q,O)=>{const J={["flowId"]:D.flowId,["originFormulaFlowId"]:D.yZ.flowId,["formulaAnonymized"]:D.anonymizedFormula,["originalFormulaAnonymized"]:D.yZ.anonymizedFormula,["range"]:D.range,["failureReason"]:G,["isTableSuggestion"]:Object(k.b)(D)};e.ULS.sendTraceTag(221794372,306,20,`FormulaByExample suggestion display failure reported. Failure data ${JSON.stringify(J)}`);
Q&&Q.dw(D.flowId,O,{reason:G})};var n;(function(D){D.EXAMPLE="EXAMPLE";D.MODIFIEDEXAMPLE="MODIFIEDEXAMPLE";D.RESTOFRANGE="RESTOFRANGE";D.MODIFIEDRESTOFRANGE="MODIFIEDRESTOFRANGE"})(n||(n={}));Object(y.b)("suggestionCellType",n);const v=(D,G,Q,O,J,H,N,L,Z,ba)=>{D={["failureReason"]:D,["flowId"]:H.flowId,["cellType"]:N,["caller"]:J,["formulaAnonymized"]:H.anonymizedFormula,["originalCellText"]:d.a.g0(G),["evalFormulaText"]:d.a.g0(Q),["cellFormatIndex"]:O,["isOriginalValueMatchCellValue"]:L,["isTableSuggestion"]:Object(k.b)(H),
["originalNumFmt"]:Z?{["Start"]:d.a.g0(Z.Start),["Separator"]:d.a.g0(Z.Separator),["End"]:d.a.g0(Z.End)}:null,["evalNumFmt"]:ba?{["Start"]:d.a.g0(ba.Start),["Separator"]:d.a.g0(ba.Separator),["End"]:d.a.g0(ba.End)}:null};e.ULS.sendTraceTag(84165388,0,20,`FormulaByExample CloneEval mismatch failure reported. Failure data ${JSON.stringify(D)}`)},f=(D,G,Q)=>{try{const O=z(D,G,Q);window.performance.mark(O)}catch(O){e.ULS.sendTraceTag(529109767,0,10,`FormulaByExampleTelemetryGenerator.markPerformancePoint: Error thrown : ${O.message}`)}},
w=D=>{for(const G in x)try{window.performance.clearMarks(z(G,D,!1)),window.performance.clearMarks(z(G,D,!0))}catch(Q){e.ULS.sendTraceTag(527005662,0,10,`FormulaByExampleTelemetryGenerator.clearPerformanceFlowMarks: Error thrown : ${Q.message}`)}},r=D=>F(`FBE_flowCurrentDuration_${D}`,z(x.EditCommit,D,!1)),t=(D,G)=>{try{return{["EditCommitToSignal"]:F(`FBE_EditCommitToSignal_${G}_${D}`,z(x.EditCommit,G,!1),z(x.SignalSent,G,!1)),["WorkflowAndNetworkTime"]:D?0:F(`FBE_WorkflowAndNetworkTime_${G}_${D}`,
z(x.SignalSent,G,!1),z(x.AnnotationReceived,G,!1)),["Calculation"]:F(`FBE_Calculation_${G}_${D}`,z(x.CalculationStart,G,D),z(x.CalculationEnd,G,D)),["ModelUpdate"]:F(`FBE_ModelUpdate_${G}_${D}`,z(x.CalculationEnd,G,D),z(x.ModelUpdated,G,D)),["PreviewRender"]:F(`FBE_PreviewRendered_${G}_${D}`,z(x.ModelUpdated,G,D),z(x.PreviewRendered,G,D)),["Total"]:F(`FBE_Total_${G}_${D}`,z(x.EditCommit,G,!1),z(x.PreviewRendered,G,D))}}catch(Q){e.ULS.sendTraceTag(529109766,0,50,`FormulaByExampleTelemetryGenerator.getPreviewShownDurations: Error thrown : ${Q.message}`)}},
l=(D,G)=>{try{return{["UserInPreviewDuration"]:F(`FBE_InputToPreviewRemovedWithCSE_${G}_${D}`,z(x.PreviewRendered,G,D),z(x.UserInputArrived,G,D)),["InputToPreviewRemovedWithCSE"]:F(`FBE_InputToPreviewRemovedWithCSE_${G}_${D}`,z(x.UserInputArrived,G,D),z(x.PreviewRemovedWithCSE,G,D))}}catch(Q){e.ULS.sendTraceTag(529109765,0,10,`FormulaByExampleTelemetryGenerator.getPreviewRemovedDurations: Error thrown : ${Q.message}`)}};var x;(function(D){D.EditCommit="EDITCOMMIT";D.SignalSent="SIGNALSENT";D.AnnotationReceived=
"ANNOTATIONRECEIVED";D.CalculationStart="CALCULATIONSTART";D.CalculationEnd="CALCULATIONED";D.ModelUpdated="MODELUPDATED";D.PreviewRendered="PREVIEWRENDERED";D.UserInputArrived="USERINPUTARRIVED";D.PreviewRemovedWithCSE="PREVIEWREMOVEDWITHCSE"})(x||(x={}));Object(y.b)("FormulaByExampleFlowMarks",x);const A=D=>c.HelperMethods.uud&&b.a.HWa&&D.MLa(),z=(D,G,Q)=>`${D}_${G+(Q?"_cached":"")}`,F=(D,G,Q)=>{const O=window.performance.measure(D,G,Q);if(O)return G=O.duration,performance.clearMeasures(D),G;e.ULS.sendTraceTag(526984791,
0,15,`FormulaByExampleTelemetryGenerator.measureTime: could not find performance entry for measure: ${D}, startMark: ${G}, endMark: ${Q}`);return-1}},1089:function(y,m,a){a.d(m,"b",function(){return-1});a.d(m,"a",function(){return F});y=a(0);var c=a(15),b;(function(O){O[O.UserEditedInTable=0]="UserEditedInTable";O[O.FormulaByExampleNoTrigger=1]="FormulaByExampleNoTrigger";O[O.FlowInterrupted=2]="FlowInterrupted";O[O.FormulaByExampleFullTrigger=3]="FormulaByExampleFullTrigger";O[O.HadCachedSuggestion=
4]="HadCachedSuggestion";O[O.NoCachedSuggestion=5]="NoCachedSuggestion";O[O.PreCalcPreviewRejected=6]="PreCalcPreviewRejected";O[O.WaitingForCalcResult=7]="WaitingForCalcResult";O[O.PostCalcPreviewRejected=8]="PostCalcPreviewRejected";O[O.SuggestionDidntMatch=9]="SuggestionDidntMatch";O[O.SuggestionMatched=10]="SuggestionMatched";O[O.PreviewShouldBeShown=11]="PreviewShouldBeShown";O[O.SignalSent=12]="SignalSent";O[O.NoSignalSent=13]="NoSignalSent";O[O.AnnotationReceived=14]="AnnotationReceived";O[O.NoFormulaFound=
15]="NoFormulaFound";O[O.FormulaFound=16]="FormulaFound";O[O.WorkbookClosed=17]="WorkbookClosed";O[O.UnexpectedTransition=18]="UnexpectedTransition"})(b||(b={}));Object(y.b)("FormulaByExampleFlowState",b);const e=new Map([[b.UserEditedInTable,[b.FormulaByExampleNoTrigger,b.FormulaByExampleFullTrigger]],[b.FormulaByExampleFullTrigger,[b.FlowInterrupted,b.NoCachedSuggestion,b.HadCachedSuggestion]],[b.NoCachedSuggestion,[b.NoSignalSent,b.SignalSent]],[b.HadCachedSuggestion,[b.PreCalcPreviewRejected,
b.WaitingForCalcResult]],[b.PreCalcPreviewRejected,[b.NoSignalSent,b.SignalSent]],[b.WaitingForCalcResult,[b.NoSignalSent,b.SignalSent]]]),k=new Set([b.FormulaByExampleNoTrigger,b.FlowInterrupted,b.NoSignalSent,b.SignalSent]),d=new Map([[b.PreCalcPreviewRejected,[b.SuggestionDidntMatch,b.SuggestionMatched]]]),u=new Set([b.SuggestionDidntMatch,b.SuggestionMatched]),n=new Map([[b.WaitingForCalcResult,[b.PostCalcPreviewRejected,b.SuggestionDidntMatch,b.SuggestionMatched]],[b.SuggestionDidntMatch,[b.PostCalcPreviewRejected,
b.PreviewShouldBeShown]],[b.SuggestionMatched,[b.PostCalcPreviewRejected,b.PreviewShouldBeShown]]]),v=new Set([b.PostCalcPreviewRejected,b.PreviewShouldBeShown]),f=new Map([[b.SignalSent,[b.AnnotationReceived]],[b.AnnotationReceived,[b.NoFormulaFound,b.FormulaFound]],[b.FormulaFound,[b.PreCalcPreviewRejected,b.WaitingForCalcResult]]]),w=new Set([b.NoFormulaFound,b.FormulaFound]),r=new Set([b.NoFormulaFound,b.PreCalcPreviewRejected,b.WaitingForCalcResult]);var t;(function(O){O[O.Initial=0]="Initial";
O[O.Pending=1]="Pending";O[O.Resolved=2]="Resolved"})(t||(t={}));Object(y.b)("SignalState",t);var l=a(1);class x{constructor(O,J,H){this.currentState=O;this.mXk=J;this.dxi=H}XIa(O){const J=this.mXk.get(this.currentState);return J&&J.includes(O)?(this.currentState=O,!0):!1}get isActive(){return!this.dxi.has(this.currentState)}CPd(){return b[this.currentState]}}Object(y.a)(x,"FormulaByExampleStateMachine",null,[]);class A{constructor(O,J,H,N,L,Z){this.FTj=Z;this.MRc=new x(0,e,k);this.zga={flowId:O,
A_h:J,rowNumber:H,m_:N,COc:null,YBf:!1,Rpe:!1,i9a:0,tV:L,ZBf:{},dff:new Set}}get i9a(){return this.zga.i9a}set flowId(O){this.zga.flowId=O}qPc(O){this.zga.dff.add(O)}XIa(O,J){17===O?this.Kla():(this.Dxc(O,J),this.FHh())}Kla(){this.FTj(this.zga)}Dxc(O,J){var H,N;this.MRc.XIa(O)?this.ZYj(O):(null===(H=this.Zgb)||void 0===H?0:H.XIa(O))?this.xPj(O):(null===(N=this.g0c)||void 0===N?0:N.XIa(O))?this.V0j(O,J):this.$Wj(O,J);(O=this.cKf(O))&&this.$3e(O,J)}ZYj(O){switch(O){case 2:this.zga.YBf=!0;break;case 6:this.Zgb=
new x(O,d,u);break;case 7:this.Zgb=new x(O,n,v);break;case 12:this.zga.i9a=1,this.g0c=new x(O,f,l.EwaSettings.isChangeGateEnabled("OfficeVSO:6169955_ShowFormulaByExampleSuggestionsUponArrivalFromServer")?r:w)}}xPj(O){switch(O){case 9:this.zga.Rpe=!1;break;case 10:this.zga.Rpe=!0}}V0j(O,J){switch(O){case 14:this.zga.i9a=2;break;case 16:this.zga.COc=J?J.COc:null;break;case 7:this.Zgb=new x(O,n,v)}}$Wj(O,J){this.$3e(this.cKf(18),{reason:`${`Tried to change state from ${this.bDk()} to ${b[O]}`}.${this.RLf(J)}`});
this.Kla()}FHh(){var O,J;this.MRc.isActive||(null===(O=this.Zgb)||void 0===O?0:O.isActive)||(null===(J=this.g0c)||void 0===J?0:J.isActive)||this.Kla()}$3e(O,J){if(J=this.RLf(J))O.explanation||(O.explanation=""),O.explanation+=J;J=Object.assign({},O);O=O.name;J=(delete J.name,J);this.zga.ZBf[O]=J}RLf(O){return null!=O&&null!=O.reason?" "+O.reason:""}bDk(){var O,J;const H=`OriginStateMachine: ${this.MRc.isActive?this.MRc.CPd():"NotActive"}`,N=`CalcStateMachine: ${(null===(O=this.Zgb)||void 0===O?0:
O.isActive)?this.Zgb.CPd():"NotActive"}`;O=`SignalStateMachine: ${(null===(J=this.g0c)||void 0===J?0:J.isActive)?this.g0c.CPd():"NotActive"}`;return`[${H}, ${N}, ${O}]`}cKf(O){switch(O){case 1:return this.m5("FBEFullTrigger",!1);case 3:return this.m5("FBEFullTrigger",!0);case 5:return this.m5("CachedSuggestion",!1);case 4:return this.m5("CachedSuggestion",!0);case 6:return this.m5("PreviewShouldBeShown",!1,"Before calling calc evaluation");case 8:return this.m5("PreviewShouldBeShown",!1,"After returning from Calc");
case 9:return this.m5("SetCellMatchedSuggestion",!1);case 10:return this.m5("SetCellMatchedSuggestion",!0);case 11:return this.m5("PreviewShouldBeShown",!0);case 8:return this.m5("PreviewShouldBeShown",!1,"After returning from Calc");case 15:return this.m5("FormulaFound",!1);case 16:return this.m5("FormulaFound",!0);case 18:return this.m5("UnexpectedTransition",!0)}return null}m5(O,J,H){return H?{name:O,value:J,explanation:H}:{name:O,value:J}}}Object(y.a)(A,"FormulaByExampleFlowDataAggregator",null,
[]);var z=a(977);class F{static getInstance(O){this.instance||(l.EwaSettings.isChangeGateEnabled("OfficeVSO:7041480_FormulaByExampleFlowAggregatorFixed")?this.instance=D.getInstance(O):this.instance=Q.getInstance(O));return this.instance}}Object(y.a)(F,"FormulaByExampleFlowsTrackerFactory",null,[]);class D{constructor(O){this.nextId=1;this.lXf=this.Zac=0;this.c6=new Map;this.vxe=new Map;this.gif=new Map;this.Xi=()=>{const J=this.CTi();if(0!==J.size){this.Lh.sendBeaconTraceTag(526984790,50,!1,`some pending FBE flows were not resolved by workbook closure. Total flows amount in sessions: ${this.Zac}, Unresolved flows amount: ${J.size}, pending flows: ${[...J].join()}, interrupted flows amount ${this.lXf}`);
for(const H of J)this.dw(H,17)}};this.UYk=J=>{const H=J.flowId;var N=J.A_h;const L=J.rowNumber,Z=J.m_,ba=J.COc,K=J.YBf,E=J.Rpe,U=J.i9a,X=J.ZBf,ia=J.dff,Ma=J.tV,qa=this.YKf(N);J=qa.zza;const Ha=J!==ba;Ha&&(qa.D_g++,qa.zza=ba);E&&qa.rtf++;K&&this.lXf++;2===U&&this.Zac++;N={["flowId"]:H,["columnKey"]:N,["rowNumber"]:L,["triggerCommand"]:z.a.ELd(Z),["flowDataAggergation"]:X,["editOperationsInColumn"]:qa.itf,["suggestionChangesInColumn"]:qa.D_g,["gotNewSuggestion"]:Ha,["matchedSuggestionsInColumn"]:qa.rtf,
["cellCycleColumns"]:Array.from(ia).sort(),["rowsEditedInColumn"]:Array.from(qa.otf).sort(),["isInExplicitTable"]:Ma};c.ULS.sendTraceTag(512365781,0,null!=J||null!=ba?20:50,`FormulaByExampleFlowsTracker.summarizeFlowOverallData: Flow Aggregation results: ${JSON.stringify(N)}`);this.c6.set(H,void 0)};this.Lh=O;O.Pp(this.Xi);this.spe=new G}static getInstance(O){D.instance||(D.instance=new D(O));return D.instance}uKf(){const O=this.nextId++,J=this.c6.get(-1);J?(J.flowId=O,this.c6.set(O,J),this.c6.delete(-1)):
c.ULS.sendTraceTag(512503829,0,15,`FormulaByExampleFlowsTracker.getNewFlowId: on flowId ${O} called getNewFlowId without having matched anonymousFlow`);return O}Q_f(O){const J=this.c6.has(O),H=this.c6.get(O),N=H&&1===H.i9a;let L;J?H?N||(L="The flow exists but is not pending for annotation"):L="Flow was resolved already":L="This flow does not exist";L&&c.ULS.sendTraceTag(509650145,306,50,`FormulaByExampleManager.formulaByExampleAnnotationHandler: flow is not pending for annotation. ${L} flowId: ${O}`);
return N}Brg(O,J,H,N){this.c6.get(-1)&&(this.dw(-1,2),this.c6.delete(-1));const L=this.YKf(O);L.itf++;L.otf.add(J);this.c6.set(-1,new A(-1,O,J,N,H,this.UYk))}Mkg(O,J,H,N){J=this.zAc(J,H);this.Brg(J,N,!0,O)}Nkg(O,J,H,N,L){J=this.PRb(J,H,L);this.Brg(J,N,!1,O)}qPc(O,J){const H=this.c6.get(O);H?H.qPc(J):this.jIg("onCellCycleFound",O)}dw(O,J,H){const N=this.c6.get(O);N?N.XIa(J,H):this.jIg("notifyFlowReachedState",O,J)}zAc(O,J){let H=this.vxe.get(O);void 0===H&&(H=this.vxe.size,this.vxe.set(O,H));return H+
"_"+J}PRb(O,J,H){return this.WEf(O,H,J)}XEf(O,J){return this.WEf(O,J)}WEf(O,J,H){let N;const L=this.spe.zZi(J);L?L.find((Z,ba)=>{N=ba;return Z.$i(O)})||(this.spe.z4e(J,O),N=L.length-1):(N=0,this.spe.z4e(J,O));return`${J}_${N}${H?`_${H}`:""}`}CTi(){const O=new Set;for(const J of this.c6){const [H,N]=J;1===(null===N||void 0===N?void 0:N.i9a)&&O.add(H)}return O}YKf(O){let J=this.gif.get(O);J||(J={itf:0,rtf:0,D_g:0,zza:null,otf:new Set},this.gif.set(O,J));return J}jIg(O,J,H){const N=this.c6.has(J);c.ULS.sendTraceTag(509678805,
0,15,`FormulaByExampleFlowsTracker.${O}:
       on flowId ${J} ${H?` transition to ${b[H]}`:""}, `+"flowIdsToAggregatorsMap didn't find the requested flowAggregatoror. "+`Did flow exist: ${N}`)}}Object(y.a)(D,"FormulaByExampleFlowsTracker",null,[737]);class G{constructor(){this.V1c=new Map}z4e(O,J){this.V1c.has(O)||this.V1c.set(O,[]);this.V1c.get(O).push(J)}zZi(O){return this.V1c.get(O)}}Object(y.a)(G,"SensedTablesHeatMap",null,[]);class Q{constructor(O){this.nextId=1;this.ZQb=new Set;this.Zac=0;this.Xi=()=>{const J=this.ZQb.size;0!==J&&
this.Lh.sendBeaconTraceTag(526984790,50,!1,"some pending FBE flows were not resolved by workbook closure. Total flows amount in sessions: {0}, Unresolved flows amount: {1}, pending flows: {2}",this.Zac,J,[...this.ZQb].join())};this.Lh=O;this.Lh.Pp(this.Xi)}static getInstance(O){Q.instance||(Q.instance=new Q(O));return Q.instance}Q_f(O){return this.ZQb.has(O)}Mkg(){}Nkg(){}qPc(){}zAc(){return null}PRb(){return null}XEf(){return null}dw(O,J){switch(J){case 12:this.KFk(O);break;case 14:this.LFk(O)}}uKf(){return this.nextId++}KFk(O){this.ZQb.add(O);
this.Zac++}LFk(O){this.ZQb.delete(O)}}Object(y.a)(Q,"FormulaByExampleFlowsTrackerDeprecated",null,[737])},1126:function(y,m,a){a.d(m,"b",function(){return"<<<FBE_XL_RW>>>"});a.d(m,"a",function(){return c});y=a(0);a=a(1271);class c extends a.a{constructor(b,e,k,d){super(b,e,k,d);this.kind="Range";this.DEa=d.headerRow;this.Gx=d.Gx;this.TXb=d.kN}get formula(){const b=super.formula;return b?b.replace(RegExp("<<<FBE_XL_RW>>>","g"),`${this.originCell.top}`):null}get LJd(){return super.formula}get TXb(){return this.cph}set TXb(b){this.cph=
b}get Gx(){return this.evh}set Gx(b){this.evh=b}get headerRow(){return this.DEa}}Object(y.a)(c,"FormulaByExampleRangeSuggestion",a.a,[])},1127:function(y,m,a){a.d(m,"a",function(){return 2})},1201:function(y,m,a){a.d(m,"b",function(){return e});a.d(m,"c",function(){return d});a.d(m,"a",function(){return u});y=a(0);var c;(function(n){n.accept="ACCEPT";n.undo="UNDO";n.decline="DECLINE";n.ignore="IGNORE";n.unseen="UNSEEN"})(c||(c={}));Object(y.b)("PreviewOutcome",c);var b;(b||(b={})).unseen="UNSEEN";
Object(y.b)("EntryState",b);const e=Object.assign({},b,c);class k{constructor(n){this.state=e.unseen;this.tT=0;this.suggestion=n}Eaj(){this.tT+=1}}Object(y.a)(k,"SuggestionEntryInternal",null,[]);class d extends Map{rfa(n){const v=this.sKa(n);if(!v)return null;let f=this.get(v);f||(f=[],this.set(v,f));n=new k(n);f.push(n);return n}djb(n){n=this.WSb(n);return this.Eei(n)}Eei(n){if(n){var v=this.sKa(n.suggestion);v=this.get(v);v.splice(v.indexOf(n));return!0}return!1}q7g(n){const v=this.WSb(n);return this.NBe(v,
n)}NBe(n,v){n&&(n.suggestion=v);return n}}Object(y.a)(d,"SuggestionsCache",Map,[]);class u extends d{aMi(n){var v;return null===(v=super.get(n))||void 0===v?void 0:v[0]}WSb(n){return(n=this.sKa(n))?this.has(n)?this.get(n)[0]:null:null}rfa(n){const v=this.sKa(n);if(!v)return null;n=new k(n);this.set(v,[n]);return n}djb(n){return(n=this.sKa(n))?this.delete(n):!1}}Object(y.a)(u,"SingularSuggestionsCache",d,[])},1271:function(y,m,a){a.d(m,"a",function(){return e});y=a(0);m=a(1272);var c=a(15),b=a(27);
class e extends m.a{constructor(k,d,u,n){super();this.Obd=null;this.jVe=!1;Object.assign(this,d);this.Lh=k;this.ANe=u;n&&(this.idb=n.LRc,this.plh=n.valueType,this.Pkd=n.sheetId,this.jVe=n.Unj);this.yZ={flowId:this.flowId,BE:this.BE,originCell:this.originCell,anonymizedFormula:this.anonymizedFormula}}set XAi(k){this.Obd=k}set flowId(k){this.ANe=k}get flowId(){return this.ANe}get formula(){var k;if(this.Obd)return this.Obd;void 0===this.AEa&&(this.AEa=null===(k=this.generatedFormula)||void 0===k?void 0:
k.formula)&&"="!==this.AEa.charAt(0)&&(c.ULS.sendTraceTag(509620492,306,50,"FormulaByExampleSuggestion.formula: appending = sign as formula prefix."),this.AEa=`=${this.AEa}`);return this.AEa}set BE(k){this.Vad=k}get IGd(){return this.rows}get Odi(){return this.plh}get anonymizedFormula(){var k;void 0===this.pgc&&(this.pgc=null===(k=this.generatedFormula)||void 0===k?void 0:k.anonymizedFormula);return this.pgc}get sheetId(){return this.Pkd}get BE(){void 0===this.Vad&&(this.Vad=this.IGd.length);return this.Vad}set originCell(k){this.idb=
k}get originCell(){void 0===this.idb&&(c.ULS.sendTraceTag(509620491,306,10,`FormulaByExampleSuggestion.originCell: origin cell is not defined - falling back to first cell of annotation range. flowId: ${this.flowId}`),this.idb=b.Range.yi(this.IGd[0],this.column));return this.idb}get range(){return new b.Range(this.Gx.top,this.idb.left,this.Gx.bottom,this.idb.left,!0,!0)}get uYj(){return this.jVe}r_f(k){return k.$i(this.range)&&this.IGd.includes(k.top)}}Object(y.a)(e,"FormulaByExampleSuggestionBase",
m.a,[756])},1272:function(y,m,a){a.d(m,"a",function(){return b});y=a(0);m=a(956);var c=a(932);class b extends m.a{constructor(){super();this.rows=null;this.column=0;this.generatedFormula=this.formulas=null;this.resultKind=this.invocationMethod=this.stateID=0;this.errorMessage=this.guid=null;this.H_=Object.assign(new c.a,{T_:b.getTypeName(),B_:b.getBaseTypes()})}static getTypeName(){return"AugLoop_FormulaByExample_FormulaByExampleAnnotation"}static getBaseTypes(){return["AugLoop_Core_Annotation"]}}
Object(y.a)(b,"FormulaByExampleAnnotation",m.a,[])},1273:function(y,m,a){a.d(m,"a",function(){return c});const c=b=>excelOnlineCalc.util.isSuccess(b)},1412:function(y,m,a){a.d(m,"b",function(){return r});a.d(m,"a",function(){return l});y=a(0);var c=a(396);m=a(1201);var b=a(15);class e{constructor(x){this.BH=x;this.Oqc=new Map}rfa(x){return this.dTi(x.sheetId).rfa(x)}iCc(x){const A=this.Oqc.get(x.sheetId);return A?A.iCc(x.range):null}wei(x){const A=this.Oqc.get(x.sheetId);return A?A.djb(x):!1}dTi(x){let A=
this.Oqc.get(x);A||(A=new k(this.BH),this.Oqc.set(x,A));return A}}Object(y.a)(e,"FormulaByExampleRangeSuggestionsCache",null,[]);class k extends m.c{constructor(x){super();this.BH=x}rfa(x){const A=this.q7g(x);if(A)return A;this.djb(x);this.BH.d_(x.originCell,3);return super.rfa(x)}WSb(x){return this.iCc(x.range)}iCc(x){var A;b.ULS.shipAssertTag(509383498,306,x.QY,"FormulaByExampleRangeSuggestionsCache.getIntersectingSuggestion: lookup range must be of single column width.");return null===(A=this.get(x.left))||
void 0===A?void 0:A.find(z=>z.suggestion.range.$i(x))}sKa(x){return x.range.left}q7g(x){const A=this.WSb(x);return A&&A.suggestion.LJd===x.LJd?this.NBe(A,x):null}}Object(y.a)(k,"ColumnBasedRangeSuggestionsCache",m.c,[]);var d=a(1);const u=(x,A,z)=>{var F,D;if(d.EwaSettings.isChangeGateEnabled("OfficeVSO:8180963_FBEFixColumnHeadersMetadata")){if((z=null===(F=x.c9)||void 0===F?void 0:F.HeadersList)&&0<z.length&&(z=z.find(Q=>Q.Index===A-1)))return x.name+"_"+z.Name;b.ULS.sendTraceTag(537161876,306,20,
`FormulaByExampleSuggestionCache.getUniqueTableColumnIdentifier: invalid inputs. tableRange: ${x.usedRange}, columnNumber: ${A}, `+`areAllTableHeadersAvailable: ${null===(D=x.c9)||void 0===D?void 0:D.IsFullTableHeaders}`);return null}D=z.e0a(x);if(!D)return null;F=x.usedRange;const G=A-F.left;return 0>G||G>=D.length?(b.ULS.sendTraceTag(537161876,306,20,`FormulaByExampleSuggestionCache.getUniqueTableColumnIdentifier: invalid inputs. tableRange: ${F}, columnNumber: ${A}, `+`areAllTableHeadersAvailable: ${z.lKh(x,
D)}`),null):(z=D[G])?x.name+"_"+z:null};class n extends m.a{constructor(x,A){super();this.Lh=x;this.BH=A}rfa(x){var A;let z=!1;const F=super.WSb(x);if(!F||(z=F.suggestion.formula!==x.formula))return z&&b.ULS.sendTraceTag(523842004,306,20,`FormulaByExampleSuggestionsCache.cacheSuggestion: formula changed from last cache entry, overriding cache entry.
           Last example count: ${F.suggestion.BE}, current: ${x.BE}, oldFormula: ${F.suggestion.anonymizedFormula}, newFormula:${x.anonymizedFormula}`),b.ULS.sendTraceTag(537161877,306,20,`FormulaByExampleSuggestionsCache.cacheSuggestion: saving suggestion for table range. tableRange: ${null===(A=x.table)||void 0===A?void 0:A.usedRange}, columnNumber: ${x.column}, examplesCount ${x.BE}, hasPreviousSuggestion: ${this.has(this.sKa(x))}`),(A=super.rfa(x))||b.ULS.sendTraceTag(528889932,306,15,"SuggestionsCache.cacheSuggestion: failed to cache table suggestion due to getTableColumnKey failure."),
this.BH.d_(x.originCell,3),A;F.suggestion.BE!==x.BE&&(b.ULS.sendTraceTag(523842003,306,50,`FormulaByExampleSuggestionsCache.cacheSuggestion: formula didn't change from the last cache entry, but number of examples changed. Last example ${F.suggestion.BE}, current: ${x.BE}`),this.BH.d_(x.originCell,4),x.yZ.BE=F.suggestion.yZ.BE);F.suggestion.BE!==x.BE&&(b.ULS.sendTraceTag(523842003,306,50,`FormulaByExampleSuggestionsCache.cacheSuggestion: formula didn't change from the last cache entry, but number of examples changed. Last example ${F.suggestion.BE}, current: ${x.BE}`),
this.BH.d_(x.originCell,4),x.yZ.BE=F.suggestion.yZ.BE);return this.NBe(F,x)}rZi(x,A){x=u(x,A,this.Lh);return x?this.aMi(x):(b.ULS.sendTraceTag(528889931,306,15,"FormulaByExampleSuggestionsCache.getTableCachedSuggestion: failed to get cached table suggestion due to getTableColumnKey failure."),null)}sKa(x){return u(x.table,x.column,this.Lh)}}Object(y.a)(n,"FormulaByExampleTableSuggestionsCache",m.a,[]);class v extends Sys.EventArgs{constructor(x){super();this.suggestion=x}}Object(y.a)(v,"FormulaByExampleFormulaRejectedEventArgs",
Sys.EventArgs,[]);m=a(41);var f=a(27),w=a(40);const r=x=>"Table"===x.kind;class t extends Map{}Object(y.a)(t,"ForbiddenFormulasMap",Map,[]);class l extends m.a{constructor(x,A,z){super();this.Lh=x;this.BH=A;this.ep=z;this.yde=!1;this.F7j="formulaByExamplePersistentCache";this.G7j="formulaByExamplePersistentSuggestionsCache";this.hAi="forbiddenFormulas";this.Bvi=1;this.Wge=new e(A);this.X1c=new n(this.Lh,A);d.EwaSettings.isChangeGateEnabled("OfficeVSO:7654591_FormulaByExampleForbiddenFormulas")&&(this.DJa=
new Map,this.JTd=new Map,this.yde=d.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FBEPersistentCache",!1)&&this.Lh.Bkj())&&(this.Mah=this.Lh.e1i(),void this.Obj());this.Dmj=d.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaByExampleForbidFormulaForTable",!1)}wCh(x){this.addHandler("fbefr",x)}$_i(x,A){let z;const F=x.LRc;var D=x.Gx;if(x.tV){x=this.Lh.Ml(F,!1);if(!x)return b.ULS.sendTraceTag(509649310,306,50,`FormulaByExampleManager.onUserInput: getTableContainingRange returned null. flowId: ${A}, editedCellRange: ${F}`),
null;if(D=this.X1c.rZi(x,F.left))D.suggestion.table=x,z=D}else if(A=new f.Range(D.top,F.left,D.bottom,F.right,!0,!0),A=this.Wge.iCc(new c.a(A,x.sheetId)))A.suggestion.Gx=D,A.suggestion.TXb=x.kN,z=A;return z}rfa(x){return"Table"===x.kind?this.X1c.rfa(x):this.Wge.rfa(x)}djb(x){return"Table"===x.kind?this.X1c.djb(x):this.Wge.wei(x)}$Rg(x,A,z){z=void 0===z?!1:z;x.state=A;x.Eaj();d.EwaSettings.isChangeGateEnabled("OfficeVSO:7654591_FormulaByExampleForbiddenFormulas")&&this.c2h(x,z)}Mmj(x){const A=this.NMd(x);
return this.DJa.has(A)?this.DJa.get(A).has(this.iIf(x)):!1}get nFe(){return Date.now()}iIf(x){return d.EwaSettings.isChangeGateEnabled("OfficeVSO:8666058_FormulaByExampleForbidByAnonymizedFormula")?x.anonymizedFormula:x.formula}Obj(){const x=this;return xo(function*(){x.Fml=new Promise(A=>{x.Dzj=A});x.Gei();x.Lh.Ycj(x.G7j,x.hAi,x.Bvi);yield x.zzj();x.Dzj();x.bCf()})}Gei(){const x=this.Lh.deleteDatabase(this.F7j);w.TaskExtensions.$e(x,A=>{A.result?b.ULS.sendTraceTag(507872217,306,50,"FormulaByExampleSuggestionCache.deleteV1Database: successfully deleted old database."):
b.ULS.sendTraceTag(507872216,306,15,"FormulaByExampleSuggestionCache.deleteV1Database: call to delete old database had failed.")},this.Lh.ya)}zzj(){const x=this;return xo(function*(){let A,z;const F=new Promise(D=>{z=D});try{A=x.Lh.RNi(x.Mah)}catch(D){b.ULS.sendTraceTag(508065931,306,50,`FormulaByExampleSuggestionCache.loadSavedCacheState: failed to get forbidden formulas from indexedDB. error: ${D}`)}if(A)return w.TaskExtensions.$e(A,D=>{D=D.result;try{const G=JSON.parse(D);for(const Q of G){const O=
new t;for(const J of Q.iAi)12096E5<x.nFe-J.forbiddingDateTime||O.set(J.formula,J.forbiddingDateTime);x.DJa.set(Q.target,O)}G&&0<G.length&&b.ULS.sendTraceTag(508065929,306,20,`FormulaByExampleSuggestionCache.loadSavedCacheState: successfully non-empty loaded forbidden formulas save state from indexedDB. forbiddenFormulasByTarget size: ${x.DJa.size}`)}catch(G){b.ULS.sendTraceTag(508065928,306,50,`FormulaByExampleSuggestionCache.loadSavedCacheState: failed to parse forbidden formulas from indexedDB. error: ${G}`)}finally{z()}},
x.Lh.ya),F;b.ULS.sendTraceTag(508065930,306,50,"FormulaByExampleSuggestionCache.loadSavedCacheState: getSavedStateTask is undefined.");z()})}c2h(x,A){switch(x.state){case "DECLINE":case "UNDO":this.oJd(x.suggestion);break;case "IGNORE":A=this.NMd(x.suggestion);if(!this.JTd.has(A)){this.JTd.set(A,new Set([x.suggestion.formula]));break}A=this.JTd.get(A);A.has(x.suggestion.formula)?this.oJd(x.suggestion):A.add(x.suggestion.formula);break;case "ACCEPT":A&&this.oJd(x.suggestion)}}oJd(x){let A;const z=
this.NMd(x);this.DJa.has(z)||(A=new t,this.DJa.set(z,A));A=this.DJa.get(z);A.set(this.iIf(x),this.nFe);this.raiseEvent("fbefr",new v(x));this.yde&&this.bCf()}bCf(){const x=[];for(const A of this.DJa){const [z,F]=A;x.push({["target"]:z,iAi:Array.from(F.entries(),D=>{var [G,Q]=D;return{["formula"]:G,["forbiddingDateTime"]:Q}})})}try{this.Lh.Cyk({key:this.Mah,value:JSON.stringify(x)}),b.ULS.sendTraceTag(508065927,306,50,"FormulaByExampleSuggestionCache.flushForbiddenFormulasToIndexedDB: successfully flushed forbidden formulas to indexedDB.")}catch(A){b.ULS.sendTraceTag(508065926,
306,50,`FormulaByExampleSuggestionCache.flushForbiddenFormulasToIndexedDB: failed to flush forbidden formulas to indexedDB. error: ${A}`)}}NMd(x){return this.Dmj?"Table"===x.kind?x.table.name:this.ep.XEf(x.Gx,x.sheetId):this.sZi(x)}sZi(x){return"Table"===x.kind?this.X1c.sKa(x):this.ep.PRb(x.Gx,x.Gx.left-x.originCell.left,x.sheetId)}}Object(y.a)(l,"FormulaByExampleSuggestionCache",m.a,[736])},1439:function(y,m,a){a.d(m,"b",function(){return O});a.d(m,"a",function(){return J});y=a(0);var c=a(15),b=
a(27),e=a(2),k=a(327),d=a(212);m=a(1057);var u=a(932);class n extends m.a{constructor(){super();this.formulasCount=this.columnNames=this.additionalInputs=this.examples=null;this.invocationMethod=this.stateID=0;this.enableExplanations=this.cultureInfoNames=this.referenceRowValue=this.referenceRowExpression=this.timeoutInSeconds=this.guid=this.conditionalMinBranchExampleCount=this.enableConditional=this.supportedFunctions=null;this.H_=Object.assign(new u.a,{T_:n.getTypeName(),B_:n.getBaseTypes()})}static getTypeName(){return"AugLoop_FormulaByExample_FormulaByExampleSignal"}static getBaseTypes(){return["AugLoop_Signals_Signal"]}}
Object(y.a)(n,"FormulaByExampleSignal",m.a,[]);var v=a(1440),f=a(68),w=a(1064),r=a(1089),t=a(120),l=a(1127),x=a(1126),A=a(1),z=a(977),F=a(565);const D=A.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.FormulaByExampleRAILThresholdQuantum",35),G=A.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.FormulaByExampleAsyncSignalGenerationTimeoutDuration",5E3);a=A.EwaSettings.isChangeGateEnabled("OfficeVSO:8501373_CalcTsFuncsFirstSlice")&&A.EwaSettings.isChangeGateEnabled("OfficeVSO:8625930_FBEWithCalcTSFuncsFirstSlice");
const Q={TEXTSPLIT:a,TEXTSLICE:!1,FINDN:!1,TEXTAFTER:a,TEXTBEFORE:a},O={AEd:"editRange",m_:"triggerCommand",wze:"triggerKind",XBf:"flowId",L0f:"isInExplicitTable",r0g:"tableInnerRange",O1f:"isNewRowPrediction",t0f:"isHeaderLess",wWg:"showNow",Lfg:"newColumnHypothesis",TSf:"headerRow"};class J{constructor(H,N,L,Z){this.JJd=Z;this.BL=!1;this.Lh=H;this.formulaByExampleManager=N;this.xVh=L;this.ep=r.a.getInstance(this.Lh);this.BL=Object(w.a)(this.Lh);this.dHj=A.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.FormulaByExampleMaximalNumberOfAdditionalInputRows",
30);this.BXg=null!=this.JJd;c.ULS.sendTraceTag(528758226,306,50,"FormulaByExampleCommandHandler.ctor: FBE command handler created")}Ri(){return!1}executeCommand(H,N,L){H=!1;N=N.command;switch(N){case 1928326585:var Z=L&&L[O.wze]?L[O.wze]:0;H=L[O.XBf];if(0===Z)return c.ULS.sendTraceTag(524940245,306,15,"FormulaByExampleManager.executeCommand: triggerFormulaByExample command called for execution with NoTrigger value."),this.ep.dw(H,1),f.Task.Ua(!0);const ba=!L||!L[O.AEd],K=this.MLi(L,ba),E=L[O.r0g],
U=L[O.L0f],X=L[O.m_],ia=L[O.O1f],Ma=L[O.t0f],qa=this.EKi(K,E),Ha=L[O.wWg],ha=L[O.Lfg];L=L[O.TSf];L={LRc:K,tV:U,valueType:qa,Gx:E,sheetId:z.a.o1(this.Lh.b_c),kN:ia,m_:X,W_c:Ha,Unj:ha,headerRow:L};ba||2!==Z||this.formulaByExampleManager.B2j(H,L);if(this.BXg&&(Z=this.qGf(K,U))&&this.JJd.Fjj(Z))return c.ULS.sendTraceTag(508036636,306,50,"FormulaByExampleCommandHandler.executeCommand: column is locked, not triggering FBE (no signal)"),this.Lh.m8(H,"signal lock"),f.Task.Ua(!0);H=this.triggerFormulaByExample(K,
E,ba,H,U,Ma,L)}return H?f.Task.Ua(!0):Object(d.a)(N)}Ei(H,N){switch(N.command){case 1928326585:return this.Lh.g2a();default:return!1}}dj(){return!1}EKi(H,N){var L;if(A.EwaSettings.isChangeGateEnabled("OfficeVSO:8582031_FormulaByExampleAsYouType")){N=this.Lh.Lva("FormulaByExampleCommandHandler.getDefaultColumnValueType",new b.Range(N.top,H.left,N.bottom,H.left,!0,!0));try{for(;N.$$mn();){const Z=N.$$cu().cell.yD;if(0!==Z)return Z}}catch(Z){throw Error(`Error while iterating over cells: ${Z}`);}finally{N&&
N.dispose()}}return null===(L=this.Lh.yh(H))||void 0===L?void 0:L.cell.yD}MLi(H,N){c.ULS.sendTraceTag(537161928,306,50,`FormulaByExampleCommandHandler.getEditedRange: flow triggered from: ${N?"Ribbon":"AutoDetect"}`);return N?this.Lh.getActiveCell():H[O.AEd]}triggerFormulaByExample(H,N,L,Z,ba,K,E){if(!this.Lh.Hkj)return c.ULS.sendTraceTag(537161927,306,10,"FormulaByExampleCommandHandler.TriggerFormulaByExample: augmentationLoopManager instance is null"),this.ep.dw(Z,13,{reason:"AugmentationLoopManager instance is null"}),
this.Lh.m8(Z,"AL is undefined"),!0;let U=N;if(A.EwaSettings.isChangeGateEnabled("OfficeVSO:8180963_FBEFixColumnHeadersMetadata")&&(U=N.Fk(this.Lh.getLoadedRange()),!U))return c.ULS.sendTraceTag(508363683,306,20,"FormulaByExampleCommandHandler.TriggerFormulaByExample: tableRange does not intersect loaded range"),this.ep.dw(Z,13,{reason:"tableRange does not intersect loaded range"}),this.Lh.m8(Z,"tableRange does not intersect loaded range"),!0;L=this.NNi(H,U,L,Z,ba,K,E);void L.then(X=>{if(X){if(this.BXg){const ia=
this.qGf(H,ba);ia&&this.sMj(Z,ia,X.examples,N)}c.ULS.sendTraceTag(537161926,306,50,`FormulaByExampleCommandHandler.TriggerFormulaByExample: calling SubmitOperationSignal for flowId: ${Z}, isInExplicitTable: ${ba}.`);this.Lh.tYk(X,"FormulaByExample");this.ep.dw(Z,12);this.xVh.d_(H,1);this.BL&&Object(w.f)("SIGNALSENT",Z)}else this.ep.dw(Z,13,{reason:"Signal is null"})});return!0}sMj(H,N,L,Z){const ba=[];for(const K of L){L=new b.Range(K.output.row,Z.left,K.output.row,Z.right,!0,!0);if(0<ba.length){const E=
ba[ba.length-1];if(E.bottom+1===L.top){E.Dzf(L);continue}}ba.push(L)}this.JJd.U0j(H,N,ba);c.ULS.sendTraceTag(508036635,306,50,"FormulaByExampleCommandHandler.notifyLockManagerOnSignalSent: SignalLocksManager has been updated with the signal sent")}qGf(H,N){return N?(N=this.Lh.Ml(H,!1),N?this.ep.zAc(N.name,H.left):(c.ULS.sendTraceTag(508036634,306,15,"FormulaByExampleCommandHandler.getColumnKeyFromEditRange: explicit table is null"),null)):this.ep.PRb(H,H.left,z.a.o1(this.Lh.la))}NNi(H,N,L,Z,ba,K,
E){const U=this;return xo(function*(){var X,ia,Ma=yield U.jHi(N,H,Z,E);if(!Ma)return null;let qa,Ha=void 0,ha=void 0;if(ba){const La=U.Lh.Ml(H,!1);if(!La)return c.ULS.sendTraceTag(537161925,306,15,"FormulaByExampleCommandHandler.TriggerFormulaByExample: table returned null for given edit range."),U.ep.dw(Z,13,{reason:"Table returned null for given edit range"}),U.Lh.m8(Z,"table return null for table suggestion"),null;qa=U.GIi(La);if(A.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaByExampleReferenceRowFormula",
!1)){ha=N.top-1;const fa=null===(ia=null===(X=La.c9)||void 0===X?void 0:X.HeadersList[H.left-N.left])||void 0===ia?void 0:ia.Name;fa&&(X=Object(F.b)(fa),Ha=`${La.name}[[#Headers],[${X}]]`)}}else U.Lh.h2a()&&(qa=U.FIi(N,H),A.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaByExampleReferenceRowFormula",!1)&&(ha=K?N.top:N.top-1,Ha=`\$${H.toString().charAt(0)}\$${ha}`));if(!qa)return U.Lh.m8(Z,"no column names found"),null;A.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaByExampleReferenceRowFormula",
!1)&&!Ha&&(c.ULS.sendTraceTag(508347742,306,15,`FormulaByExampleCommandHandler.TriggerFormulaByExample: failed to generate referenceRowExpression. isHederLessTable: ${K}, isInExplicitTable: ${ba}`),ha=Ha=void 0);Ma=Object(e.a)(new n,{formulasCount:1,examples:Ma.examples,additionalInputs:Ma.additionalInputs,columnNames:qa,stateID:U.Lh.UC,invocationMethod:L?0:1,guid:Z.toString(),supportedFunctions:Q,enableConditional:A.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaByExampleConditionals",
!1),referenceRowExpression:Ha,referenceRowValue:ha,cultureInfoNames:A.EwaSettings.isChangeGateEnabled("OfficeVSO:8198743_FormulaByExampleTier1Langs")?{userInterfaceCulture:void 0,dataCulture:U.Lh.$.dataCultureTag}:void 0,enableExplanations:A.EwaSettings.isChangeGateEnabled("OfficeVSO:8697329_FormulaByExampleExplanationsAlwaysGenerated")||A.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaByExampleExplanations",!1)});c.ULS.sendTraceTag(528758225,306,50,"FormulaByExampleCommandHandler.getFormulaByExampleSignalFromTable: signal generated.");
return Ma})}jHi(H,N,L,Z){const ba=this;return xo(function*(){return yield ba.kHi(H,N,L,Z)})}GIi(H){var N;const L=[],Z=H.name;if(A.EwaSettings.isChangeGateEnabled("OfficeVSO:8180963_FBEFixColumnHeadersMetadata")){var ba=null===(N=H.c9)||void 0===N?void 0:N.HeadersList;if(!ba)return c.ULS.sendTraceTag(508363682,306,15,"FormulaByExampleCommandHandler.getColumnNamesMapFromTable: failed to generate columnNames."),null;for(var K of ba)ba=K.Index,H=K.Name,H=A.EwaSettings.isChangeGateEnabled("OfficeVSO:8202565_FBEescapeColumnHeaderNames")?
Object(F.b)(H):H,L.push({column:ba+1,name:`${Z}[@[${H}]]`})}else{K=z.a.Vga(H);H=this.Lh.e0a(H);if(!K||!H)return c.ULS.sendTraceTag(524940244,306,15,`FormulaByExampleCommandHandler.getColumnNamesMapFromTable: failed to generate columnNames. is tableRange null: ${!K}, is colNamesCurrentTable null: ${!H}`),null;K=K.left;for(ba of H)H=A.EwaSettings.isChangeGateEnabled("OfficeVSO:8202565_FBEescapeColumnHeaderNames")?Object(F.b)(ba):ba,L.push({column:K,name:`${Z}[@[${H}]]`}),K++}return L}FIi(H,N){const L=
[];N=new b.Range(N.top,H.left,N.top,H.right,!0,!0);H=this.Lh.Lva("FormulaByExample.getColumnNamesMapFromInputRange",N);for(N=N.left;H.$$mn();){const Z={column:N++,name:`${b.Range.WO(H.$$cu().range.left)+x.b}`};L.push(Z)}return L}kHi(H,N,L,Z){const ba=this;return xo(function*(){const K=N.left;try{const E=yield ba.DNi(H,K,L);return yield ba.cbi(H,K,E,Z,L)}catch(E){return c.ULS.sendTraceTag(508909329,306,10,`FormulaByExampleCommandHandler.getByExamplesInputsFromRangeAsync: failed to generate byExampleInputs. ${E}`),
null}})}DNi(H,N,L){const Z=this;return xo(function*(){const ba=new Set,K=Z.Lh.Lva("FormulaByExample.getForbiddenColumnsFromRangeAsync",H),E=U=>{var X=U.range;const ia=X.left;ia===N||ba.has(ia)||(X=new b.Range(X.top,N,X.top,N,!1,!1),Z.Mkj(U,X)&&(ba.add(ia),Z.ep.qPc(L,ia-(Z.Lh.displayRtl?H.right:H.left))))};try{return yield Z.Yah(K,E),ba}catch(U){throw Error(`getForbiddenColumnsFromRangeAsync failed with reason: ${U}`);}})}cbi(H,N,L,Z,ba){const K=this;return xo(function*(){const E=[],U=[],X=H.right,
ia=new Set;let Ma=[],qa=!1,Ha=null;const ha=A.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaByExampleTrackNonUniformColumns",!1)?new Set:null,La=K.Lh.Lva("FormulaByExample.createValidExamplesFromRangeAsync",H);let fa=!1;const ja=new Map,ta=Ka=>{if(504848446!==Z.m_||Ka.range.top!==Z.LRc.top){var Ga=Ka.range.left,Na=Ga===N;Na&&Ka.text?Ha=K.ulf(Ka):Na||L.has(Ga)||(Ka.text&&(qa=!0),Ma.push(K.ulf(Ka)));Ka=K.u$k(Ka,ja);fa||(fa=Ka);Ga===X&&(qa&&(Ha?(E.push({output:Ha,inputs:Ma}),ia.add(Ha.rawValueJson),
null===ha||void 0===ha?void 0:ha.add(Ha.numberFormatCategory)):U.length<K.dHj&&U.push({output:null,inputs:Ma})),Ma=[],qa=!1,Ha=null)}};try{yield K.Yah(La,ta);if(ia.size<l.a)return c.ULS.sendTraceTag(509683013,306,50,"FormulaByExampleCommandHandler.createValidExamplesFromRange: column does not have enough distinct examples with inputs."),K.Lh.m8(ba,"not enough examples with non-empty inputs"),null;if(ha){const Ka={["isUniformColumn"]:1===ha.size,["dataTypes"]:Array.from(ha).sort().join(","),["flowId"]:ba};
c.ULS.sendTraceTag(507581650,306,20,`Formula By Example Uniform Column Data: ${JSON.stringify(Ka)}`);if(A.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaByExampleSuppressNonUniformSignals",!1)&&1<ha.size)return c.ULS.sendTraceTag(507581649,306,50,"FormulaByExampleCommandHandler.createValidExamplesFromRange: column has non uniform data, suppressing signal."),K.Lh.m8(ba,"column has non uniform data"),null}if(K.Lh.f2a()){const Ka=ja.get(N),Ga={["isFormulaUser"]:fa,["hasFormulaColumn"]:Array.from(ja.entries()).some(Na=>
{[,Na]=Na;return"HasNonFormulaCell"!==Na&&1===Na.size}),["outputColumnDataState"]:Ka&&"HasNonFormulaCell"===Ka?"NonFormulaColumn":1===Ka.size?"FormulaColumn":"MixedFormulasColumn",["flowId"]:ba};c.ULS.sendTraceTag(507557075,306,20,`Formula By Example Formula User And Columns Hypothesis Data: ${JSON.stringify(Ga)}`)}return{examples:E,additionalInputs:U}}catch(Ka){throw K.Lh.m8(ba,"createValidExamplesFromRangeAsync failed, log 4vv2r"),Error(`createValidExamplesFromRangeAsync failed with reason: ${Ka}`);
}})}Yah(H,N){return xo(function*(){const L=performance.now();let Z=L;try{for(;H.$$mn();){if(performance.now()-L>G)throw Error("Timeout");performance.now()-Z>D&&(yield z.a.Uhl(),Z=performance.now());N(H.$$cu())}}catch(ba){throw Error(`Error while iterating over cells: ${ba}`);}finally{H&&H.dispose()}})}u$k(H,N){if(!this.Lh.f2a())return!1;const L=H.range.left;if(!H.text||!H.LC)return N.set(L,"HasNonFormulaCell"),!1;if("HasNonFormulaCell"===N.get(L))return!0;N.has(L)||N.set(L,new Set);N.get(L).add(H.formulaBarText);
return!0}Mkj(H,N){const L=H.LQ,Z=H.range,ba=this.Lh.KDe,K=this.Lh.la;if(!K)return c.ULS.sendTraceTag(509743199,306,50,"FormulaByExampleCommandHandler.isDependingOn: this.ewaControl.activeItem returned null. Expected to be an object of type Sheet."),!1;if(!(A.EwaSettings.isChangeGateEnabled("OfficeVSO:7251463_FBEFixJsCrashOnNullActiveSheet")||K instanceof t.a))return c.ULS.sendTraceTag(509743198,306,50,"FormulaByExampleCommandHandler.isDependingOn: this.ewaControl.activeItem returned object of type other then Sheet. Expected to be an object of type Sheet."),
!1;if(!this.Lh.iIc(H.cell.to,L))return!1;if(H=this.Lh.extractReferences(L,K.name,ba,!0,Z))for(const E of H.Items)if(z.a.ABi(E.Range).equals(N))return!0;return!1}ulf(H){let N;if(1===H.Qn.type){N=parseFloat(H.Qn.value);var L=this.Lh.Hna(H.cell.to);Object(k.c)(L)?L=L.value.isDate?4:L.value.isTime?5:1:(c.ULS.sendTraceTag(522840207,0,10,`FormulaByExampleCommandHandler.createAugLoopCell: CalcManager's getNumberFormat method failed on the given cell, falling back to number format. failureReason: ${L.reason}`),
L=1)}else N=H.text,L=0;return Object.assign(new v.a,{row:H.range.top,column:H.range.left,displayText:H.text,rawValueJson:JSON.stringify(N),numberFormatCategory:L.toString()})}}Object(y.a)(J,"FormulaByExampleCommandHandler",null,[36])},1477:function(y,m,a){a.r(m);a.d(m,"FormulaByExampleAutoSuggestActor",function(){return t});y=a(0);var c=a(15),b=a(1030),e=a(84),k=a(1064),d=a(1439),u=a(1127),n=a(1089),v=a(396),f=a(1),w=a(977),r=a(27);class t{constructor(l,x){this.YSc=this.osd=this.BL=!1;this.mHa=null;
this.dxc=!1;this.Vva=0;this.Nw=null;this.Z0b=new Map;this.pZ=(A,z)=>{z.committed?(this.Nw&&(this.Vva++,this.Nw.oSg(this.Vva,this.Vva),this.Nw.Tja(this.Vva,0)),this.Qkg(z.Gq,324156914)):this.kT()};this.K7=(A,z)=>{this.Qkg(z.f6.range,504848446,z.TJc)};this.Qkg=(A,z,F)=>{324156914===z&&this.S2g(A);if(f.EwaSettings.isChangeGateEnabled("OfficeVSO:8680199_ValidatorReportOrderFix")&&!this.eWd(A))this.kT(),this.Lh.m8(this.Vva,"cell is invalid for FormulaByExample trigger - formula cell");else{var {Gx:D,tV:G,
kN:Q,qha:O,headerRow:J}=this.Vga(A);D&&A.$i(D)?(this.SFc(A,324156914,D,G),f.EwaSettings.isChangeGateEnabled("OfficeVSO:8680199_ValidatorReportOrderFix")||this.eWd(A)?this.SPc(A,A,D,z,G,Q,O,F,J):this.kT()):(this.kT(),this.Lh.m8(this.Vva,D?"edited header cell":"no table found"))}};this.S2g=A=>{if(this.Lh.f2a()){var z=new r.Range(A.top,A.left-1,A.bottom,A.left,!1,!1);(z=this.Lh.tZi(z))&&(z.usedRange.$i(A)?this.stj(z,A.left,A)&&this.Jcg(z,A.left-z.usedRange.left):this.Jcg(z,A.left-z.usedRange.left))}};
this.Jcg=(A,z)=>{this.Z0b.has(A.name)?this.Z0b.get(A.name).add(z):this.Z0b.set(A.name,new Set([z]))};this.Pqj=A=>{const z=this.Lh.Ml(A,!1);return z&&this.Z0b.has(z.name)?this.Z0b.get(z.name).has(A.left-z.usedRange.left):!1};this.Uae=(A,z)=>{A=z.destinationRange;if(1804571062===z.command||A.left!==A.right)this.kT();else{var F=new r.Range(A.top,A.right,A.top,A.right,!1,!1),{Gx:D,tV:G,kN:Q,qha:O,headerRow:J}=this.Vga(F);D?(this.SFc(F,z.command,D,G),this.SPc(F,A,D,z.command,G,Q,O,!1,J)):this.kT()}};this.GQc=
(A,z)=>{if((A=z.gqf)&&1===A.length)if(A=A[0],f.EwaSettings.isChangeGateEnabled("OfficeVSO:8468987_FormulaByExamplePasteColumn"))if(A.QY)if(this.Lh.SD(A))if((z=z.uo)&&1804571062!==z&&1766348718!==z){A.isSingle&&this.S2g(A);var {Gx:F,tV:D,kN:G,qha:Q,headerRow:O}=this.Vga(A);if(F){c.ULS.sendTraceTag(507855043,306,50,`FormulaByExampleAutoSuggestActor.onPasteSucceededInner: passed all conditions to trigger FBE event.
        ribbonCommand = ${b.a[z]}
        destinationRange.height = ${A.height}`);var J=A.center;this.SFc(J,z,F,D);this.SPc(J,A,F,z,D,G,Q,!1,O)}else this.kT(),c.ULS.sendTraceTag(507855044,306,50,"FormulaByExampleAutoSuggestActor.onPasteSucceededInner: no table contains the range")}else this.kT(),c.ULS.sendTraceTag(507872195,306,50,`FormulaByExampleAutoSuggestActor.onPasteSucceededInner: unsupported paste. ribbonCommand = ${b.a[z]}`);else this.kT(),c.ULS.sendTraceTag(507881249,306,50,"FormulaByExampleAutoSuggestActor.onPasteSucceededInner: destinationRange not fully contained in viewport");
else this.kT(),c.ULS.sendTraceTag(507881250,306,50,`FormulaByExampleAutoSuggestActor.onPasteSucceededInner: not single column. destinationRange.width = ${A.width}`);else if((z=z.uo)&&1804571062!==z&&1766348718!==z&&A.isSingle){var {Gx:H,tV:N,kN:L,qha:Z,headerRow:ba}=this.Vga(A);H?(this.SFc(A,z,H,N),this.SPc(A,A,H,z,N,L,Z,!1,ba)):this.kT()}else this.kT(),c.ULS.sendTraceTag(508376384,306,50,`FormulaByExampleAutoSuggestActor.onPasteSucceededInner: unsupported paste or not single cell. ribbonCommand = ${b.a[z]} destinationRange.isSingle = ${A.isSingle}`);
else this.kT(),c.ULS.sendTraceTag(508380383,306,50,`FormulaByExampleAutoSuggestActor.onPasteSucceededInner: not single range. destinationRanges?.length = ${null===A||void 0===A?void 0:A.length}`)};this.rDd=()=>{var A=this.nAk(this.PP.originCell,this.PP.Gx);if(0===A)this.kT(),this.ep.dw(n.b,1),this.Lh.m8(this.Vva,"output column doesn't have enough distinct examples");else{var z=this.ep.uKf();this.ep.dw(z,3);this.PP.F2d&&this.Nw&&this.Nw.oSg(z,this.PP.F2d);c.ULS.sendTraceTag(537161929,306,50,`FormulaByExampleAutoSuggestActor.tryTriggeringFormulaByExample: triggering FormulaByExample for cell edit. Trigger kind: ${A}, FlowId: ${z}`);
this.BL&&Object(k.f)("EDITCOMMIT",z);var F=new e.a(1928326585,1,2,6,null);A={[d.b.AEd]:this.PP.originCell,[d.b.m_]:this.PP.m_,[d.b.wze]:A,[d.b.XBf]:z,[d.b.r0g]:this.PP.Gx,[d.b.L0f]:this.PP.tV,[d.b.O1f]:this.PP.kN,[d.b.t0f]:this.PP.qha,[d.b.wWg]:this.PP.Csj,[d.b.Lfg]:this.PP.tV&&this.Pqj(this.PP.originCell),[d.b.TSf]:this.PP.headerRow};this.Lh.qh(F,A);this.kT()}};this.A1j=(A,z)=>{A=this.PP.eWh;z=z.Gq.toString();A.has(z)&&(A.delete(z),0===A.size&&this.rDd())};this.Lh=l;this.BL=x;this.kT();this.Lh.zX(this.pZ);
f.EwaSettings.isChangeGateEnabled("OfficeVSO:8582031_FormulaByExampleAsYouType")&&this.Lh.fM(this.K7);this.dxc=f.EwaSettings.isChangeGateEnabled("OfficeVSO:8231994_FBECalcGridUnreliableFix");this.Nw=this.Lh.Nw;this.dxc||this.Lh.Kpd(this.A1j);f.EwaSettings.isChangeGateEnabled("OfficeVSO:7395435_FormulaByExampleTriggerOnCSEPaste")&&this.Lh.Pnc(this.Uae);(this.YSc=f.EwaSettings.isChangeGateEnabled("OfficeVSO:8329262_FormulaByExamplePostPaste"))&&this.Lh.bJb(this.GQc);this.ep=n.a.getInstance(this.Lh);
if(this.osd=this.Lh.h2a())this.Lh.Sbj(),this.xne=f.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.FormulaByExampleRowsBelowRangeTableToQuery",1)}stj(l,x,A){var z;l=w.a.Vga(l);x=new r.Range(l.top,x,l.bottom,x,!1,!1);x=this.Lh.Lva("FormulaByExampleAutoSuggestActor:isTableColumnBlank",x);try{for(;x.$$mn();){const F=x.$$cu();if(!F.range.equals(A)&&(null===(z=F.Qn)||void 0===z?0:z.value))return!1}}finally{x&&x.dispose()}return!0}Vga(l){var x;const A=this.Lh.Ml(l,!1);if(A)return l=null===(x=A.c9)||
void 0===x?void 0:x.HeadersList,{Gx:w.a.Vga(A),tV:!0,kN:!1,qha:!l};if(this.osd){const {V4b:z,kN:F,qha:D,headerRow:G}=this.tVi(l);if(z)return{Gx:z,tV:!1,kN:F,qha:D,headerRow:G}}return{Gx:null,tV:!1,kN:!1,qha:!1}}tVi(l){var x=new r.Range(l.top-this.xne,l.left,l.bottom,l.right,!0,!0),A=this.Lh.VZk(new v.a(x,w.a.o1(this.Lh.la)),6);if(!A)return null;const z=new Map;for(var F of A)for(var D of F.table.interpretations)if(2===D.orientation&&.5<D.confidence){x=new r.Range(D.tableLocation.top+D.headerRowCount,
D.tableLocation.left+D.headerColumnCount,Math.max(D.tableLocation.bottom,x.bottom),D.tableLocation.right,!0,!0);l=!D.tableLocation.$i(l);A=0===D.headerRowCount;if(1===D.headerRowCount)for(D=x.left;D<=x.right;D++){F=new r.Range(x.top-1,D,x.top-1,D,!1,!1);const G=this.Lh.yh(F);G?z.set(G.range.left,G.cell.text):c.ULS.sendTraceTag(507581085,306,15,`FormulaByExampleAutoSuggestActor.getRangeTableInnerRange: formatted cell for header row is null. table inner range: ${x} cell range: ${F}`)}return{V4b:x,kN:l,
qha:A,headerRow:z}}return{V4b:null,kN:!1,qha:!1,headerRow:null}}SPc(l,x,A,z,F,D,G,Q,O){this.YQg(l,x,A,z,F,D,G,Q,O);l=[];this.dxc&&l.push(324156914);this.YSc&&l.push(237279923,-185374993,-958589048,808159687,42074747,-875588320,264209770);l.includes(z)?(this.O6b(),this.mHa=this.Lh.QNa(()=>{f.EwaSettings.isChangeGateEnabled("OfficeVSO:8235022_FBEVerifyCellNotFormulaAfterConsistent")&&!this.eWd(this.PP.originCell)?(this.kT(),this.ep.dw(n.b,1),this.Lh.m8(this.Vva,"cell is invalid for FormulaByExample trigger - formula cell")):
this.rDd()})):(this.O6b(),this.rDd())}SFc(l,x,A,z){z?(z=this.Lh.Ml(l,!1),this.ep.Mkg(x,z.name,l.left-(this.Lh.da.rtl?A.right:A.left),l.top-A.top)):this.ep.Nkg(x,A,l.left-(this.Lh.da.rtl?A.right:A.left),l.top-A.top,w.a.o1(this.Lh.b_c))}eWd(l){var x=this.Lh.yh(l);if(!x)return c.ULS.sendTraceTag(524120778,306,15,`FormulaByExampleAutoSuggestActor.isCellValidForTriggeringFormulaByExample: formattedCell is null. investigation hints: is cell null = ${!l}`),this.ep.dw(n.b,1,{reason:"Didn't trigger since the formattedCell is null."}),
!1;if(f.EwaSettings.isChangeGateEnabled("OfficeVSO:8666049_FBEUseClientGridFormulaMetadata"))return x.cell.LC?(this.ep.dw(n.b,1,{reason:"Didn't trigger since edited cell content is a formula."}),!1):!0;l=this.Lh.iIc(x.cell.to,x.LQ);(x=null!==l&&!l)||this.ep.dw(n.b,1,{reason:`Didn't trigger since edited cell content is a formula or isFormulaCell returned null. isFormulaText is null:${null==l}`});return x}nAk(l,x){l=l.left;x=new r.Range(x.top,l,x.bottom,l,!0,!0);return this.mAk(x)}mAk(l){var x;const A=
new Set;let z=0;l=this.Lh.Lva("FormulaByExampleAutoSuggestActor:Table",l);try{for(;l.$$mn();){const F=l.$$cu();if(null===(x=F.Qn)||void 0===x?0:x.value)if(A.add(F.Qn.value),z++,A.size>=u.a)return 2}}finally{l&&l.dispose()}z>=u.a?(c.ULS.sendTraceTag(523368219,306,50,"FormulaByExampleAutoSuggestActor.searchForSufficientExamplesInOutputColumn: Table has sufficient example amount - but not enough distinct examples."),this.ep.dw(n.b,1,{reason:"Didn't trigger since there aren't enough distinct outputs"})):
this.ep.dw(n.b,1,{reason:"Didn't trigger since there aren't enough examples"});return 0}O6b(){this.mHa&&(this.mHa(),this.mHa=null,this.Nw&&324156914===this.PP.m_&&this.Lh.m8(this.PP.F2d,"consistent block cache callback cancelled"))}kT(){this.YQg(null,null,null,null,null,null,null);(this.YSc||this.dxc)&&this.O6b()}YQg(l,x,A,z,F,D,G,Q,O){this.PP={originCell:l,eWh:new Set(null===x||void 0===x?void 0:x.E$e(x.zz).map(J=>J.toString())),m_:z,Gx:A,tV:F,kN:D,qha:G,Csj:Q,headerRow:O,F2d:324156914===z?this.Vva:
null}}}Object(y.a)(t,"FormulaByExampleAutoSuggestActor",null,[])},1478:function(y,m,a){m=a(492);a=a(1479);a=a.$q?a.default:a;"string"===typeof a&&(a=[[y.i,a,""]]);m(a,{insert:"head",au:!1});y.exports=a.cw||{}},1479:function(y,m,a){m=a(493)(!1);m.push([y.i,'.ewa-ac{position:absolute;z-index:102;margin-top:1px;width:auto}.ewa-ac .ewa-ac-param{white-space:nowrap;margin-bottom:3px;direction:ltr}.ewa-ac .ewa-ac-param function_param_table{position:absolute}.ewa-ac .ewa-ac-param .ewa-function-help-link{text-decoration:underline}.ewa-lb{position:absolute;border:1px solid #a2a6ab;overflow-x:hidden;overflow-y:auto;cursor:default;background-color:#fff;color:#262626;font-size:12px;font-family:"Segoe UI";z-index:102;height:auto;margin:0 8px;touch-action:manipulation;vertical-align:middle}.ewa-lb.ewa-fb-refactor{position:relative;margin:0}.ewa-lb table{left:0;right:0;border-collapse:collapse}.ewa-lb table td{white-space:nowrap}.ewa-lb table td div.clip16x16{margin:0 0 0 2px}.ewa-lb table td.list-item{height:24px;padding:0 8px}.ewa-lb table td.list-item-selected{background-color:#d3f0e0}@media screen and (-ms-high-contrast:active){.ewa-lb table td.list-item-selected{border:2px solid #fff}}.ewa-lb table.list-table-touch td.list-item{height:35px}div#suggested_cells_list_box{margin:0}div#suggested_cells_list_box .list-table .ewa-suggested-cell-name{float:left;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}@font-face{font-family:"Segoe UI Semibold";font-weight:600;src:local("Segoe UI Semibold"),local("Segoe UI")}.ewa-lb table td.columnName-header{color:#666;font-size:12px;font-family:"Segoe UI Semibold";text-align:left;padding:3px 8px;text-overflow:ellipsis}.ewa-tt{background-color:#f7f7f7;border:1px solid #a2a6ab;color:#444;height:auto;vertical-align:middle;width:auto;z-index:102;font-size:8pt;margin:0;padding-bottom:3px;padding-top:2px}.ewa-root-ltr .ewa-tt{text-align:left;padding-left:5px;padding-right:7px}.ewa-root-rtl .ewa-tt{text-align:right;padding-left:7px;padding-right:5px}.ewa-dlg-function-link-container .ewa-fdb-help-link,.ewa-tt-ltr .ewa-fdb-help-link,.ewa-tt-rtl .ewa-fdb-help-link{color:#00f;text-decoration:underline}.ewa-function-link-container .ewa-function-udf-name,.ewa-function-link-container-udf .ewa-function-help-link{display:none}.ewa-root.rtl .ewa-function-link-container{text-align:left}',
""]);y.exports=m},1480:function(y,m,a){m=a(492);a=a(1481);a=a.$q?a.default:a;"string"===typeof a&&(a=[[y.i,a,""]]);m(a,{insert:"head",au:!1});y.exports=a.cw||{}},1481:function(y,m,a){m=a(493)(!1);m.push([y.i,".ewa-fb-fluent .ewa-rteLine .formula-highlight-1,.ewa-gridKeyHandler .formula-highlight-1{color:#006cbe}.ewa-fb-fluent .ewa-rteLine .formula-highlight-1::selection{color:#b2e3ff}.ewa-fb-fluent .ewa-rteLine .formula-highlight-2,.ewa-gridKeyHandler .formula-highlight-2{color:#bc2f32}.ewa-fb-fluent .ewa-rteLine .formula-highlight-2::selection{color:#ffcfe1}.ewa-fb-fluent .ewa-rteLine .formula-highlight-3,.ewa-gridKeyHandler .formula-highlight-3{color:#7c53ac}.ewa-fb-fluent .ewa-rteLine .formula-highlight-3::selection{color:#e9d4ff}.ewa-fb-fluent .ewa-rteLine .formula-highlight-4,.ewa-gridKeyHandler .formula-highlight-4{color:#0f700f}.ewa-fb-fluent .ewa-rteLine .formula-highlight-4::selection{color:#98ff87}.ewa-fb-fluent .ewa-rteLine .formula-highlight-5,.ewa-gridKeyHandler .formula-highlight-5{color:#bf0077}.ewa-fb-fluent .ewa-rteLine .formula-highlight-5::selection{color:#fcf}.ewa-fb-fluent .ewa-rteLine .formula-highlight-6,.ewa-gridKeyHandler .formula-highlight-6{color:#b5490f}.ewa-fb-fluent .ewa-rteLine .formula-highlight-6::selection{color:#ffda00}.ewa-fb-fluent .ewa-rteLine .formula-highlight-7,.ewa-gridKeyHandler .formula-highlight-7{color:#00758f}.ewa-fb-fluent .ewa-rteLine .formula-highlight-7::selection{color:#3df5e8}",
""]);y.exports=m},193:function(y,m,a){function c(va,mb){Object($c.d)(()=>{var Tb;const yc=va.getCellBounds(null===(Tb=va.yh(null))||void 0===Tb?void 0:Tb.cell,!0);yc&&(Tb=yc?new Sys.UI.Bounds(yc.x+yc.width,yc.y+yc.height,0,0):null)&&mb.oyb(["DatePickerFloatie"],Tb,Nb.a.ph)})}function b(va){const mb=Object(Ia.f)(va);va=Object(Wa.a)(va);var Tb=mb.Fp,yc=mb.cellTextEditBox.b2f;yc=mb.DA||yc&&va;va=e((yc?va:Tb).Xa.domElement);Tb=Gc.EwaSettings.isChangeGateEnabled("OfficeVSO:8597123_RemoveIndentationInFormulaBar");
Tb||(va.left+=12);if(yc)yc={top:0,left:0,right:innerWidth,bottom:innerHeight};else if(Tb&&(va.left+=12),yc=e(mb.domElement),Gc.EwaSettings.isChangeGateEnabled("OfficeVSO:7845089_fixFormulaAssistancePositoningInFreezePanes")&&mb.fh.vp&&(Tb=mb.fh,yc.top-=Tb.height,yc.left-=Tb.width),{zoom:Tb}=Object(zb.a)(),1!==Tb)for(var Nc of[va,yc])for(const zd in Nc)Nc[zd]*=Tb;return tb?(Nc=mb.wB(mb.ha.pa.activeCell),{target:va,bounds:yc,Kml:{top:Nc?Nc.top:0,bottom:Nc?Nc.bottom:0,zoomNumber:mb.PQ}}):{target:va,
bounds:yc}}function e(va){const {top:mb,left:Tb,right:yc,bottom:Nc}=va.getBoundingClientRect();return{top:mb,left:Tb,right:yc,bottom:Nc}}function k(va){switch(va.type){case Ee.a.NamedRange:return fd.DefinedNameInfoType.NamedRange;case Ee.a.Table:return fd.DefinedNameInfoType.Table;case Ee.a.Lambda:return fd.DefinedNameInfoType.Lambda;default:return fd.DefinedNameInfoType.Other}}function d(va){var mb;if(va){var Tb=new Ff(va.kind===fd.HighlightKind.CellRef);va=null===(mb=null===va||void 0===va?void 0:
va.rangeInfo)||void 0===mb?void 0:mb.positionKindInfo;if(!va)return Tb;Tb.soa=va.firstRow===fd.PositionKind.Absolute;Tb.roa=va.firstColumn===fd.PositionKind.Absolute;Tb.xya=va.secondRow===fd.PositionKind.Absolute;Tb.wya=va.secondColumn===fd.PositionKind.Absolute;return Tb}}function u(va,mb){return va===mb?{kind:"equal"}:{kind:"different",diff:xc.a.e8e(va,mb)}}function n(va){[va.clientResult,va.serverResult].forEach(mb=>{Object(Cc.c)(mb)||"success"!==mb.kind||(mb.value=xc.a.H4(mb.value),mb.unformattedValue=
xc.a.H4(mb.unformattedValue))})}function v(va,mb,Tb){if(va.has(mb))return va.get(mb);Tb=Tb();va.set(mb,Tb);return Tb}function f(va,mb,Tb,yc,Nc){if(!yc)return Nc();if(va.has(mb))return va.get(mb);yc=Nc();va.set(mb,yc);va.set(Tb,yc);return yc}function w(va){return JSON.stringify({text:va.text,index:va.index,length:va.length})}function r(va){return Object(Cc.c)(va)?"Undefined text":""===va?"Empty text":null}function t(va){return"Failure"!==va.kind?{kind:"Success",value:{cell:{col:va.cell.FirstColumn,
row:va.cell.FirstRow},value:l(va),formatted:va.format}}:{kind:"Failure",reason:{cell:{col:va.cell.FirstColumn,row:va.cell.FirstRow,cols:va.cell.LastColumn-va.cell.FirstColumn+1,rows:va.cell.LastRow-va.cell.FirstRow+1},kind:va.value.toString(),innerKind:"Unknown"}}}function l(va){if("ExcelAppError"===va.kind)return{kind:8,type:va.value};switch(typeof va.value){case "number":return{kind:1,_valueXL:va.value};case "string":return{kind:2,value:va.value};case "boolean":return{kind:4,_valueXL:va.value?1:
0}}}function x(va){const mb=/^ROW\(\) [-+] ROW\(\w+\)( [-+] \d+)?$/;return/^ROW\(\) [-+] \d+$/.test(va)||"ROW()"===va||Gc.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaByExampleReferenceRowFormula",!1)&&mb.test(va)}function A(va,mb,Tb){if(va===mb)return Tb;if(mb.textContent!==mb.parentElement.textContent)for(;null!==mb.previousSibling;)mb=mb.previousSibling,Tb+=mb.textContent.length,"div"===mb.nodeName.toLowerCase()&&(Tb+=1);return A(va,mb.parentElement,Tb)}function z(va){return null!==
va&&void 0!==va?va:"cache"}function F(va){return Object(Cc.b)(va)&&Object(Cc.b)(va.FormulaInfo)&&Object(Cc.b)(va.FormulaInfo.Formula)&&(1===va.FormulaInfo.FormulaType||2===va.FormulaInfo.FormulaType)&&1<va.FormulaInfo.Formula.length&&va.FormulaInfo.Formula!==va.Text}function D(va){return{["formula"]:va.FormulaInfo.Formula,["formulaTokens"]:va.FormulaInfo.Formula,["formulaType"]:va.FormulaInfo.FormulaType,["value"]:va.Text,["unformattedValue"]:va.Value,["valueType"]:va.ValueType,["hasError"]:va.HasError,
["ifmt"]:va.Ifmt,["ifmtStamped"]:va.IfmtStamped,["row"]:va.Row,["col"]:va.Col}}function G(va,mb){return va===mb?{kind:"equal"}:Object(Cc.c)(va)&&Object(Cc.c)(mb)?{kind:"empty",source:"both"}:Object(Cc.c)(va)||Object(Cc.c)(mb)?{kind:"empty",source:Object(Cc.c)(va)?"cse":"immediate"}:{kind:"different",diff:xc.a.e8e(va,mb)}}function Q(va){return xo(function*(){const mb=yield la.a.resolve(db.Dc),Tb=Qb.Range.yi(va.row,va.col);return Object.assign({},va,{formula:mb.anonymize(va.formula,Tb),formulaTokens:xc.a.H4(va.formulaTokens),
value:xc.a.H4(va.value),unformattedValue:xc.a.H4(va.unformattedValue)})})}function O(va){if(Object(Cc.b)(va)&&Object(Cc.b)(va.table)&&Object(Cc.b)(va.table.interpretations)){var mb={sheetId:va.table.analyzedRange.sheetId,analyzedRange:Object(Fc.hb)(va.table.analyzedRange.range),interpretations:va.table.interpretations.toArray().map(J)};a:{switch(va.metadataState){case 2:va=fd.RecognizedTablesMetadataState.Valid;break a;case 4:va=fd.RecognizedTablesMetadataState.Invalid;break a;case 6:va=fd.RecognizedTablesMetadataState.All;
break a}va=void 0}mb={rangeTableInfo:mb,metadataState:va}}else mb=null;return mb}function J(va){if(va){var mb=Object(Fc.hb)(va.tableLocation);var Tb=va.confidence,yc=va.headerRowCount,Nc=va.headerColumnCount;a:{switch(va.orientation){case 0:va=fd.TableOrientation.none;break a;case 1:va=fd.TableOrientation.rowMajor;break a;case 2:va=fd.TableOrientation.columnMajor;break a}va=void 0}mb={tableLocation:mb,confidence:Tb,headerRowCount:yc,headerColumnCount:Nc,orientation:va}}else mb=null;return mb}function H(va,
mb,Tb){const yc=va.UC,Nc=va.Sba();va.QNa(()=>{const zd=va.UC-yc,fe=va.Sba(),Ud=Nc===fe,P=[],Da=Gc.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.FbeEcsMismatchesMaxExamplesPerLog",5);let eb=0;for(const gd of mb){if(P.length>=Da)break;var bc=va.yh(gd.range);if(!bc){eb++;continue}const nd=gd.text,Vd=gd.value,ie=Yd[gd.kind],vd=bc.text,Sd=bc.Qn.value;bc=md[bc.Qn.type];if(nd===vd)var Pc=ke.NoMismatch;else Pc=/^#+$/.test(vd),Pc=/^#+$/.test(nd)||Pc?Vd===Sd?ke.NoMismatch:ke.HashesValueMismatch:ke.Mismatch;
Pc!==ke.NoMismatch&&P.push({["cseText"]:xc.a.g0(nd),["cseValue"]:xc.a.g0(Vd),["cseKind"]:ie,["ecsText"]:xc.a.g0(vd),["ecsValue"]:xc.a.g0(Sd),["ecsType"]:bc,["isHashesValue"]:Pc===ke.HashesValueMismatch,["areValuesEqual"]:Vd===Sd})}0<P.length&&ub.ULS.sendTraceTag(67707660,0,20,"ECS mismatch detected! "+JSON.stringify({["flowId"]:Tb,["stateIdDiff"]:zd,["isSameRequestId"]:Ud,["requestIdBeforeEvent"]:Nc,["requestIdAfterEvent"]:fe,["correctCellsCount"]:mb.length-P.length,["cellsWithMismatchCount"]:P.length,
["mismatches"]:P}));0<eb&&ub.ULS.sendTraceTag(508704130,0,50,"FormulaByExampleEcsMismatchDetection:checkForEcsMismatch: "+eb+" cells not loaded. flowId: "+Tb)})}function N(va){return Qb.Range.yi(va.row+1,va.col+1)}function L(va,mb){va=1===va.Qn.type?parseFloat(va.Qn.value):va.Qn.value;return Df(mb)===va}function Z(va){return"Table"===va.kind?va.formula:va.LJd}function ba(va,mb,Tb){if(va===mb)return!0;if(!va||!mb||va.kind!==mb.kind||va.sB!==mb.sB||va.FDe!==mb.FDe||va.source.trigger!==mb.source.trigger)return!1;
switch(va.kind){case "Success":return Tb?K(va,mb):va.value===mb.value&&va.index===mb.index&&va.length===mb.length&&va.color===mb.color;case "Loading":return va.index===mb.index&&va.length===mb.length;default:return va}}function K(va,mb){return va.sB===mb.sB&&va.index===mb.index&&va.length===mb.length}function E(va,mb,Tb){if(va===mb)return Tb;if(mb.textContent!==mb.parentElement.textContent)for(;null!==mb.previousSibling;)mb=mb.previousSibling,Tb+=mb.textContent.length,"div"===mb.nodeName.toLowerCase()&&
(Tb+=1);return E(va,mb.parentElement,Tb)}function U(va,mb){return va.text===mb.text&&va.index===mb.index&&va.length===mb.length}a.r(m);var X={};a.r(X);a.d(X,"CellAutoCompleteControl",function(){return Ic});var ia={};a.r(ia);a.d(ia,"CellAutoCompleteReadoutHandler",function(){return Zc});var Ma={};a.r(Ma);a.d(Ma,"DatePickerCommandHandler",function(){return Vc});var qa={};a.r(qa);a.d(qa,"DatePickerControl",function(){return Nd});var Ha={};a.r(Ha);var ha={};a.r(ha);a.d(ha,"FormulaAssistanceManager",function(){return Uf});
var La={};a.r(La);a.d(La,"FormulaAssistanceReadoutHandler",function(){return sf});var fa={};a.r(fa);a.d(fa,"FormulaAssistanceValuePreviewCommandHandler",function(){return tc});var ja={};a.r(ja);a.d(ja,"FormulaAssistanceValuePreviewRequester",function(){return qd});var ta={};a.r(ta);var Ka={};a.r(Ka);var Ga={};a.r(Ga);a.d(Ga,"FormulaByExampleCardUIControl",function(){return Kd});var Na={};a.r(Na);a.d(Na,"FormulaByExamplePluginTriggersManager",function(){return Ie});var cb={};a.r(cb);a.d(cb,"FormulaByExamplePluginValidator",
function(){return He});a.d(cb,"FormulaByExamplePluginValidatorProxy",function(){return hf});var jb={};a.r(jb);var Sa={};a.r(Sa);a.d(Sa,"FormulaByExampleSignalLocksManager",function(){return Jf});var bb={};a.r(bb);a.d(bb,"FormulaColumnPreviewManager",function(){return vf});var oa={};a.r(oa);a.d(oa,"FunctionInfoManager",function(){return qc});var ka={};a.r(ka);a.d(ka,"GotoCtrlClick",function(){return Pb});var ya={};a.r(ya);var Oa={};a.r(Oa);a.d(Oa,"KeptTelemetryHandler",function(){return Za});var za=
{};a.r(za);a.d(za,"SetCellEstimationPrefetcher",function(){return Wc});var ea=a(127),Aa=a(0),ub=a(15),rb=a(95),Ja=a(266),Xa=a(7),Y=a(13),Ia=a(23),$a=a(6);class Ea extends Ja.a{constructor(va,mb){super(document.createElement("div"));this.W1=this.Tvc=this.HOb=this.IOb=this.Xvc=this.JOb=!1;this.$T=null;this.visible=void 0;this.zoom=null;this.$$d=(Tb,yc)=>{this.Vy(Tb,yc)};this.W0a=()=>{this.ej.Xa.eN=!0};this.VNa=()=>{this.autoComplete(!0)};this.sig=()=>{this.ej.Xa.focus()};this.onActiveCellChanged=()=>
{Ia.f(this.$).inRangePicker||(this.An=!1)};this.$=va;this.zoom=mb;Ia.f(va)&&Ia.f(va).ha&&Ia.f(this.$).ha.add_activeCellChanged(this.onActiveCellChanged)}get zoomManager(){return this.zoom.zoomManager}get uN(){return this.OI.uN}get An(){return this.OI.An}set An(va){this.OI.An=va}get ej(){return this.$T}set ej(va){(this.$T=va)&&this.$T.fDe.add(this)}get_visible(){return void 0!==this.visible?this.visible:this.visible=super.get_visible()}set_visible(va){if(this.visible===va)return va;this.visible=va;
return super.set_visible(va)}Vy(){this.uRa(!1);this.OI.Vy()}dispose(){this.$&&Ia.f(this.$)&&Ia.f(this.$).ha&&Ia.f(this.$).ha.remove_activeCellChanged(this.onActiveCellChanged);this.$=null;super.dispose()}Iq(va,mb,Tb){va=!1;if((this.MNb||(void 0===Tb?0:Tb))&&!this.Vob()&&this.get_visible()&&this.An)switch(this.IAe(mb),mb){case 1872288872:this.An=!1;va=!0;break;case -798660877:this.OI.SH(1);va=!0;break;case 137938150:this.OI.SH(-1);va=!0;break;case 2091832999:this.OI.SH(this.uN-1);va=!0;break;case 742457698:this.OI.SH(-(this.uN-
1));va=!0;break;case 125627505:va=this.autoComplete(!1);break;case 267796030:va=this.autoComplete(!1)}return va}uRa(va){if(this.An||va){var mb=Ia.f(this.$);va=this.$T.Xa.domElement;var Tb=this.zoomManager.Zm(va.offsetHeight),yc=this.zoomManager.Zm(va.offsetTop);va=this.zoomManager.Zm(va.offsetLeft);var Nc=mb.DA,zd=$a.AFrameworkApplication.ra&&$a.AFrameworkApplication.ra.$g.Zk;mb=$get(this.$.xi+Xa.a.ksc,this.$.domElement);zd&&(mb=document.getElementById("EditorContainer"));var fe=new Sys.UI.Point(Nc?
this.OI.HJd:0,Nc?-5:Ea.E2i);Tb=mb.offsetTop+fe.y+(Nc?0:Tb+yc);this.$.Eoa||(yc=$get(Xa.a.OGa,this.$.domElement),Tb+=yc&&!zd?yc.offsetHeight:0);yc=this.domElement;yc.style.top=Y.HelperMethods.Li(Tb);yc.style.left=Y.HelperMethods.Li(mb.offsetLeft+va+fe.x)}}S$b(va){this.OI&&(va&&!this.W1?(this.OI.Gla(this.sig),this.OI.Dnc(this.W0a),this.OI.gJb(this.VNa),this.W1=!0):this.W1&&(this.OI.Aqa(this.sig),this.OI.FVc(this.W0a),this.OI.l6b(this.VNa),this.W1=!1))}IAe(va){switch(va){case -798660877:case 137938150:case 2091832999:case 742457698:this.JOb=
!0;break;case 125627505:this.IOb=!0;break;case 267796030:this.HOb=!0}}}Ea.HJd=0;Ea.E2i=1;Object(Aa.a)(Ea,"AutoCompleteControl",Ja.a,[219]);var Lb=a(10);class Ib extends Sys.EventArgs{constructor(va,mb,Tb,yc){mb=void 0===mb?0:mb;Tb=void 0===Tb?"":Tb;yc=void 0===yc?"":yc;super();this.length=va;this.selectedIndex=mb;this.tQ=Tb;this.description=yc}}Object(Aa.a)(Ib,"ListEventArgs",Sys.EventArgs,[]);class Mb{constructor(va,mb){this.bjh=va;this.ajh=mb}get Oua(){return this.bjh}get htd(){return this.ajh}}
Object(Aa.a)(Mb,"CellAutoCompleteItem",null,[375]);var mc=a(1275),jc=a(564),Fc=a(46),Gc=a(1),xc=a(28);class Uc extends mc.a{constructor(va,mb,Tb){super(va,mb);this.xy=null;this.zLc=0;this.sda=this.Iqb=null;this.INa=(yc,Nc)=>{if(yc=this.xy.items)if(1===yc.length&&this.xy.MNb.length<yc[0].Oua.length&&this.xy.kLa&&xc.a.mI(yc[0].Oua,this.xy.MNb)&&(Nc.newValue=yc[0].Oua),this.ej&&Gc.EwaSettings.Na(128)){let zd=-1;1<yc.length?zd=this.xy.pDc(this.ej.text,!0):1===yc.length&&(this.xy.kLa||this.xy.gFc)&&(zd=
0);if(0<=zd&&yc.length>zd&&yc[zd].htd){const fe=Fc.G(yc[zd].htd);fe&&Ia.f(this.$).oh.cMa(fe)&&(Nc.KYf=!0,Nc.bff=yc[zd].htd)}}};this.S2b=()=>{this.xy.kLa=!1};this.ej.RIb(this.INa);this.xy=Tb;this.sda=this.ml.Wk(this.ej.Xa.domElement);this.sda.Ga("mousedown",this.S2b)}get BHc(){return!1}get VLa(){return this.xy.An}set VLa(va){this.xy.An=va}get HFc(){return!1}get key(){return jc.a.cwd}dispose(){this.ej.xVc(this.INa);super.dispose()}mva(va){va&&!this.xy.An||super.mva(va)}Iq(va,mb){this.xy.ej=this.ej;
this.zLc=va.keyCode;if(this.ej.isEditing){const Tb=this.ej.text;xc.a.equals(this.Iqb,Tb,!1)||(this.Iqb=Tb)}else this.Iqb=null;if(237279923===mb)return this.xy.An=!1;Gc.EwaSettings.Na(128)&&17===this.zLc&&this.xy.kLa&&(this.xy.gFc=!0);return super.Iq(va,mb)}tig(){var va;if(!Gc.EwaSettings.isChangeGateEnabled("OfficeVSO:5172529_CheckForShuttingDownInAutocompletionTimedCallback")||!$a.AFrameworkApplication.Vl)if(this.xy.ej=this.ej,this.xy.kLa=!1,this.ej.isEditing){const mb=!xc.a.equals(this.Iqb,this.ej.text,
!0),Tb=this.ej.cXd;Tb||!mb&&229!==this.zLc?Tb&&(this.xy.An&&(this.xy.An=!1),null===(va=this.xy.K3a)||void 0===va?void 0:va.cancel()):this.xy.YKh(this.zLc)}else this.Iqb=null}Jn(){}im(){this.VLa=!1;this.xy.set_visible(!1);this.Iqb=null;this.xy.kLa=!1;this.xy.gFc=!1;this.xy.K3a&&this.xy.K3a.cancel()}Jzg(va,mb){return this.xy.Iq(va,mb)}}Object(Aa.a)(Uc,"CellAutoCompleteListAutoCompleteBehavior",mc.a,[]);var Pa=a(37),Bb=a(1108),Nb=a(63),oc=a(16),aa=a(139),rc=a(1129);class yb extends Bb.a{constructor(va,
mb){super(va,mb,new rc.a("list-item","list-item-selected","list-table","list-table-touch"));this.VDc=!1;this.QGb=this.Z5=null;this.dDf=!1;this.visible=void 0;this.JQa(!0);this.dDf=Gc.EwaSettings.isChangeGateEnabled("OfficeVSO:5893822_FixFormulaBarXOffsetCrash")}get HJd(){const va=document.getElementById(this.$.xi+Xa.a.FJd);return!this.dDf||va?oc.DOMElementExtensions.getBoundingClientRect(va).x:0}get jm(){return this.QGb}set jm(va){this.QGb=va}get An(){return void 0!==this.visible?this.visible&&0<
this.Z5.length:(this.visible=oc.DOMElementExtensions.isVisible(this.hn))&&0<this.Z5.length}set An(va){this.visible!==va&&(oc.DOMElementExtensions.setVisible(this.hn,va),oc.DOMElementExtensions.setVisible(this.yzb,va),this.visible=va);const mb=Ia.f(this.$).view;va?this.VDc||(mb.uz(this.gtd.$$d),this.VDc=!0):(this.Z5.length=0,this.VDc&&(mb.gy(this.gtd.$$d),this.VDc=!1))}jOc(){var va=460;const mb=Ia.f(this.$);var Tb=mb.domElement,yc=this.yzb.style;const Nc=this.hn.offsetTop+this.fv.offsetHeight*this.fv.sectionRowIndex-
this.hn.scrollTop;yc.width="auto";yc.whiteSpace="nowrap";yc.position="absolute";const zd=Tb.offsetLeft+Tb.offsetWidth-(this.domElement.offsetLeft+this.hn.offsetLeft+this.hn.offsetWidth+3);Tb=this.domElement.offsetLeft-3-(Tb.offsetLeft+this.HJd);va=Math.min(this.yzb.offsetWidth,va,Math.max(zd,Tb));oc.DOMElementExtensions.tI(this.yzb,va);yc.whiteSpace="";yc.position="absolute";Nc+3>this.hn.offsetTop+this.hn.offsetHeight||Nc<this.hn.offsetTop||(va=this.hn.offsetLeft-3-this.yzb.offsetWidth,yc=this.hn.offsetLeft+
this.hn.offsetWidth+3,oc.DOMElementExtensions.updatePosition(this.yzb,Tb>zd!==mb.rtl?va:yc,Nc,!1))}SH(va){super.SH(va);this.jOc()}Vy(){this.jOc()}UVa(){const va=this.tr,mb=this.hn,Tb=3===Nb.a.ph||Pa.a.Oy,yc=Tb?this.gNa:this.uN;this.An=!0;mb.style.height="auto";this.gtd.set_visible(!0);this.HIb(va,Tb);this.Z5.length>yc&&(oc.DOMElementExtensions.KW(mb,Math.floor(mb.offsetHeight*yc/this.Z5.length)),mb.style.overflowY="auto");oc.DOMElementExtensions.tI(mb,va.offsetWidth+(this.Z5.length>yc?aa.a.Ex:0))}}
Object(Aa.a)(yb,"AutoCompleteListBox",Bb.a,[]);class Fb extends yb{constructor(va,mb,Tb,yc){super(va,mb);this.tkc=null;this.Bi=Tb;this.xy=yc;this.Z5=[]}get fv(){return this.tkc}set fv(va){this.n$a(this.fv);this.tkc=va;const mb=this.n$a(this.fv);this.jm=va?mb.innerText:null;this.ooe(va)}get An(){return super.An}set An(va){super.An=va;va||(this.fv=null)}get yzb(){return null}get gtd(){return this.xy}dispose(){super.dispose();this.tkc=null}FZk(va){this.sCa(!1);const mb=document.createElement("table");
mb.classList.add(this.Eza);mb.GKh=Xa.a.UGa;const Tb=document.createElement("tbody");for(let yc=0,Nc=this.Z5.length;yc<Nc;yc++){const zd=document.createElement("tr"),fe=document.createElement("td");fe.classList.add(this.J3a);const Ud=document.createElement("span");Ud.classList.add(Fb.dwd);Ud.setAttribute(Xa.a.P7e,va[this.Z5[yc]].Oua);Ud.innerText=va[this.Z5[yc]].Oua;fe.appendChild(Ud);zd.appendChild(fe);Tb.appendChild(zd)}mb.appendChild(Tb);this.Bi.wM(this.hn);this.hn.appendChild(mb);this.tr=oc.DOMElementExtensions.Cw(this.domElement,
this.Eza);this.sCa(!0);this.UVa()}Wwi(va,mb){if(va&&va.length){var Tb=[];if(mb)for(let yc=0,Nc=va.length;yc<Nc;yc++)xc.a.mI(va[yc].Oua,mb)&&Tb.push(yc);this.Z5=Tb;this.FZk(va)}else this.An=!1,this.tkc=null}jOc(){}XSh(va,mb,Tb){let yc=Math.min(va,Math.max(200,Tb));mb&&va<Tb&&(yc+=aa.a.Ex);oc.DOMElementExtensions.tI(this.hn,yc);mb&&(yc-=aa.a.Ex);return yc}UVa(){super.UVa();var va=oc.DOMElementExtensions.Cw(this.get_element(),this.Eza),mb=this.Z5.length>this.uN,Tb=Ia.f(this.$);if(Tb=Tb.yh(Tb.ha.pa.activeCell))for(va=
this.XSh(va.offsetWidth,mb,Tb.width),mb=this.hn.getElementsByClassName(Fb.dwd),Tb=0;Tb<mb.length;Tb++)mb[Tb].style.maxWidth=Y.HelperMethods.Li(va);else ub.ULS.sendTraceTag(537167964,0,15,"CellAutoCompleteListBox.AdjustHeightAndWidth: Can't retrive FormattedCell of the Current Active Cell.")}onItemClick(va){if(va=super.onItemClick(va)){const mb=Ia.f(this.$);mb.Xz(!1);mb.focus()}return va}}Fb.dwd="ewa-suggested-cell-name";Object(Aa.a)(Fb,"CellAutoCompleteListBox",yb,[]);var Qb=a(27),ac=a(73),Wa=a(142),
Gb=a(187),Ub=a(54),Ra=a(42),Rb=a(328),ib=a(19),la=a(92),db=a(5),$b;let Ic=$b=class extends Ea{constructor(va,mb,Tb,yc,Nc){super(va,Nc);this.OSa=null;this.bwd=[];this.gFc=this.kLa=!1;this.PSe=this.ft=null;this.Ssf=()=>{this.Q$.Wwi(this.items,this.OSa);this.raiseEvent("ACLBUpdated",new Ib(this.items.length));this.show()};a(1478);this.Qj=mb;this.domElement.className="ewa-ac";mb=document.createElement("div");mb.classList.add("ewa-lb");mb.classList.add(ib.a.yH);mb.id="suggested_cells_list_box";this.domElement.appendChild(mb);
oc.DOMElementExtensions.setVisible(this.domElement,!1);Rb.d(this.style,this.$.isChromeRtl);this.aff=$get("suggested_cells_list_box",this.domElement);this.Q$=new Fb(this.$,this.aff,Tb,this);this.S$b(!0);this.$.domElement.appendChild(this.domElement);Wa.b(this.$,zd=>{this.hKb(va,zd)});this.hKb(va,Ia.f(va).Dh);this.ljj=Gc.EwaSettings.isChangeGateEnabled("OfficeVSO:8554518_ChangeHandleKeyDownConditionOrder");yc.Ga(this)}eqd(va){this.addHandler("ACLBUpdated",va)}eke(va){this.removeHandler("ACLBUpdated",
va)}cx(va){this.addHandler("ACLBSelectionChanged",va)}Bx(va){this.removeHandler("ACLBSelectionChanged",va)}$Dh(va){this.addHandler("ACLBMatchedItem",va)}$ok(va){this.removeHandler("ACLBMatchedItem",va)}get OI(){return this.Q$}get MNb(){return this.OSa}get jm(){return this.Q$.jm}get items(){return this.ft}get K3a(){return this.PSe}get activeCell(){return Ia.f(this.$).ha.pa.activeCell}QZg(va){for(let mb=0;mb<va.length;mb++)if(xc.a.isLetter(va.charCodeAt(mb)))return!0;return!1}Vob(){return!this.items}dispose(){if(this.$){this.S$b(!1);
const va=Ia.f(this.$);va&&va.view.gy(this.$$d)}rb.a.gj([this.Q$,this.K3a]);rb.a.gj(this.bwd);this.bwd=this.aff=this.Q$=this.ej=null;super.dispose()}Iq(va,mb){let Tb=!1;if(this.vNk())switch(mb){case -798660877:if(1===this.items.length&&this.jm)break;this.OI.SH(1);this.raiseEvent("ACLBSelectionChanged",new Ib(this.items.length,this.pDc(this.jm),this.jm));Tb=this.autoComplete(!1);break;case 137938150:if(1===this.items.length&&this.jm)break;this.OI.SH(-1);this.raiseEvent("ACLBSelectionChanged",new Ib(this.items.length,
this.pDc(this.jm),this.jm));Tb=this.autoComplete(!1);break;case 2091832999:this.OI.SH(this.uN-1);Tb=this.autoComplete(!1);break;case 742457698:this.OI.SH(-(this.uN-1));Tb=this.autoComplete(!1);break;case 125627505:this.ej.Xa.caretPosition=this.ej.text.length;this.An=!1;Tb=!0;break;case 267796030:this.autoComplete(!0);break;default:Tb=super.Iq(va,mb)}return Tb}show(){this.items&&this.items.length&&(this.Q$.fv=this.jm?this.OI.tr.rows[this.pDc(this.jm)]:null,this.An=0<this.Q$.Z5.length,this.uRa(!0),
this.Q$.jOc())}YKh(va){const mb=!!this.ej&&!ac.f(this.$.la);this.gFc=this.kLa=!1;this.ej&&!this.ej.isEditing?this.set_visible(!1):mb&&!this.sci(this.activeCell)&&this.SRk(va)}sci(va){var mb;return null===(mb=la.a.lh(db.ub))||void 0===mb?void 0:mb.LDd(va)}autoComplete(va){if(!this.ej||!this.An)return!1;const mb=this.OSa;if(this.jm){var Tb=oc.DOMElementExtensions.Gga(oc.DOMElementExtensions.Cw(this.Q$.fv,Fb.dwd),Xa.a.P7e,"");const yc=Tb.substring(mb.length,Tb.length);va?this.ej.text=Tb:this.ej.insertTextAt(yc,
mb.length,this.ej.text.length)}Tb=Ia.f(this.$);Tb.DA&&(Tb=Tb.Dh,Tb.text=this.ej.text,Tb.setCaretPosition(this.ej.Xa.caretPosition));va?this.An=!1:this.ej.Xa.selectRange(mb.length,this.ej.text.length);return!0}pDc(va,mb){mb=void 0===mb?!1:mb;if(!this.Q$.tr)return-1;const Tb=this.Q$.tr.children[0],yc=Tb.children.length;let Nc;for(let zd=0;zd<yc;++zd)if(Nc=Tb.children[zd],xc.a.equals(Nc.innerText.trim(),va,mb))return zd;return-1}uyh(va,mb,Tb,yc,Nc,zd,fe){const Ud=Tb.originalText.replace($b.lgg,String.fromCharCode(32)),
P=new Qb.Range(va.top-1,va.left,va.bottom-1,va.right,!1,!1),Da=fe?fe.Fy(Tb.range):null;(!Tb.LH||Tb.range.left===va.left)&&1<Ud.length&&!yc.mh(Ud.toUpperCase())&&xc.a.mI(Ud,mb)&&!xc.a.equals(Ud,mb,!0)&&!$b.rBf(mb)&&this.QZg(Ud)&&(!Nc&&!Da||!Nc&&Da.equals(fe.Fy(P))||Nc&&Tb.range.$i(zd)&&Tb.range.top!==zd.top)&&(va=Tb.formulaBarText,xc.a.equals(va,Tb.text,!1)||!va)&&(va={},va.FirstRow=Tb.range.top-1,va.FirstColumn=Tb.range.left-1,Tb=new Mb(Ud,va),yc.add(Ud.toUpperCase(),Tb))}SRk(va){this.ft=this.cZi();
this.K3a&&this.K3a.cancel();0<this.ej.text.length&&0!==va?this.items&&((1<this.items.length||this.An)&&this.Aji(),8!==va&&127!==va&&46!==va&&(1===this.items.length?this.gaj():this.Q$.fv&&this.autoComplete(!1))):this.An=!1}Aji(){this.An?this.Ssf():this.PSe=Gb.AsyncMethodContext.AC(this.Ssf,500,Ub.a.IVh,this.K3a)}gaj(){ub.ULS.shipAssertTag(537167966,0,!this.Vob()&&1===this.items.length,"Invalid Items");const va=this.items[0].Oua,mb=this.ej.text,Tb=va.substring(mb.length,va.length);0<Tb.length&&(this.ej.appendText(Tb),
this.ej.Xa.selectRange(mb.length,this.ej.text.length),this.raiseEvent("ACLBMatchedItem",new Ib(this.items.length,0,va)),this.kLa=!0)}cZi(){this.ft=null;const va=new Ra.a(!1);var mb=this.activeCell;this.OSa=this.ej.text.replace($b.lgg,String.fromCharCode(32));const Tb=this.Qj.Fy(mb),yc=mb.$i(Tb);if($b.rBf(this.OSa)||!this.QZg(this.OSa))return this.items;const Nc=new Qb.Range(1,mb.left,mb.top-1,mb.left,!1,!1);var zd=new Qb.Range(mb.top+1,mb.left,Lb.a.Ok,mb.left,!1,!1);let fe;const Ud=Ia.f(this.$);zd=
Ud.pt("CellAutoCompleteControl.GetSuggestedCells",zd);try{const P=Ud.pt("CellAutoCompleteControl.GetSuggestedCells2",Nc);try{for(const Da of[P,zd])for(;Da.$$mn();)fe=Da.$$cu(),this.uyh(mb,this.OSa,fe,va,yc,Tb,this.Qj)}finally{P&&P.dispose()}}finally{zd&&zd.dispose()}this.ft=Array(va.values.length);for(mb=0;mb<this.items.length;mb++)this.items[mb]=va.values[mb];this.items.sort((P,Da)=>P.Oua.localeCompare(Da.Oua));return this.items}hKb(va,mb){va&&mb&&this.bwd.push(new Uc(va,mb,this))}vNk(){return this.ljj?
this.MNb&&!this.Vob()&&this.An?this.get_visible():!1:this.MNb&&!this.Vob()&&this.get_visible()&&this.An}static get lgg(){return $b.zUe||($b.zUe=new RegExp(String.fromCharCode(160),"g"))}static rBf(va){va=0<va.length?va.charCodeAt(0):-1;return 35===va||61===va||43===va||45===va||64===va}};Ic.zUe=null;Ic=$b=Object(ea.__decorate)([Object(la.d)(db.M,{rk:"transient"}),Object(ea.__param)(0,Object(db.Ob)()),Object(ea.__param)(1,Object(db.yg)()),Object(ea.__param)(2,Object(db.rd)()),Object(ea.__param)(3,
Object(db.N)()),Object(ea.__param)(4,Object(db.dh)())],Ic);Object(Aa.a)(Ic,"CellAutoCompleteControl",Ea,[218,219,220,2]);var Tc=a(12);let Zc=class{constructor(va){this.lgb=null;this.aqg=(mb,Tb)=>{1<Tb.length&&(mb=Tc.a.instance.ia(858),this.ariaLiveNotifier.pCg(mb,Tb.length))};this.bqg=(mb,Tb)=>{ub.ULS.shipAssertTag(537167961,0,0<=Tb.selectedIndex&&0<=Tb.length&&Tb.selectedIndex<Tb.length,"Invalid ListEventArgs: SelectedIndex/Length");ub.ULS.shipAssertTag(537167960,0,!!Tb.tQ,"ListEventArgs: SelectedValue should not be null");
this.ariaLiveNotifier.Dgk(Tb.tQ,Tb.selectedIndex+1,Tb.length)};this.cqg=(mb,Tb)=>{this.ariaLiveNotifier.Fca(Tb.tQ)};this.ariaLiveNotifier=va}dispose(){this.pAe();this.lgb=null}Ga(va){va&&(this.lgb=va,va.eqd(this.aqg),va.cx(this.bqg),va.$Dh(this.cqg))}pAe(){this.lgb&&(this.lgb.eke(this.aqg),this.lgb.Bx(this.bqg),this.lgb.$ok(this.cqg))}};Zc=Object(ea.__decorate)([Object(la.d)(db.N),Object(ea.__param)(0,Object(db.l)())],Zc);Object(Aa.a)(Zc,"CellAutoCompleteReadoutHandler",null,[745,2]);var cc=a(212),
Yc=a(68);let Vc=class{constructor(va){this.zci=va}Ri(){return!1}executeCommand(va,mb){va=!1;mb=mb.command;switch(mb){case 1159342996:this.zci.L9b(!0),va=!0}return va?Yc.Task.Ua(!0):cc.a(mb)}Ei(va,mb){switch(mb.command){case 1159342996:return Gc.EwaSettings.isChangeGateEnabled("OfficeVSO:8841835_DatePickerEnabled");default:return!1}}dj(){return!1}};Vc=Object(ea.__decorate)([Object(la.d)(db.wb),Object(ea.__param)(0,Object(db.xb)())],Vc);Object(Aa.a)(Vc,"DatePickerCommandHandler",null,[36]);var wd=a(133),
wc=a(609),Ya=a(96),ob=a(1058),Cb=a(284),Wb=a(639),ad=a(163),$c=a(157),Ld=a(2),jd=a(326),Td=a(245),re;let Nd=re=class extends ob.a{constructor(va,mb,Tb,yc){var Nc,zd,fe;super(va,re.featureName);this.wHc=!1;this.PYa=()=>{this.wHc&&Object($c.d)(()=>{this.xK.pH();this.wHc=!1;this.qj.detach("scroll");this.da.view.gy(this.PYa)})};this.onActiveCellChanged=()=>{const Ud=this;return xo(function*(){Gc.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.DatePickerFloatie",!1)&&(Ud.PYa(),Td.a(()=>xo(function*(){!Ud.xK.Job()&&
(yield Object(Wb.b)(Ud.grid.yh(null)))&&(ub.ULS.sendTraceTag(508610529,0,100,"DatePickerControl.onActiveCellChanged: Date Picker Floatie is to be shown"),Ud.GVg())}),100)())})};this.GNa=(Ud,P)=>{const Da=this;return xo(function*(){Da.PYa();!Da.nOb&&(yield Object(Wb.a)(P))&&(ub.ULS.sendTraceTag(509147206,0,50,"DatePickerControl.onCellEditStarted: Encountered Date in cell, Date Picker service already available, showing date picker"),Da.bvc.start(),Da.L9b())})};this.FNa=()=>{this.iDd()};this.JA=()=>
{var Ud;Object(ad.g)(null===(Ud=this.grid.Dh)||void 0===Ud?void 0:Ud.text)&&this.iDd()};this.nEk=Ud=>{var P,Da=this.da.Dh,eb=this.da.yh(null);if(eb){var bc=null===(P=this.Mj)||void 0===P?void 0:P.config;if(!bc){this.Kme("DatePickerControl.SetCellDate: calc config unavailable",Da);return}Ud=excelOnlineCalc.date.dateTime(Ud.getFullYear(),Ud.getMonth()+1,Ud.getDate(),Ud.getHours(),Ud.getMinutes(),Ud.getSeconds(),0,Ud.getMilliseconds(),0);Ud=bc.datepack.toNum(bc,Ud);bc=bc.mathpack.toNumber(Ud);this.nOb=
!1;if(this.LXf||this.$.vha){Ud=this.xk.YOd(eb,{ValidMembers:32,NumberFormat:4});if(!Ud.success&&Ud.uNa){this.Kme(`DatePickerControl.SetCellDate: Conversion to ribbon number format failed, LogData:  ${`
            reason: ${Ud.reason},
            format: ${Ud.uNa}`}`,Da);return}eb=this.xk.wAi(bc.toString(),Ud.uNa,eb.cell.n5);if(!eb.success){this.Kme("DatePickerControl.SetCellDate:formatStringValueWithFormatString failed",Da);return}Da.text=eb.WM;this.LXf=!1}else Da.text=bc.toString();this.wHc?(Da=Object(Ld.a)(new jd.a,{Text:Da.text}),this.da.setCell(Da,this.da.ha.pa.activeRange,0,127,null),this.PYa()):Da.endEdit(!0,"DatePickerControl.SetCellDate",0);ub.ULS.sendTraceTag(509110228,0,50,"DatePickerControl.setCellDate: User selected Date using Date Picker")}this.Tia()};
this.Kme=(Ud,P)=>{ub.ULS.sendTraceTag(508956939,0,10,Ud);P.endEdit(!0,"DatePickerControl.SetCellDate Failed",0);this.Tia()};this.omi=()=>{this.bvc&&(this.bvc.stop(),ub.ULS.sendTraceTag(508823174,0,50,`DatePickerControl: Time taken to render DatePicker: ${this.bvc.Ci}`))};this.Tia=Ud=>{Object($c.d)(()=>{this.nOb=!1;wd.FocusManager.instance().ds(wc.AFrame.I0);Ya.a.rwb(oc.DOMElementExtensions.MSb(this.$.Dl),Nb.a.ph,Ud,this.$,this.da)})};this.fyg=()=>{wd.FocusManager.instance().ds(wc.AFrame.B2)};this.$=
va;this.da=Ia.f(this.$);this.Mj=mb;this.xk=Tb;this.xK=yc;null===(Nc=this.da.Dh)||void 0===Nc?void 0:Nc.Ox(this.FNa);null===(zd=this.da.Dh)||void 0===zd?void 0:zd.fM(this.GNa);null===(fe=this.da.Dh)||void 0===fe?void 0:fe.LVa(this.JA);this.da.ha.add_activeCellChanged(this.onActiveCellChanged);this.bvc=this.$.Eh.wm("DialogShown","DatePickerRender")}dispose(){var va,mb,Tb;this.iDd();this.PYa();null===(va=this.da.Dh)||void 0===va?void 0:va.HN(this.GNa);null===(mb=this.da.Dh)||void 0===mb?void 0:mb.Ow(this.FNa);
null===(Tb=this.da.Dh)||void 0===Tb?void 0:Tb.k7a(this.JA);this.da.ha.remove_activeCellChanged(this.onActiveCellChanged);super.dispose()}get el(){return Cb.a.Oof}GVg(){c(this.grid,this.xK);this.wHc=!0;this.da.view.uz(this.PYa);this.qj.Ga("scroll",this.PYa)}L9b(va){this.LXf=void 0===va?!1:va;this.prk(this.da.ha.pa.activeCell)}iDd(){this.nOb&&Object($c.d)(()=>{appChrome.hideDatePicker();this.nOb=!1})}prk(va){va=void 0===va?null:va;const mb=()=>{this.nyb(va,yc=>{appChrome.renderDatePicker(this.domElement,
yc.y,yc.x,yc.y+yc.height,yc.x+yc.width,!0,this.UHi(),this.nEk,this.Tia,this.fyg,this.yxb,this.da.rtl)});this.nOb=!0;this.omi()},Tb=()=>{Object($c.d)(()=>{mb()})};Object($c.a)()&&window.requestIdleCallback?window.requestIdleCallback(mb,{timeout:100}):Tb()}UHi(){var va,mb=new Date,Tb=null===(va=this.da.yh(null))||void 0===va?void 0:va.cell;if((null===Tb||void 0===Tb?0:Tb.cellValue)&&this.Mj.BZf(Tb.to)&&1===Tb.yD){va=this.Mj.config;Tb=parseInt(Tb.cellValue,10);if(!Tb||0>=Tb)return mb;mb=va.mathpack.fromNumber(Tb);
mb=va.datepack.fromNum(va,mb,0);mb=new Date(mb.yr,mb.mon-1,mb.dom)}return mb}Rs(){this.fyg()}nu(){this.Tia()}};Nd=re=Object(ea.__decorate)([Object(la.d)(db.xb),Object(ea.__param)(0,Object(db.Ob)()),Object(ea.__param)(1,Object(db.G)()),Object(ea.__param)(2,Object(db.zc)()),Object(ea.__param)(3,Object(db.gb)())],Nd);Object(Aa.a)(Nd,"DatePickerControl",ob.a,[2]);var uc=a(377),pc=a(84);Object(la.b)(db.Fc)(()=>xo(function*(){const va=yield la.a.resolve(db.Ob);return(mb,Tb,yc)=>{if(Tb||(void 0===yc?0:yc))a:if(Tb){if(mb&&
(!mb||mb.startsWith("http://")||mb.startsWith("https://"))){if(Gc.EwaSettings.Na(147)&&(Tb=la.a.lh(db.Af))&&Tb.Mra(mb))break a;Y.HelperMethods.Em(mb,"_blank",uc.a)}}else Y.HelperMethods.O7(va.SN,"XLWAEndUser_"+mb,va.NQ);else Tb=new pc.a(-859308420,Nb.a.ph,va.ji,0,null),va.Ia.qh(Tb,{[Nb.a.Pi]:Xa.a.NK,[Nb.a.hl]:"HelpID="+mb})}}));var Hd=a(25),wb=a(151),Xb=a(247);class Kb extends Sys.EventArgs{constructor(va,mb){super();this.functionName=va;this.BDf=mb}}Object(Aa.a)(Kb,"FormulaAssistanceFunctionChangedEventArgs",
Sys.EventArgs,[]);class Zb extends Sys.EventArgs{constructor(va){super();this.PNg=va}}Object(Aa.a)(Zb,"FormulaAssistanceSelectedParameterChangedEventArgs",Sys.EventArgs,[]);var Oc=a(306);class Cd{constructor(va,mb,Tb,yc,Nc){this.XGc=this.aXa=!1;this.$=va;this.formulaAssistanceUIControl=mb;this.UCf=Tb;this.Eoe=yc;this.yQf=void 0===Nc?null:Nc;this.XGc=Gc.EwaSettings.isChangeGateEnabled("OfficeVSO:6592066_FixAutoCompleteCardFocusBug")}get ap(){return this.aXa}set ap(va){this.aXa!==va&&(va?Oc.a(this.$).Wq(this):
Oc.a(this.$).fI(this),this.aXa=va)}get el(){return this.Eoe}get ij(){return this.formulaAssistanceUIControl.getRootElement(this.UCf)}Lp(va,mb){va=!1;mb||(Ia.f(this.$).Fp.Xa.eN=!0,va=this.formulaAssistanceUIControl.focus(this.UCf));return va}wq(va){const mb=this.ij;return!(void 0===mb||null===mb)&&oc.DOMElementExtensions.Co(mb,va)}Rs(){this.yQf&&this.yQf();const va=Ia.f(this.$).Fp.Xa;this.selection=va.selection;va.removeSelection()}nu(){Ia.f(this.$).Fp.Xa.selection=this.selection}dispose(){Oc.a(this.$).fI(this)}}
Object(Aa.a)(Cd,"FormulaAssistanceFocusManager",null,[42,2]);var Wd=a(17),ee=a(98),he=a(159),pe=a(308),Se=a(171);class Ta{constructor(va){this.kaa=va;this.H6=this.Use=this.Zv=!1;this.onKeyDown=mb=>this.H6||"Space"!==mb.code&&" "!==mb.key||!mb.altKey||!mb.ctrlKey?!1:(this.Cxc(),mb.stopPropagation(),mb.preventDefault(),!0);this.q3a=mb=>{if(!this.H6)return!1;if(mb.eventName===Wd.a.Wi){const Tb=mb.La.ctrlKey?1:mb.La.shiftKey?50:10;switch(mb.La.keyCode){case ee.a.eab:this.Yha(0,-Tb);break;case ee.a.mDa:this.Yha(0,
Tb);break;case ee.a.GRa:this.Yha(-Tb,0);break;case ee.a.EAb:this.Yha(Tb,0);break;case ee.a.r_:case ee.a.Au:this.Use=!0;break;default:return!1}}mb.eventName===Wd.a.qk&&this.Use&&this.sga(!0);mb.La.preventDefault();return!0};this.T3b=mb=>{if(!this.H6)return!1;mb.La.preventDefault();this.sga();return!0};this.onBlur=()=>{if(!this.H6)return!1;this.sga();return!0};this.UD=he.a.instance;this.Ode=pe.a.instance}Ga(va){(this.root=va)&&!this.Zv&&(this.root.addEventListener("keydown",this.onKeyDown,!0),this.Zv=
!0)}detach(){this.root&&this.Zv&&(this.root.addEventListener("keydown",this.onKeyDown,!0),this.Zv=!1)}Cxc(){this.root&&(this.kaa.isg("move",!0),this.root.focus(),this.H6=!0,this.Use=!1,this.cF(),this.o7d||this.vAd(),this.root.appendChild(this.o7d))}sga(va){this.H6&&(this.H6=!1,this.kaa.OSj(void 0===va?!1:va),this.tje(),this.Tie())}cF(){this.UD.capture(this.q3a,null);this.Ode.aE(Wd.a.Bj,this.root,this.T3b,!0);this.root.addEventListener("blur",this.onBlur)}Tie(){this.UD.releaseCapture();this.Ode.lE(Wd.a.Bj,
this.root,this.T3b,!0);this.root.removeEventListener("blur",this.onBlur)}tje(){var va;null===(va=this.o7d)||void 0===va?void 0:va.remove()}Yha(va,mb){const Tb=this.kaa.getPosition();Tb.x+=va;Tb.y+=mb;this.kaa.setPosition(Tb)}vAd(){this.o7d=Se.a(24,24,"ShapeQuadArrow_24x24x32","WACMoveArrowIcon",!0,"")}}Object(Aa.a)(Ta,"FormulaAssistanceMoveAdapter",null,[]);var Qa=a(390);class Ob{constructor(va){this.kaa=va;this.startOffset={x:0,y:0};this.cZg=!0;this.Zv=!1}voa(){return this.Zv&&!!this.handle}b5a(va){const mb=
this.kaa.getPosition();this.cZg=mb.renderDown;this.startOffset.x=mb.x-va.clientPoint.x;this.startOffset.y=mb.y-va.clientPoint.y;this.kaa.isg("drag");return!0}lAa(va){this.kaa.setPosition({x:va.clientPoint.x+this.startOffset.x,y:va.clientPoint.y+this.startOffset.y,renderDown:this.cZg});return!0}kAa(){}jAa(){}Ga(va,mb){this.handle=mb;this.root=va;this.handle&&(this.handle.style.cursor="move",Qa.a.instance.Kca(this.handle,this,!1),this.Zv=!0)}detach(){this.Zv&&this.handle&&(this.handle.style.cursor=
"",Qa.a.instance.Rja(this.handle,this),this.Zv=!1)}}Object(Aa.a)(Ob,"FormulaAssistanceDragAdapter",null,[813]);class Jb{get getPosition(){return this.nnh}get setPosition(){return this.nZe}constructor(va){this.formulaAssistanceTelemetryManager=va;this.Zv=!1;this.ipc=Gc.EwaSettings.isChangeGateEnabled("OfficeVSO:7376612_argumentAssistanceOrderedActionsTelemetry");this.$bc={[Jc.Drag]:0,[Jc.Move]:0};this.yeg=new Ta(this);this.Gsf=new Ob(this)}Ga(va,mb,Tb,yc){this.nnh=Tb;this.nZe=yc;this.yeg.Ga(va);this.Gsf.Ga(va,
mb);this.Zv=!0}detach(){this.Zv&&(this.Gsf.detach(),this.yeg.detach(),this.Zv=!1)}clear(){var va;null===(va=this.nZe)||void 0===va?void 0:va.call(this,null);this.detach();this.Ile()}isg(va,mb){this.$bc[va]++;if(void 0===mb?0:mb)this.jfe=document.activeElement}OSj(va){this.jfe&&((void 0===va||va)&&this.jfe.focus(),this.jfe=null)}Ile(){const va=this.formulaAssistanceTelemetryManager.Sla,mb=this.$bc[Jc.Drag],Tb=this.$bc[Jc.Move];0<mb&&(this.formulaAssistanceTelemetryManager.Cla("d"),this.ipc||(va.argumentAssistanceDragTotalCounter+=
mb),this.$bc[Jc.Drag]=0);0<Tb&&(this.formulaAssistanceTelemetryManager.Cla("m"),this.ipc||(va.argumentAssistanceMoveTotalCounter+=Tb),this.$bc[Jc.Move]=0)}}Object(Aa.a)(Jb,"FormulaAssistanceDragControl",null,[]);var Jc;(function(va){va.Drag="drag";va.Move="move"})(Jc||(Jc={}));Object(Aa.b)("FormulaAssistanceDragMode",Jc);var zb=a(117);const tb=Gc.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaAssistantMinifiedState",!1);var zc;(function(va){va[va.ArgumentAssistanceCard=0]="ArgumentAssistanceCard";
va[va.AutoCompleteMenu=1]="AutoCompleteMenu";va[va.ValuePreview=2]="ValuePreview"})(zc||(zc={}));class dd extends Ja.a{constructor(va,mb,Tb){super(dd.tKd());this.$=va;this.formulaAssistanceUIControl=mb;this.formulaAssistanceTelemetryManager=Tb;this.isExpanded=!0;this.y3a=this.UF=null;this.Uvc=this.FF=!1;this.qki=0;this.qsd=!1;this.setPosition=yc=>{this.formulaAssistanceUIControl.setFixedPosition(yc);this.formulaAssistanceUIControl.updatePosition(zc.ArgumentAssistanceCard)};this.getPosition=()=>this.formulaAssistanceUIControl.getPosition();
this.jpb=Gc.EwaSettings.hIc();this.Gj=()=>{this.visible=!1};this.onIsExpandedChange=yc=>{this.T$k(yc);yc?this.formulaAssistanceTelemetryManager.Cla("e"):this.formulaAssistanceTelemetryManager.Cla("c")};this.onDismissClick=()=>{this.dismiss();this.grid.Fp.Xa.focus()};this.cpe=yc=>{var Nc=this.$;yc=yc.functionName;const zd={};zd[Xa.a.QM]="ArgumentAssistanceCard";const fe={};fe.FunctionName=yc;zd[Xa.a.Kyc]=fe;Nc.oi(802602464,0,8,zd);this.formulaAssistanceTelemetryManager.Cla("gf")};this.Vy=()=>{this.formulaAssistanceUIControl.updatePosition(zc.ArgumentAssistanceCard)};
this.im=()=>{this.kaa.clear();this.W3k();this.qsd=!1};this.DGk();this.UF=new Cd(this.$,this.formulaAssistanceUIControl,zc.ArgumentAssistanceCard,Cb.a.TCf);this.grid=Object(Ia.f)(va);this.grid.view.uz(this.Vy);this.grid.ha.cx(this.Gj);this.kaa=new Jb(this.formulaAssistanceTelemetryManager);this.grid.cellTextEditBox.Ox(this.im)}BDh(va){this.addHandler("FAFunctionNameUpdated",va)}Eok(va){this.removeHandler("FAFunctionNameUpdated",va)}HFh(va){this.addHandler("FAParameterSelectionChangedOld",va)}uqk(va){this.removeHandler("FAParameterSelectionChangedOld",
va)}GFh(va){this.addHandler("FAParameterSelectionChanged",va)}tqk(va){this.removeHandler("FAParameterSelectionChanged",va)}get visible(){return this.FF}set visible(va){va||this.dismiss();this.FF=va}dismiss(){this.FF=!1;this.formulaAssistanceUIControl&&(this.kaa.detach(),this.formulaAssistanceUIControl.dismiss(this.domElement),this.y3a=null,this.UF.ap=!1)}show(va){this.FF=this.qsd=!0;va=this.oak(va);this.formulaAssistanceUIControl&&(this.formulaAssistanceTelemetryManager.EQa(["argumentAssistanceRender"]),
this.formulaAssistanceUIControl.renderArgumentAssistanceCard(this.domElement,va,()=>b(this.$)),this.btk(),this.r7j(va),this.kaa.Ga(this.formulaAssistanceUIControl.getCalloutElement(zc.ArgumentAssistanceCard),this.formulaAssistanceUIControl.getDraggableElement(zc.ArgumentAssistanceCard),this.getPosition,this.setPosition),this.jpb&&"Full"!==va.kind||(this.UF.ap=!0),this.formulaAssistanceTelemetryManager.O5(["argumentAssistanceRender"]),this.formulaAssistanceTelemetryManager.HPb("argumentAssistanceOverall"))}Iq(va,
mb){if(1872288872===mb){if(this.visible)return this.Uvc=!0;this.Uvc&&(this.formulaAssistanceTelemetryManager.Cla("2ndEsc"),this.Uvc=!1)}else this.Uvc=!1;return!1}v0a(va){return this.visible&&1872288872===va?(this.formulaAssistanceTelemetryManager.Cla("esc"),this.dismiss(),!0):!1}dispose(){this.$&&this.grid&&(this.grid.ha&&this.grid.ha.Bx(this.Gj),this.grid.view.gy(this.Vy),this.grid.cellTextEditBox.Ow(this.im));rb.a.gh(this.UF);this.$=null}oak(va){switch(va.kind){case "Minimal":return this.kak(va);
case "Full":return this.fak(va)}}kak(va){return{kind:"Minimal",functionRenderingInfo:va}}fak(va){const mb={kind:"Full",isExpanded:!1,callbacks:null,functionRenderingInfo:null};mb.functionRenderingInfo=va;mb.isExpanded=this.isExpanded;this.blk(mb);return mb}blk(va){va.callbacks={onIsExpandedChange:null,onHelpLink:null,onFeedback:null,onDismissClick:null};va.callbacks.onHelpLink=this.IOi(va.functionRenderingInfo);va.callbacks.onIsExpandedChange=this.onIsExpandedChange;va.callbacks.onFeedback=this.cpe;
Gc.EwaSettings.isChangeGateEnabled("OfficeVSO:8745608_FormulaAssistanceDismiss")&&(va.callbacks.onDismissClick=this.onDismissClick)}IOi(va){return()=>{void la.a.resolve(db.Fc).then(mb=>mb(va.helpID,va.isUDF));this.formulaAssistanceTelemetryManager.Cla("lm")}}DGk(){const va=wb.a.get(Xa.a.m$e);va?this.isExpanded="false"!==va:(this.isExpanded=dd.idi,this.formulaAssistanceTelemetryManager.UDk());this.formulaAssistanceTelemetryManager.VDk(this.isExpanded)}r7j(va){switch(va.kind){case "Minimal":this.t7j(va.functionRenderingInfo);
break;case "Full":this.o7j(va)}}t7j(va){var mb=va.functionName;if(this.y3a&&xc.a.equals(this.y3a,mb,!0)){mb="";const Tb=va.parameters.activeParam;0<=Tb&&Tb<va.parameters.params.length&&(mb=va.parameters.params[Tb]);this.raiseEvent("FAParameterSelectionChanged",new Zb([mb]))}else this.y3a=mb,va=va.parameters.params.join(", "),this.raiseEvent("FAFunctionNameUpdated",new Kb(mb,[va]))}o7j(va){var mb=va.functionRenderingInfo.functionName;this.y3a&&xc.a.equals(this.y3a,mb,!0)?(mb=Xb.a.map(va.functionRenderingInfo.signatures,
Tb=>{let yc="";0<=Tb.signatureParams.activeParam&&Tb.signatureParams.activeParam<Tb.signatureParams.params.length&&(yc=Tb.signatureParams.params[Tb.signatureParams.activeParam]);return yc}),this.raiseEvent("FAParameterSelectionChanged",new Zb(mb))):(this.y3a=mb,va=Xb.a.map(va.functionRenderingInfo.signatures,Tb=>Tb.signatureParams.params.join(", ")),this.raiseEvent("FAFunctionNameUpdated",new Kb(mb,va)))}T$k(va){this.isExpanded=va;try{wb.a.HG(Xa.a.m$e,va.toString(),wc.AFrame.bDa)}catch(mb){ub.ULS.sendTraceTag(512267714,
0,15,`Failed setting ArgumentAssistanceCardCollapseState cookie with error message: ${mb.message}`)}}static tKd(){return document.createElement("div")}btk(){const va=this.getPosition().renderDown?"rd":"ru";this.formulaAssistanceTelemetryManager.Cla(va)}W3k(){this.qsd&&2===++this.qki&&this.$.oi(953250532,-1,0,null)}}dd.idi=!0;Object(Aa.a)(dd,"FormulaArgumentAssistanceControl",Ja.a,[783]);var od=a(963),gb=a(161);const gc=[Object(gb.d)("featureNameField","FormulaSmartSuggestions"),Object(gb.d)("ver",
"1.0.0")],Dc={eventName:"Office.Excel.FormulaSmartSuggestions.Seen",eventFlags:od.a,dataFields:[...gc,Object(gb.a)("isFeatureSeen",!0)]},hd={eventName:"Office.Excel.FormulaSmartSuggestions.Tried",eventFlags:od.a,dataFields:[...gc,Object(gb.a)("isFeatureTried",!0)]},xd={eventName:"Office.Excel.FormulaSmartSuggestions.Succeeded",eventFlags:od.a,dataFields:[...gc,Object(gb.a)("isFeatureSucceeded",!0)]};var fd=a(659),kd;(function(va){va[va.Dismissed=0]="Dismissed";va[va.Smart=1]="Smart";va[va.Simple=
2]="Simple";va[va.Mixed=3]="Mixed"})(kd||(kd={}));Object(Aa.b)("UIState",kd);class Yb extends Ja.a{constructor(va,mb,Tb){super(Yb.tKd());this.$=va;this.formulaAssistanceUIControl=mb;this.formulaAssistanceTelemetryManager=Tb;this.qMa=Hd.a.IIc();this.UF=this.clearContentNotifier=this.ej=this.da=null;this.Vvc=this.Wvc=this.Tvc=this.HOb=this.IOb=this.Xvc=this.JOb=!1;this.zR=null;this.A8=0;this.vve=this.u0c=this.t9a=this.qhc=this.FF=!1;this.nbc=kd.Dismissed;this.onRestoreFocus=()=>{};this.dismiss=()=>
{this.FF=!1;this.apb&&this.t9a&&this.i2a&&(this.Vvc=!0);this.tAj();this.sha&&this.ej.isEditing&&this.kVc();this.formulaAssistanceUIControl&&(this.formulaAssistanceUIControl.dismiss(this.domElement),this.UF.ap=!1,this.nbc=kd.Dismissed)};this.W2i=()=>{this.raiseEvent("FAFocusOnSmartSuggestionsCard",null)};this.Esb=()=>{var yc;const Nc=this.da.ha.pa.selectedRanges,zd=null===(yc=this.formulaAssistanceTelemetryManager.OP)||void 0===yc?void 0:yc.Gq;Nc.some(fe=>fe.contains(zd))&&this.formulaAssistanceTelemetryManager.I2d++};
this.uAa=(yc,Nc)=>{0==Nc.zx&&(170==Nc.Xl.operation.operationName&&this.formulaAssistanceTelemetryManager.cMc++,this.$.userOperationManager.vu(this.uAa),this.HJc&&this.clearContentNotifier&&this.clearContentNotifier.wVc(this.Esb))};this.ebe=(yc,Nc)=>{0==Nc.zx&&(12==Nc.Xl.operation.operationName&&this.$.userOperationManager.qw(this.uAa),this.$.userOperationManager.vu(this.ebe))};this.kSj=()=>{this.dismiss();this.da.Fp.Xa.focus()};this.cpe=()=>{const yc={};yc[Xa.a.QM]=this.$tg?"SmartSuggestionsCard":
this.wve?"FunctionAndSmartSuggestionsCard":"SimpleAutoCompleteCard";this.$.oi(802602464,0,8,yc)};this.im=()=>{this.i2a&&this.EHh()};this.SQj=(yc,Nc)=>{this.rAb(Nc);this.Xvc=!0};this.Gj=()=>{this.visible=!1};this.RQj=yc=>{this.Tvc=!0;this.qyd(yc)};this.Bq=()=>{this.dismiss()};this.Vy=()=>{this.formulaAssistanceUIControl.updatePosition(zc.AutoCompleteMenu)};this.da=Ia.f(this.$);this.UF=new Cd(this.$,this.formulaAssistanceUIControl,zc.AutoCompleteMenu,Cb.a.WCf,this.W2i);this.da.view.uz(this.Vy);this.da.ha.cx(this.Gj);
this.$.sa.vn(this.Bq);this.i2a=Gc.EwaSettings.isChangeGateEnabled("OfficeVSO:5523443_FormulaSuggestionsCardUserInteractionTelemetry");this.apb=Gc.EwaSettings.isChangeGateEnabled("OfficeVSO:6650011_LogSuggestionsDismissal");this.HJc=Gc.EwaSettings.isChangeGateEnabled("OfficeVSO:7629619_RefiningKeptTelemetry");!this.qMa&&this.HJc&&this.$.qa.zi(313,yc=>{this.clearContentNotifier=yc});this.i2a&&this.da.cellTextEditBox.Ox(this.im)}zDh(va){this.addHandler("FACardOpened",va)}Cok(va){this.removeHandler("FACardOpened",
va)}vDh(va){this.addHandler("FAFocusOnSmartSuggestionsCard",va)}yok(va){this.removeHandler("FAFocusOnSmartSuggestionsCard",va)}yDh(va){this.addHandler("FormulaAutoCompleteShown",va)}Bok(va){this.removeHandler("FormulaAutoCompleteShown",va)}IFh(va){this.addHandler("SelectedRowChanged",va)}vqk(va){this.removeHandler("SelectedRowChanged",va)}eqd(va){this.addHandler("ListBoxUpdated",va)}eke(va){this.removeHandler("ListBoxUpdated",va)}dispose(){this.$&&(this.$.userOperationManager.vu(this.uAa),this.$.userOperationManager.vu(this.ebe),
this.da&&(this.da.ha&&this.da.ha.Bx(this.Gj),this.da.cellTextEditBox&&this.i2a&&this.da.cellTextEditBox.Ow(this.im),this.da.view.gy(this.Vy)),this.$.sa&&this.$.sa.Nn(this.Bq));this.HJc&&this.clearContentNotifier&&this.clearContentNotifier.wVc(this.Esb);rb.a.gh(this.UF);this.$=null}NCh(va){this.addHandler("CVIC",va)}Vnk(va){this.removeHandler("CVIC",va)}get visible(){return this.FF}set visible(va){va||this.dismiss();this.FF=va}get sha(){return this.qhc}get wve(){var va,mb;return(null===(mb=null===
(va=this.zR)||void 0===va?void 0:va.items[0])||void 0===mb?void 0:mb.type)===fd.SuggestionKind.Smart}get $tg(){return 1===this.zR.items.length&&this.wve}Iq(va,mb){if(!this.visible)return!1;this.IAe(mb);let Tb;return(Tb=this.r5i(mb)).qEc?Tb.result:this.wNk(mb)}v0a(va){if(!this.visible)return!1;let mb=!1;switch(va){case 1872288872:this.sha&&this.kVc();this.apb&&this.wve&&(this.formulaAssistanceTelemetryManager.O5(["autoCompleteSmartSuggestionActiveDismissing"]),this.Wvc=!0);this.visible=!1;mb=!0;break;
case -798660877:this.rAb(this.xTb(this.A8+1));mb=!0;break;case 137938150:this.rAb(this.xTb(this.A8-1));mb=!0;break;case 2091832999:this.rAb(this.xTb(this.A8+8));mb=!0;break;case 742457698:this.rAb(this.xTb(this.A8-8));mb=!0;break;case 125627505:case 267796030:this.qyd(this.zR.items[this.A8]),mb=!0}return mb}show(va){this.ej=this.da.Fp;this.FF=!0;this.A8=0;this.zR=va;0<this.zR.items.length&&(this.render(),this.rAb(this.xTb(this.A8)),this.apb?this.i2a&&(this.zR.items[0].type===fd.SuggestionKind.Smart?
(this.t9a||this.formulaAssistanceTelemetryManager.EQa(["autoCompleteSmartSuggestionActiveDismissing","autoCompleteSmartSuggestionAccepted"]),this.t9a=!0):this.t9a&&(this.Vvc=!0)):this.zR.items[0].type===fd.SuggestionKind.Smart&&this.i2a&&(this.t9a=!0));this.formulaAssistanceTelemetryManager.ssk(va.items)}kVc(){this.qhc=!1;this.ej.mDd()}wNk(va){return[1872288872,-798660877,137938150,2091832999,742457698,125627505,267796030].includes(va)}r5i(va){return this.sha?125627505===va||267796030===va?(this.qyd(this.zR.items[this.A8]),
{qEc:!0,result:!1}):!this.$tg||-798660877!==va&&137938150!==va?{qEc:!1}:{qEc:!0,result:!1}:{qEc:!1}}render(){this.formulaAssistanceTelemetryManager.EQa(["autoCompleteRender"]);this.formulaAssistanceUIControl&&(this.formulaAssistanceUIControl.renderAutoCompleteMenu(this.domElement,this.JNi(),()=>b(this.$)),this.vek(),this.UF.ap=!0,this.gmi())}gmi(){this.formulaAssistanceTelemetryManager.O5(["autoCompleteRender"]);this.formulaAssistanceTelemetryManager.HPb("autoCompleteOverall");const va=this.zR.items.some(Tb=>
Tb.type===fd.SuggestionKind.Smart),mb=this.zR.items.some(Tb=>Tb.type===fd.SuggestionKind.Simple);va&&mb?this.formulaAssistanceTelemetryManager.HPb("autoCompleteOverallSimpleAndSmart"):va?this.formulaAssistanceTelemetryManager.HPb("autoCompleteOverallSmartOnly"):mb&&this.formulaAssistanceTelemetryManager.HPb("autoCompleteOverallSimpleOnly")}vek(){const va=this.nbc;this.nbc=this.L_i(this.zR.items);va!==kd.Dismissed&&va!==kd.Smart||this.nbc!==kd.Simple&&this.nbc!==kd.Mixed||this.raiseEvent("FormulaAutoCompleteShown")}jfk(){var va;
if(0!==this.zR.items.length){var mb=0<=this.A8?this.A8:0,Tb=this.zR.items[mb];Tb={tQ:Tb.label,description:null!==(va=Tb.detail)&&void 0!==va?va:"",selectedIndex:mb+1,length:this.zR.items.length};this.raiseEvent("SelectedRowChanged",Tb)}}qyd(va){if(this.ej&&this.visible){var mb=va.textEdit;this.Vfj(this.ej.text,mb);this.ej.Xa.caretPosition=mb.range.start.character+mb.newText.length;Gc.EwaSettings.bkj()&&this.ej.dpe();this.sha&&(this.qhc=!1,this.i2a&&(this.apb&&this.formulaAssistanceTelemetryManager.O5(["autoCompleteSmartSuggestionAccepted"]),
this.vve=this.u0c=!0),this.qMa||this.XQg(),this.da.MIa.EDk(),this.ej.endEdit(!0,"FormulaAutoCompleteControl.CommitAutoCompletion",0),this.qMa&&this.XQg());this.visible=!1;this.raiseEvent("CVIC",{shouldRequestAutocompleteOnCommit:va.shouldRequestAutocompleteOnCommit});this.formulaAssistanceTelemetryManager.rsk(va.kind)}}XQg(){const va={Gq:this.da.ha.pa.activeCell,cellText:this.da.Dh.text,committed:!0,CIa:null};this.qMa?this.formulaAssistanceTelemetryManager.UGk(va):(this.formulaAssistanceTelemetryManager.OP=
va,this.formulaAssistanceTelemetryManager.H2d=this.$.sa.la.sheetId,this.formulaAssistanceTelemetryManager.bMc=this.$.fa.yk,this.$.userOperationManager.qw(this.ebe),this.HJc&&this.clearContentNotifier&&this.clearContentNotifier.Dpd(this.Esb))}EHh(){this.apb&&this.Vvc&&!this.Wvc&&!this.u0c&&(this.formulaAssistanceTelemetryManager.Rua.dismissSmartSuggestionImplicitlyCounter++,this.Vvc=!1);this.t9a&&(this.formulaAssistanceTelemetryManager.ZU.smartSuggestionShownCounter++,this.t9a=!1,Object(od.c)(Dc));
this.u0c&&(this.formulaAssistanceTelemetryManager.ZU.smartSuggestionSelectedCounter++,this.u0c=!1,Object(od.c)(hd));this.vve&&(this.formulaAssistanceTelemetryManager.ZU.smartSuggestionCommittedCounter++,this.vve=!1)}JNi(){const va={completionItems:this.zR.items,activeItemIndex:this.A8,callbacks:null};this.mkk(va);return va}mkk(va){va.callbacks={onCompletionItemSelected:null,onCompletionItemCommitted:null,onFeedback:null,onDismiss:null,onRestoreFocus:null};va.callbacks.onCompletionItemSelected=this.SQj;
va.callbacks.onCompletionItemCommitted=this.RQj;va.callbacks.onFeedback=this.cpe;va.callbacks.onDismiss=this.kSj;va.callbacks.onRestoreFocus=this.onRestoreFocus}Xak(va){this.qhc=!0;const mb=va.textEdit.newText;this.ej.T8(mb.substring(this.ej.text.length-va.textEdit.range.start.character,mb.length))}rAb(va){const mb=this.A8;this.A8=va;const Tb=this.zR.items[va];this.sha&&this.kVc();mb!==va&&this.render();Tb.type!==fd.SuggestionKind.Smart||this.da.Fp.text.includes("\n")||this.Xak(Tb);this.jfk()}xTb(va){return 0>
va?0:Math.min(va,this.zR.items.length-1)}Vfj(va,mb){this.ej.text=va.substring(0,mb.range.start.character)+mb.newText+va.substring(mb.range.end.character,va.length);this.da.DA&&(this.da.Dh.text=this.ej.text)}tAj(){this.JOb&&(this.formulaAssistanceTelemetryManager.Rua.selectByArrowKeyCounter++,this.JOb=!1);this.Xvc&&(this.formulaAssistanceTelemetryManager.Rua.selectByMouseHoverCounter++,this.Xvc=!1);this.IOb&&(this.formulaAssistanceTelemetryManager.Rua.commitByTabKeyCounter++,this.IOb=!1);this.HOb&&
(this.formulaAssistanceTelemetryManager.Rua.commitByEnterKeyCounter++,this.HOb=!1);this.Tvc&&(this.formulaAssistanceTelemetryManager.Rua.commitByMouseClickCounter++,this.Tvc=!1);this.apb&&this.Wvc&&(this.formulaAssistanceTelemetryManager.Rua.dismissSmartSuggestionExplicitlyCounter++,this.Wvc=!1)}IAe(va){switch(va){case -798660877:case 137938150:case 2091832999:case 742457698:this.JOb=!0;break;case 125627505:this.IOb=!0;break;case 267796030:this.HOb=!0}}static tKd(){return document.createElement("div")}L_i(va){return va.reduce((mb,
Tb)=>mb|=Tb.type===fd.SuggestionKind.Simple?kd.Simple:kd.Smart,kd.Dismissed)}}Object(Aa.a)(Yb,"FormulaAutoCompleteControl",Ja.a,[781,2,782]);var Cc=a(307),td=a(364),Ad=a(255);class oe{constructor(va,mb){var Tb,yc;this.Nu=va;this.$=mb;this.S1c=new Map;this.Wyb=null;this.Z1b=()=>{this.Ryc.resolve(this.Nu.Vx);this.Q4g()};this.amg=()=>{this.Ryc.reject(null);this.Q4g()};this.im=()=>{this.Nu.KWc();this.T1d=null;this.S1c.clear();this.Y1e()};this.XVj=(Nc,zd)=>{if(zd!==this.v7f)ub.ULS.sendTraceTag(509678923,
0,15,"onGetTableColHeadersSuccess called with a tableName different than the one saved for last request"),this.PQa.reject();else if(Object(Ad.a)(Nc))this.PQa.reject();else{var fe=Nc.Result;Object(Cc.b)(fe)&&0!==fe.length?(this.S1c.set(zd,fe),void this.PQa.resolve(Nc.Result)):this.PQa.reject()}};this.WVj=()=>{this.PQa.reject()};null===(yc=null===(Tb=Ia.f(this.$))||void 0===Tb?void 0:Tb.cellTextEditBox)||void 0===yc?void 0:yc.Ox(this.im);this.rUk=Gc.EwaSettings.isChangeGateEnabled("OfficeVSO:6476169_skipGetFieldInfoListContextIfContextLoaded")}getRichValueFieldListContext(va,
mb,Tb,yc){const Nc={mma:va,vsf:mb};var zd;if(zd=Object(Cc.b)(this.T1d))zd=this.T1d,zd=!(Nc.mma.firstRow===zd.mma.firstRow&&Nc.mma.firstColumn===zd.mma.firstColumn&&Nc.mma.lastRow===zd.mma.lastRow&&Nc.mma.lastColumn===zd.mma.lastColumn&&Nc.mma.sheetName===zd.mma.sheetName&&Nc.vsf===zd.vsf);zd&&this.Nu.KWc();this.T1d=Nc;this.rUk&&this.Nu.tXd||this.Nu.Ylb(Object(Fc.ib)(va),Tb,yc,mb);this.Ryc=new Cc.a;this.Nu.tXd?this.Ryc.resolve(this.Nu.Vx):this.Bjk();return this.Ryc.promise}getTableColHeaders(va){if(this.Wyb&&
3>=this.Wyb.status&&va===this.v7f)return this.PQa.promise;this.PQa=new Cc.a;if(this.S1c.has(va))this.PQa.resolve(this.S1c.get(va));else{this.Y1e();this.v7f=va;const mb=this.$.$h.getItemByName(va).Zq;this.Wyb=Object(td.v)(this.$.oa.ta,mb,Tb=>this.XVj(Tb,va),this.WVj,null,null)}return this.PQa.promise}dispose(){var va,mb;null===(mb=null===(va=Ia.f(this.$))||void 0===va?void 0:va.cellTextEditBox)||void 0===mb?void 0:mb.Ow(this.im)}Bjk(){this.Nu.Ppd(this.Z1b);this.Nu.DDh(this.amg)}Q4g(){this.Nu.Qje(this.Z1b);
this.Nu.Gok(this.amg)}Y1e(){Object(Cc.b)(this.Wyb)&&($a.AFrameworkApplication.lj.lD(this.Wyb.rC),this.Wyb=null)}}Object(Aa.a)(oe,"ServerDataProvider",null,[]);var qe=a(86),Be=a(1065);a(195);var Ee=a(1608);class Ve{constructor(va){this.Vdi={};this.$=va}get Udi(){const va=[];if(!this.$.$h||!this.$.$h.items)return va;let mb=0;for(const Tb of this.$.$h.items)if(Tb&&(3===Tb.type&&Tb.usedRange||2===Tb.type)){const yc={tooltip:Tb.sheetName+qe.a.exclamation+Tb.usedRange.toString(),name:Tb.name,namedRange:this.Q3h(Tb.usedRange),
sheetName:Tb.sheetName,type:this.D3h(Tb.type)};va.push(yc);this.Vdi[Tb.name.toUpperCase()]=yc;++mb;if(!Gc.EwaSettings.isChangeGateEnabled("OfficeVSO:7395300_FixTableAutoCompleteMissingInfo")&&mb===Be.a.wdg){ub.ULS.sendTraceTag(537162076,0,15,`Maximum number of defined names reached for formula assistance: ${Be.a.wdg}`);break}}return va}Q3h(va){if(null!=va&&void 0!=va)return{top:va.top,left:va.left,bottom:va.bottom,right:va.right,maxRows:va.maxRows,maxColumns:va.maxColumns,sheetName:void 0}}D3h(va){switch(va){case 2:return fd.DefinedNameInfoType.Table;
case 3:return fd.DefinedNameInfoType.NamedRange;default:return fd.DefinedNameInfoType.Invalid}}}Object(Aa.a)(Ve,"DefinedNameInfoManager",null,[]);var Oe=a(154),Ye=a(371),nf=a(736),of=a(396);const Cf={index:0,length:0};class Ff{constructor(va){this.wya=this.xya=this.roa=this.soa=!1;this.L2a=va}}Object(Aa.a)(Ff,"MarqueeRangeData",null,[]);class Wf{constructor(va,mb,Tb,yc){this.Z_k=va;this.g1g=mb;this.CJc=void 0===yc?!1:yc;Tb?(this.L2a=Tb.L2a,this.soa=Tb.soa,this.roa=Tb.roa,this.xya=Tb.xya,this.wya=
Tb.wya):ub.ULS.shipAssertTag(510255180,0,!1,"MarqueeMetadata.Ctor: rangeData is null")}}Object(Aa.a)(Wf,"MarqueeMetadata",null,[]);a(1480);const Mf=Hd.a.Oz()?"rgba(0, 108, 190, {0});rgba(188, 47, 50, {0});rgba(124, 83, 172, {0});rgba(15, 112, 15, {0});rgba(191, 0, 119, {0});rgba(181, 73, 15, {0});rgba(0, 117, 143, {0})".split(";"):"rgba(95, 140, 237, {0});rgba(235, 94, 96, {0});rgba(141, 97, 194, {0});rgba(45, 150, 57, {0});rgba(191, 76, 145, {0});rgba(227, 130, 34, {0});rgba(55, 127, 158, {0})".split(";"),
ng=Mf.map(va=>String.format(va,1));class Rf{constructor(va,mb,Tb,yc){this.$=va;this.pluginScheduler=mb;this.WF=Tb;this.formulaAssistanceTelemetryManager=yc;this.$0a=this.Y_g=!1;this.jT=null;this.FNa=()=>{this.$0a=!1;this.jT=null};this.da=Ia.f(va);this.da.Dh.Ox(this.FNa);this.D4g=Gc.EwaSettings.isChangeGateEnabled("OfficeVSO:7686593_checkPotentialFormulaBeforeX10HighlightingEnabled")}n_(va,mb,Tb){var yc;va.Xa.addEventLogRecord("FormulaHighlightsControl.TryUpdateFormulaHighlights");if(this.Y_g||va.sha)return!1;
const Nc=isNullOrUndefined(mb)?va.text:mb;if(this.D4g){if(!ad.f(Nc))return this.oBe(Object(Cc.b)(mb))}else if(1>=Nc.length)return this.oBe(Object(Cc.b)(mb));Tb=this.Z_i(va,mb,Tb);Tb=null===(yc=this.SMd(Nc,Tb))||void 0===yc?void 0:yc.formulaHighlights;if(!Tb)return ub.ULS.sendTraceTag(512349465,0,50,"FormulaHighlightsControl.tryUpdateFormulaHighlights: formulaHighlights is null (might be an invalid formula)"),this.oBe(Object(Cc.b)(mb));const {n2c:zd,CBg:fe,ABg:Ud,VFj:P}=this.NIf(Tb,Nc);this.kJk(va,
zd,!!mb);mb=va.Xa.text;if(!xc.a.equals(mb,Nc,!1))return ub.ULS.shipAssertTag(38114182,0,!1,`FormulaHighlightsControl.tryUpdateFormulaHighlights: The text we created is different from the original text. Setting the original text back. currentTextLength [${mb.length}], updatedTextLength [${Nc.length}]`),mb=va.Xa.caretPosition,va.Xa.text=Nc,va.Xa.caretPosition=mb,!0;this.highlightRanges(fe,Ud,3,P);return this.$0a=!0}Deg(va,mb,Tb){if(!va||!mb||!Tb)return ub.ULS.shipAssertTag(512349463,0,!!va,"FormulaHighlightsControl.MoveMarqueeRange: cellContentEditor is null"),
ub.ULS.shipAssertTag(512349462,0,!!mb,"FormulaHighlightsControl.MoveMarqueeRange: highlightState is null"),ub.ULS.shipAssertTag(512349461,0,!!Tb,"FormulaHighlightsControl.MoveMarqueeRange: newRange is null"),!1;const yc=Object(Oe.a)(Wf,mb.metadata);if(!yc)return ub.ULS.shipAssertTag(512349460,0,!1,"FormulaHighlightsControl.MoveMarqueeRange: marqueeMetadata is null"),!1;var Nc=yc.Z_k,zd=yc.g1g;let fe=this.da.oh.VZf(Tb)?Tb.wBc(yc.roa,yc.soa):Tb.Qga(yc.roa,yc.soa,yc.wya,yc.xya);if(!fe)return ub.ULS.shipAssertTag(512349459,
0,!1,"FormulaHighlightsControl.MoveMarqueeRange: newText is null"),!1;const Ud=zd.indexOf("!");-1!==Ud&&(fe=zd.substring(0,Ud+1)+fe);if(!va.Xa.changeTextInExistingTextPart(Nc,zd,fe))return ub.ULS.shipAssertTag(38926105,0,!1,"FormulaHighlightsControl.MoveMarqueeRange: failed to change the text part"),!1;yc.g1g=fe;Nc=!0;zd=this.da.fh.Bcc;for(const P of zd)(zd=Ia.f(this.$).Fh.eV(3,P,mb.uma))?(zd.range=Tb,zd.metadata=yc):(ub.ULS.shipAssertTag(512349458,0,!1,"FormulaHighlightsControl.MoveMarqueeRange: highlightStateInPane is null"),
Nc=!1);this.da.Fh.update(!1,!1);this.da.DA&&(this.da.cellTextEditBox.Xa.text=va.text);this.da.cellTextEditBox.N4b(new Ye.a({EHc:!0}));return Nc}Poj(va){if(3!==va.Dw)return ub.ULS.shipAssertTag(512349457,0,!1,"FormulaHighlightsControl.IsMarqueeHighlightDraggable: not HighlightDivIndex.Marquee."),!1;va=Object(Oe.a)(Wf,va.metadata);return va?va.L2a&&!va.CJc:(ub.ULS.shipAssertTag(512349456,0,!1,"FormulaHighlightsControl.IsMarqueeHighlightDraggable: marqueeMetadata is null."),!1)}Vyb(va,mb){ub.ULS.sendTraceTag(512349455,
0,50,"FormulaHighlightsControl.suspendResumeFormulaHighlights: "+(mb?"suspending":"resuming")+" formula highlights");mb&&this.$0a&&(this.$0a=!1,this.highlightRanges(null,null),va.Xa.BYh());this.Y_g=mb}dispose(){this.da&&this.da.Dh&&this.da.Dh.Ow(this.FNa)}KTf(va){this.formulaAssistanceTelemetryManager.EQa(["highlightPreviewRanges"]);var mb=this.SMd(va,Cf);if(isNullOrUndefined(mb))this.XGc&&this.highlightRanges(null,null);else{var Tb=this.vOd(),yc=[],Nc=new Ra.a(!1),zd=[];mb=mb.formulaHighlights;for(const fe of mb)if(mb=
fe.kind,mb===fd.HighlightKind.CellRef||mb===fd.HighlightKind.NamedRange||mb===fd.HighlightKind.StructRef)mb=Fc.C(fe.rangeInfo.range),Object(Cc.b)(mb)&&(yc.push(new of.a(mb,Tb)),this.YAc(mb,Nc,1),zd.push(new Wf(fe.span.start,va.substring(fe.span.start,fe.span.end),d(fe),!0)));this.highlightRanges(yc,Nc,3,zd);this.formulaAssistanceTelemetryManager.O5(["highlightPreviewRanges"],!0)}}SZi(va,mb){mb=void 0===mb?[]:mb;var Tb;const yc=null===(Tb=this.SMd(va,Cf))||void 0===Tb?void 0:Tb.formulaHighlights.filter(Ud=>
!mb.includes(Ud.kind));if(!yc)return null;const {n2c:Nc,CBg:zd,ABg:fe}=this.NIf(yc,va);return{n2c:Nc,highlightRanges:Ud=>Ud?this.highlightRanges(zd,fe,28):this.CYh()}}CYh(){this.highlightRanges(null,null,28)}N$k(va,mb){va&&this.formulaAssistanceTelemetryManager.MJd.formulaHighlightsCounter++;mb&&this.formulaAssistanceTelemetryManager.MJd.parenthesesCouplingCounter++}oBe(va){this.D4g&&!this.$0a||this.highlightRanges(null,null);return this.$0a&&(this.$0a=!1,va)?!0:!1}Z_i(va,mb,Tb){let yc=Tb;Object(Cc.b)(mb)?
Object(Cc.b)(Tb)||(yc={index:mb.length,length:0}):yc=va.Xa.selection;return yc}SMd(va,mb){if(this.krj({content:va,selection:mb}))return this.jT.result;this.formulaAssistanceTelemetryManager.EQa(["formulaHighlightsRequest"]);const Tb=this.pluginScheduler.syncRequester().formulaHighlighting({content:va,caretPosition:mb.index,selectionLength:mb.length},this.WF.c6a,null);this.jT={content:va,selection:mb,result:Tb};this.formulaAssistanceTelemetryManager.O5(["formulaHighlightsRequest"]);return Tb}YAc(va,
mb,Tb){let yc=mb.getItem(va.toString());yc||(yc=Mf[mb.count%Mf.length],mb.add(va.toString(),yc));return String.format(yc,Tb)}JIb(va,mb,Tb,yc,Nc,zd){Nc=void 0===Nc?null:Nc;zd=void 0===zd?null:zd;ub.ULS.shipAssertTag(512349453,0,Tb<=yc,"FormulaHighlightsControl.AddTextPart: startIndex cannot be larger than endIndex");Tb<yc&&(mb=mb.substring(Tb,yc),Tb=Hd.a.Oz()&&Nc?(ng.indexOf(Nc)+1).toString():null,va.push(Object(Ld.a)(new nf.a,{text:mb,color:Nc,backgroundColor:zd,highlightClass:Tb})))}highlightRanges(va,
mb,Tb,yc){Tb=void 0===Tb?3:Tb;yc=void 0===yc?null:yc;ub.ULS.shipAssertTag(508350945,0,3===Tb||null===yc,"FormulaHighlightsControl.HighlightRanges: marqueeMetadatas param was passed although the divIndex isn't maquee");const Nc=3===Tb&&Object(Cc.b)(yc);va&&va.length?(ub.ULS.sendTraceTag(512349452,0,50,"FormulaHighlightsControl.HighlightRanges: number of ranges to highlight: "+va.length),va.reverse(),Nc&&yc.reverse(),this.da.Fh.wQ(va,[Tb],!0,(zd,fe)=>{if(zd&&zd.range&&fe){ub.ULS.shipAssertTag(512349448,
0,mb.mh(zd.range.toString()),`FormulaHighlightsControl.HighlightRanges: The range '${zd.range.toString()}' doesn't exist in the range to color dictionary`);var Ud=this.YAc(zd.range,mb,.1),P=this.YAc(zd.range,mb,1);this.$.frame&&this.$.frame.cN&&this.$.frame.cN.JY||(fe.style.background=Ud);fe.style.borderColor=P;Nc&&(fe.setAttribute(Xa.a.vVb,zd.uma.toString()),zd.metadata=yc[zd.uma])}else ub.ULS.shipAssertTag(512349451,0,!!zd,"FormulaHighlightsControl.HighlightRanges: state is null"),ub.ULS.shipAssertTag(512349450,
0,!!zd.range,"FormulaHighlightsControl.HighlightRanges: state.Range is null"),ub.ULS.shipAssertTag(512349449,0,!!fe,"FormulaHighlightsControl.HighlightRanges: div is null")})):0!==this.da.Fh.VKd([Tb]).length&&(va=this.$.Eh.Oi("UserAction","HideRangesHighlightsStopwatch"),this.da.Fh.fr([Tb]),this.da.Fh.qxb(new of.a(null,this.vOd()),[Tb]),va.stop())}kJk(va,mb,Tb){const yc=va.Xa;yc.eN=!0;var Nc=yc.selection;const zd=Nc.index;Nc=zd+Nc.length;yc.setTextFromTextParts(mb);mb=yc.text.length;yc.selectRange(Math.min(zd,
mb),Math.min(Nc,mb));Tb&&va.N4b(new Ye.a);yc.eN=!1}gTi(){return this.da.QB&&this.da.QB.SV?this.da.QB.SV:this.$.la}vOd(){return this.gTi().sheetId}NIf(va,mb){const Tb=[],yc=new Ra.a(!1),Nc=[],zd=[],fe=[];let Ud=!1;var P=!1;let Da=0;const eb=this.vOd();for(const bc of va){this.JIb(Nc,mb,Da,bc.span.start);switch(bc.kind){case fd.HighlightKind.CellRef:case fd.HighlightKind.StructRef:case fd.HighlightKind.NamedRange:va=Fc.C(bc.rangeInfo.range);if(isNullOrUndefined(va)){ub.ULS.sendTraceTag(512349464,0,
10,`FormulaHighlightsControl.tryUpdateFormulaHighlights: Received formula highlight with undefined range, HighlightKind:${bc.kind.toString()}`);this.JIb(Nc,mb,bc.span.start,bc.span.end);break}P=this.YAc(va,yc,1);this.JIb(Nc,mb,bc.span.start,bc.span.end,P,null);Tb.push(new of.a(va,eb));zd.push({Start:bc.span.start,End:bc.span.end});P=Nc.length-1;fe.push(new Wf(P,Nc[P].text,d(bc)));P=!0;break;case fd.HighlightKind.Parentheses:this.JIb(Nc,mb,bc.span.start,bc.span.end,null,"rgb(229, 229, 229)"),Ud=!0}Da=
bc.span.end}this.JIb(Nc,mb,Da,mb.length);this.N$k(P,Ud);return{n2c:Nc,CBg:Tb,ABg:yc,VFj:fe}}krj(va){return Object(Cc.b)(this.jT)&&this.jT.content===va.content&&this.jT.selection.index===va.selection.index&&this.jT.selection.length===va.selection.length}}Object(Aa.a)(Rf,"FormulaHighlightsControl",null,[780,2]);var $f=a(91),jf=a(78),Hf=a(792);Object(la.b)(db.Gc,{rk:"singleton"})(va=>xo(function*(){var mb,Tb=yield la.a.resolve(db.Ob,va);const yc=yield la.a.resolve(db.yg,va),Nc=yield la.a.resolve(db.Tf,
va);var zd=null!==(mb=null===va||void 0===va?void 0:va.va)&&void 0!==mb?mb:0;zd=yield Object($f.e)(jf.GetServiceTaskFactory.create(Tb.qa,449,Tb.ya,zd));const fe=yield la.a.resolve(Hf.f,va),Ud=yield la.a.resolve(db.G,va);mb=yield la.a.resolve(db.Hc,va);const P=yield la.a.resolve(Hf.d,va),Da=yield la.a.resolve(db.Yc,va),eb=Gc.EwaSettings.hIc()?yield la.a.resolve(db.Ab,va):null;Tb=new Uf(Tb,Da,Ud,fe,zd,P,Nc.amf(Tb,yc),eb);mb.sLh(Tb.Tzc);mb.tLh(Tb.Ywa);mb.uLh(Tb.Ywa);return Tb}));class Uf{constructor(va,
mb,Tb,yc,Nc,zd,fe,Ud){this.$=va;this.YF=mb;this.Mj=Tb;this.pluginScheduler=yc;this.formulaAssistanceUIControl=Nc;this.formulaAssistanceTelemetryManager=zd;this.Nu=fe;this.DK=Ud;this.$Vd=this.isCellContentOnlyEqualDuringEdit=!1;this.QZb=null;this.LLc=-1;this.Xpa=0;this.jpb=!1;this.Gpj=Gc.EwaSettings.isChangeGateEnabled("OfficeVSO:8842481_FAOnlyRequestInEdit");this.Xi=(P,Da)=>{Da.$l||Da.Aob||this.pluginScheduler.notifier().notifyWorkbookClosing()};this.onActiveCellChanged=(P,Da)=>{this.da.isEditing||
this.da.kq||this.xgg(null===Da||void 0===Da?void 0:Da.cell)};this.onFunctionInfoLoaded=()=>{this.Z7g();this.Eqa()};this.URj=()=>{this.RAe();this.Eqa()};this.rig=(P,Da)=>{var eb=this.ej;P=eb.text;eb=eb.Xa.caretPosition;0<this.Xpa&&this.formulaAssistanceTelemetryManager.Rua.commitWhileRequestPending++;this.formulaAssistanceTelemetryManager.EQa(["argumentAssistanceComputation","argumentAssistanceOverall"]);Da.shouldRequestAutocompleteOnCommit?this.cOg(P,eb):this.ptk(P,eb)};this.im=()=>{this.isCellContentOnlyEqualDuringEdit&&
(this.formulaAssistanceTelemetryManager.ZU.isCellContentOnlyEqualDuringEditCounter++,this.isCellContentOnlyEqualDuringEdit=!1);this.$Vd&&(this.formulaAssistanceTelemetryManager.ZU.isCellContentFormulaCounter++,this.$Vd=!1);Gc.EwaSettings.isChangeGateEnabled("OfficeVSO:6103891_dismissControlOnEditEnded")&&this.hDd()};this.INa=(P,Da)=>{Object($c.d)(()=>{this.vxk(Da.newValue)})};this.mq=()=>{this.RAe()};this.RAe=()=>{const P=this.jpb?this.LKi():this.Tdi.Udi;this.pluginScheduler.notifier().setDefinedNamesInfo(P);
ub.ULS.sendTraceTag(512278605,0,50,`FormulaAssistanceManager.updateDefinedNamesList updated defined names info with ${null===P||void 0===P?void 0:P.length} names}`)};this.Ohg=(P,Da)=>{this.pluginScheduler.notifier().setActiveCellFormat(Da)};this.YF=mb;this.formulaAssistanceUIControl=Nc;this.pluginScheduler=yc;this.da=Ia.f(this.$);this.jpb=Gc.EwaSettings.hIc()&&Object(Cc.b)(this.DK);this.Tdi=new Ve(va);this.jpb?(this.DK.e6e(this.URj),this.DK.$de(!1)):(this.da.za.qy(this.mq),this.RAe());this.Ybb=new dd(this.$,
this.formulaAssistanceUIControl,this.formulaAssistanceTelemetryManager);this.Nka=new Yb(this.$,this.formulaAssistanceUIControl,this.formulaAssistanceTelemetryManager);this.lVk=Hd.a.Lob(va);this.rij=Gc.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.AuthoringPerCharExp",!1);this.Nsj=Gc.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.x10AutocompleteWrapperPluginIsEnabled",!1);this.acb=new Rf(this.$,this.pluginScheduler,this,this.formulaAssistanceTelemetryManager);this.Mj=Tb;this.kej();
this.da.cellTextEditBox.Ox(this.im);this.YF.Cnc(this.onFunctionInfoLoaded);this.YF.Coa?this.Z7g():this.YF.akb({})}get Ywa(){return this.Nka}get Tzc(){return this.Ybb}get XF(){return this.acb}get c6a(){return this.ej.Iqj?fd.PluginGroup.Python:fd.PluginGroup.Excel}get ej(){return this.da.Fp}get oh(){return this.da.oh}dispose(){var va;if(this.$){const mb=this.da;mb&&(mb.ha&&mb.ha.fBa(this.onActiveCellChanged),!this.jpb&&mb.za&&mb.za.Ax(this.mq));this.$.wu(this.Xi)}null===(va=this.Mj)||void 0===va?void 0:
va.nnk(this.Ohg);this.da.cellTextEditBox.Ow(this.im);this.Nka.Vnk(this.rig);this.YF&&this.YF.Uje(this.onFunctionInfoLoaded);this.ej&&this.ej.xVc(this.INa);rb.a.gh(this.Ybb);rb.a.gh(this.Nka);this.Nka=this.Ybb=this.YF=this.$=null}Vtk(){this.LLc=-1;this.QZb=null}hDd(){this.Nka.visible=!1;this.Ybb.visible=!1}Iq(){this.Eqa();return!1}Eqa(){if((!this.Gpj||this.da.isEditing)&&!this.ej.HZ)if(this.formulaAssistanceTelemetryManager.rtd.formulaAssistanceRequestAttemptedCounter++,this.mOk()){var va=this.ej,
mb=va.text;va=va.Xa.caretPosition;mb.startsWith("=")&&(this.$Vd=!0,1===mb.length&&(this.isCellContentOnlyEqualDuringEdit=!0));this.formulaAssistanceTelemetryManager.EQa("argumentAssistanceComputation autoCompleteComputation autoCompleteComputationNoResult argumentAssistanceOverall autoCompleteOverall autoCompleteOverallSmartOnly autoCompleteOverallSimpleOnly autoCompleteOverallSimpleAndSmart".split(" "));this.cOg(mb,va);this.rij&&this.Btk(mb,va)}else this.formulaAssistanceTelemetryManager.rtd.formulaAssistanceRequestOptimizedCounter++}cOg(va,
mb){const Tb=this.pluginScheduler.batchRequester().functionSuggestionAndArgumentAssistance({functionSuggestion:{content:va,caretPosition:mb},argumentAssistance:{content:va,caretPosition:mb},inCellSuggestion:{content:va,caretPosition:mb}},this.c6a,null);this.Xpa+=1;this.QZb=va;this.LLc=mb;Tb.then(yc=>{--this.Xpa;"Done"===yc.kind&&(this.TPf(yc.payload.argumentAssistance),this.a4i(yc.payload.functionSuggestion,va));return null})}Btk(va,mb){mb={content:va,caretPosition:mb,enableAutocompleteWrapperPlugin:this.Nsj&&
!this.lVk};mb=this.pluginScheduler.requester().runPerCharacterExperiment(mb,this.c6a,null);this.Xpa+=1;mb.then(Tb=>{--this.Xpa;if("Done"===Tb.kind)for(const yc of Tb.payload.results)yc.kind===fd.PerCharacterExperimentResultKind.AutocompleteWrapperPluginResult&&this.da.MIa.VQg(yc.value,va);return null})}ptk(va,mb){const Tb={content:va,caretPosition:mb};this.QZb=va;this.LLc=mb;va=this.pluginScheduler.requester().argumentAssistance(Tb,this.c6a,null);this.Xpa+=1;va.then(yc=>{--this.Xpa;"Done"===yc.kind&&
this.TPf(yc.payload)})}mOk(){var va=this.ej;const mb=va.text;va=va.Xa.caretPosition;return this.Nka.visible&&xc.a.equals(mb,this.QZb,!0)&&!ad.e(mb)&&va===this.LLc?!1:!0}Bxk(){void this.pluginScheduler.requester().runExperiment({},this.c6a,null)}TPf(va){va&&this.ej.isEditing?(this.formulaAssistanceTelemetryManager.O5(["argumentAssistanceComputation"]),this.Ybb.show(va)):this.Ybb.dismiss()}a4i(va,mb){va&&0<va.items.length&&this.ej.isEditing&&this.ej.text===this.QZb?this.oh.NY(this.da.ha.pa.activeCell)?
(this.formulaAssistanceTelemetryManager.ZU.smartSuggestionWouldSuggestInsidePivotCounter++,this.Nka.dismiss()):(this.formulaAssistanceTelemetryManager.O5(["autoCompleteComputation"]),this.Nka.show(va)):this.Nka.dismiss();this.da.MIa.VQg(va,mb);va&&0!==va.items.length||this.formulaAssistanceTelemetryManager.O5(["autoCompleteComputationNoResult"])}vxk(va){va={content:va,isCellContentOnlyEqualDuringEdit:this.isCellContentOnlyEqualDuringEdit};void this.pluginScheduler.requester().runAuthoringExperiment(va,
this.c6a,null)}xgg(va){var mb;const Tb=this.da.ha.pa.activeCell;if(Tb){var yc=this.Mj.xtc(Tb,!1);if(yc){var Nc=this.$.sa,zd=yc.sheet.index;0>=Nc.count||0>zd||zd>=Nc.count?ub.ULS.sendTraceTag(512278608,0,50,`FormulaAssistanceManager.NotifyActiveCellChanged invalid sheet index. ewaSheetsCount = ${Nc.count}, currentSheetIndex = ${zd}.`):(zd=Nc=null,void 0!==this.Mj&&null!==this.Mj&&(va=null!==(mb=null===va||void 0===va?void 0:va.cell)&&void 0!==mb?mb:this.da.za.Wx(Tb))&&(mb=this.Mj.LKf(va.to),void 0!==
mb&&null!==mb&&(Nc=mb.FormatString,zd=mb.Builtin)),this.pluginScheduler.notifier().setActiveCell({colIndex:yc.range.col,rowIndex:yc.range.row,sheetIndex:this.$.sa.getItem(yc.sheet.index).sheetId,docName:yc.sheet.document.name,docPath:yc.sheet.document.path,formatString:Nc,builtIn:zd}),ub.ULS.sendTraceTag(512278607,0,50,`FormulaAssistanceManager.NotifyActiveCellChanged sent notification to the scheduler. col: ${yc.range.col}, row: ${yc.range.row}`))}else ub.ULS.sendTraceTag(537162002,0,50,"FormulaAssistanceManager.NotifyActiveCellChanged ISheetGridCell location is null")}else ub.ULS.sendTraceTag(512278609,
0,50,"FormulaAssistanceManager.NotifyActiveCellChanged activeCell range is null")}Z7g(){const va=this.YF.ADf;this.pluginScheduler.notifier().setFunctionsInfo(va);ub.ULS.sendTraceTag(512278606,0,50,`FormulaAssistanceManager.updateSchedulerFunctionList update functions info with ${null===va||void 0===va?void 0:va.length} functions}`)}kej(){this.da.ha.wGa(this.onActiveCellChanged);this.Mj.$Bh(this.Ohg);const va=this.da.yh(null);this.xgg(va);this.ej.RIb(this.INa);this.Bxk();this.Nka.NCh(this.rig);this.pluginScheduler.setServerDataProvider(new oe(this.Nu,
this.$));this.Eqa();this.$.Pp(this.Xi)}LKi(){return this.DK.getItems(va=>Object(Cc.b)(va)).map(va=>{var mb=va.name;a:switch(va.type){case Ee.a.NamedRange:case Ee.a.Table:var Tb=va.referenceSheetName&&va.topLeft&&va.bottomRight?`${va.referenceSheetName}!${va.topLeft}:${va.bottomRight}`:va.reference;break a;default:Tb=va.comment}var yc=k(va);a:switch(va.type){case Ee.a.NamedRange:case Ee.a.Table:var Nc=Object(Fc.D)(va.topLeft);const zd=Object(Fc.D)(va.bottomRight);Nc={top:Nc.top,left:Nc.left,bottom:zd.bottom,
right:zd.right,maxRows:Nc.maxRows,maxColumns:Nc.maxColumns,sheetName:va.referenceSheetName};break a;default:Nc=null}return{name:mb,tooltip:Tb,type:yc,namedRange:Nc,sheetName:va.referenceSheetName,reference:va.reference}})}}Object(Aa.a)(Uf,"FormulaAssistanceManager",null,[750,2]);var If;let sf=If=class{constructor(va,mb){this.ariaLiveNotifier=va;this.$=mb;this.YZa=this.EJa=this.Xwa=null;this.dqg=(Tb,yc)=>{this.Cgk(yc.functionName,yc.BDf)};this.fqg=(Tb,yc)=>{this.zgk(yc.BDf,yc.PNg,yc.Yvl)};this.eqg=
(Tb,yc)=>{Tb=[];for(var Nc of yc.PNg)void 0!==Nc&&null!==Nc&&(yc=Nc.trim())&&Tb.push(yc);if(Tb.length){Nc="";for(yc=0;yc<Tb.length;yc++){const zd=this.Iud(Tb[yc]),fe=If.hee(yc,Tb.length);Nc+=zd+fe;fe&&(Nc+=this.ariaLiveNotifier.Z3a)}this.ariaLiveNotifier.readText(Nc)}};this.gqg=(Tb,yc)=>{this.ariaLiveNotifier.Egk(yc.tQ,yc.description,yc.selectedIndex.toString(),yc.length.toString())};this.$pg=(Tb,yc)=>{this.ariaLiveNotifier.pCg(yc.description,yc.length)};this.Olg=()=>{this.ariaLiveNotifier.TOa(Tc.a.instance.ia(884),
Xa.a.UGa)};this.Elg=()=>{this.ariaLiveNotifier.readText(Tc.a.instance.ia(885))};this.Klg=()=>{this.ariaLiveNotifier.readText(Tc.a.instance.ia(886))}}dispose(){this.pAe();this.YZa=this.EJa=this.Xwa=null}sLh(va){va&&(this.Xwa=va,this.Xwa.BDh(this.dqg),this.Xwa.HFh(this.fqg),this.Xwa.GFh(this.eqg))}tLh(va){va&&(this.EJa=va,this.EJa.zDh(this.Olg),this.EJa.vDh(this.Elg),this.EJa.yDh(this.Klg))}uLh(va){va&&(this.YZa=va,this.YZa.IFh(this.gqg),this.YZa.eqd(this.$pg))}pAe(){var va,mb,Tb;this.Xwa&&(this.Xwa.Eok(this.dqg),
this.Xwa.uqk(this.fqg),this.Xwa.tqk(this.eqg));this.YZa&&(this.YZa.vqk(this.gqg),this.YZa.eke(this.$pg));null===(va=this.EJa)||void 0===va?void 0:va.Cok(this.Olg);null===(mb=this.EJa)||void 0===mb?void 0:mb.yok(this.Elg);null===(Tb=this.EJa)||void 0===Tb?void 0:Tb.Bok(this.Klg)}Cgk(va,mb){if(mb){let Tb="";for(let yc=0;yc<mb.length;yc++)Tb+=va+this.ariaLiveNotifier.Z3a+this.Iud(mb[yc])+If.hee(yc,mb.length);Tb+=Tc.a.instance.ia(883)+this.ariaLiveNotifier.Z3a;this.ariaLiveNotifier.readText(Tb)}}zgk(va,
mb,Tb){if(va){let Nc="",zd=0;if(mb){for(let fe=0;fe<mb.length;fe++){if(Tb>=va[fe].split(this.$.listSeparator).length){zd++;continue}var yc=mb[fe].trim();if(!yc)return;yc=this.Iud(yc);const Ud=If.hee(fe-zd,mb.length-zd);Nc+=yc+Ud;Ud&&(Nc+=this.ariaLiveNotifier.Z3a)}this.ariaLiveNotifier.readText(Nc)}}}Iud(va){if(!va)return"";var mb=va.split(this.$.listSeparator);va="";for(const Tb of mb){if(If.mlj(Tb))va+=Tb;else{const yc=(mb=If.Opj(Tb))?Tb.replace("[","").replace("]",""):Tb;va+=String.format(mb?Tc.a.instance.sh(59):
Tc.a.instance.sh(58),yc)}va+=this.ariaLiveNotifier.Z3a}return va}static hee(va,mb){return va>=mb||1===mb?(ub.ULS.shipAssertTag(537161997,0,va<mb,"FormulaAssistanceControl.PositionInList: requested item index >= list length."),""):String.format(Tc.a.instance.sh(55),va+1,mb)+"\r\n"}static mlj(va){return xc.a.contains(va,Be.a.utf,!0)}static Opj(va){return va.trimStart().startsWith(Be.a.s4j)||va.trimEnd().endsWith(Be.a.r4j)}};sf=If=Object(ea.__decorate)([Object(la.d)(db.Hc),Object(ea.__param)(0,Object(db.l)()),
Object(ea.__param)(1,Object(db.Ob)())],sf);Object(Aa.a)(sf,"FormulaAssistanceReadoutHandler",null,[746,2]);let tc=class{constructor(va){this.formulaAssistanceValuePreview=va}Ri(){return!1}executeCommand(va,mb){va=!1;mb=mb.command;switch(mb){case -46938080:this.formulaAssistanceValuePreview.trigger(),va=!0}return va?Yc.Task.Ua(!0):cc.a(mb)}Ei(va,mb){return-46938080===mb.command}dj(){return!1}};tc=Object(ea.__decorate)([Object(la.d)(db.Ic),Object(ea.__param)(0,Object(Hf.e)())],tc);Object(Aa.a)(tc,"FormulaAssistanceValuePreviewCommandHandler",
null,[36]);var ld=a(128),Ed=a(36),ze=a(64);class ge{constructor(va,mb){this.$=va;this.da=mb;this.isEnabled=Gc.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.ValuePreviewValidation",!1);this.UWb=Gc.EwaSettings.isChangeGateEnabled("OfficeVSO:8501487_ValuePreviewDetectVolatile")}get EAi(){Object(Cc.c)(this.JNe)&&(this.JNe=la.a.resolve(db.Dc,{va:1}));return this.JNe}bXh(va,mb,Tb,yc,Nc){const zd=this;return xo(function*(){if(zd.isEnabled&&("Success"===mb.kind||"Failure"===mb.kind)){var fe=mb.evaluatedFormula;
if(!Object(Cc.c)(fe)&&""!==fe){var Ud={};Ud.locale=zd.MJf();var P=zd.da.ha.pa.activeCell;Object(Cc.b)(P)?Ud.anonymizationOrigin="activeCell":(Ud.anonymizationOrigin="A1",P=Qb.Range.yi(0,0));try{const Da=yield zd.EAi;Ud.formula=Da.anonymize(va.text,P);Ud.subFormula=Da.anonymize(fe,P)}catch(Da){Ud.formula="FAIL",Ud.subFormula="FAIL"}Ud.clientResult=zd.vP(mb);try{const Da=zd.BPd(),eb=yield yc(va.text,fe,Nc),bc=zd.BPd();Ud.serverResult=zd.vP(eb);Ud.diagnostics=zd.Q0h(Ud.clientResult,Ud.serverResult);
Ud.stateId={beforeX10:Tb,beforeServer:Da,server:eb.stateId,afterServer:bc}}catch(Da){Ud.diagnostics={kind:"error",message:Da}}zd.UWb&&"Success"===mb.kind&&(Ud.isVolatile=mb.isVolatile);n(Ud);ub.ULS.sendTraceTag(508831819,1,20,`ValuePreviewResultValidator.checkClientResultVsServer, result: ${JSON.stringify(Ud)}`)}}})}BPd(){return{latest:this.$.fa.yk,successful:this.$.fa.UC}}MJf(){const va={ui:this.$.m9,data:this.$.dataCultureTag},mb=la.a.lh(db.Ed);Object(Cc.b)(mb)&&(va.calcLcid=mb.zk.Lcid);return va}vP(va){switch(va.kind){case "Failure":return{kind:"failure",
reason:va.reason};case "Success":return{kind:"success",value:va.value,unformattedValue:va.unformattedValue,operKind:va.operKind};default:return{kind:"unexpected"}}}Q0h(va,mb){return"unexpected"===va.kind||"unexpected"===mb.kind?{kind:"unexpected"}:"success"===va.kind&&"success"===mb.kind?this.V0h(va,mb):"failure"===va.kind&&"failure"===mb.kind?{kind:"equal"}:{kind:"failure",source:"failure"===va.kind?"client":"server"}}V0h(va,mb){const Tb=u(va.value,mb.value);if("equal"===Tb.kind)return Tb;const yc=
va.unformattedValue,Nc=mb.unformattedValue,zd=u(yc,Nc);return 2===va.operKind&&2===mb.operKind&&2===Math.abs(yc.length-Nc.length)&&(va=yc.length>Nc.length?"client":"server",yc.trim()===Nc.trim())?{kind:"padded",source:va}:{kind:"different",diff:Tb.diff,unformatted:zd}}}Object(Aa.a)(ge,"ResultValidator",null,[]);var Ne=a(199),Ge=a(325),ca=a(33);class sb{constructor(va){this.ceg=va;this.u2=Object.assign({},V);this.Ejb=[];this.MNc=-1;(this.beg=Gc.EwaSettings.isChangeGateEnabled("OfficeVSO:5999949_formulaTelemetryMetriThresholds"))&&
va&&(this.u2.countAboveThresholds={},va.forEach(mb=>this.u2.countAboveThresholds[mb]=0))}static get x2c(){return ca.a.kh.Xj.m}C9a(){this.MNc=sb.x2c}N5(va,mb){mb=void 0===mb?null:mb;if(-1!==this.MNc||Object(Cc.b)(mb))va?(this.anc(sb.x2c-(mb||this.MNc)),this.MNc=-1):this.u2.failedCount++}RHd(){this.u2.excludingFirstAction=sb.NAf(this.Ejb);this.Ejb.push(this.u2.firstAction);this.u2.includingFirstAction=sb.NAf(this.Ejb)}anc(va){this.u2.count?1E3>this.u2.count&&this.Ejb.push(va):this.u2.firstAction=va;
this.beg&&this.ceg&&this.ceg.forEach(mb=>{va>mb&&this.u2.countAboveThresholds[mb]++});this.u2.count++}static NAf(va){const mb=Object.assign({},Ba);0<va.length&&(Ge.b(va),mb.median=va[Math.floor(.5*va.length)],mb.P75=va[Math.floor(.75*va.length)],mb.P95=va[Math.floor(.95*va.length)],mb.max=va[va.length-1],mb.average=va.reduce((Tb,yc)=>Tb+yc)/va.length);return mb}}Object(Aa.a)(sb,"PerformanceMeasurement",null,[]);const Ba={average:0,max:0,median:0,P75:0,P95:0},V={count:0,countAboveThresholds:void 0,
failedCount:0,firstAction:0,includingFirstAction:Object.assign({},Ba),excludingFirstAction:Object.assign({},Ba)};class Fa{constructor(va){this.$=va;this.LU=this.$Nb=null;this.usage={};this.VWc={};this.performance={};this.details={};this.$pa=-1;this.Xi=(mb,Tb)=>{Tb.$l||Tb.Aob||this.$.sendBeaconTraceTag(388818255,50,!1,this.Iac())};this.editBox=Object(Ia.f)(this.$).Dh;va.Pp(this.Xi)}static getInstance(va){return Fa.instance||(Fa.instance=new Fa(va))}set trigger(va){this.$Nb=va;this.$pa=sb.x2c}set bKg(va){this.LU=
va}C6b(va){Object(Cc.c)(this.details.color)&&(this.details.color={});Object(Cc.c)(this.details.color[va])&&(this.details.color[va]=0);this.details.color[va]++}setResult(va,mb){if(Object(Cc.c)(this.$Nb))ub.ULS.sendTraceTag(512258439,0,15,"ValuePreviewTelemetry.setResult - currentTrigger undefined");else if("Failure"!==va.kind||va.timeout){var Tb=mb===this.editBox?"cellEditor":"formulaBar",yc=this.$Nb;mb=this.LU;var Nc=this.$pa;Object(Cc.c)(this.usage[Tb])&&(this.usage[Tb]={});Object(Cc.c)(this.usage[Tb][yc])&&
(this.usage[Tb][yc]={success:0,error:0,loading:0,timeout:0});Tb=this.usage[Tb][yc];switch(va.kind){case "Success":8===va.operKind?Tb.error++:(this.jik(va.value),Tb.success++);this.$Nb=this.LU=null;this.$pa=-1;this.O5(mb,Nc);break;case "Loading":Tb.loading++;break;case "Failure":this.$Nb=this.LU=null,this.$pa=-1,va.timeout&&Tb.timeout++}}}jik(va){if(!Object(Cc.c)(this.LU)){Object(Cc.c)(this.VWc[this.LU])&&(this.VWc[this.LU]=[]);var mb=this.VWc[this.LU];1E3>mb.length&&mb.push(va.length)}}O5(va,mb){if(-1!==
mb){va=null!==va&&void 0!==va?va:"cache";this.iTb(`${va}_request`).N5(!0,mb);var Tb=this.iTb(`${va}_overall`);window.requestAnimationFrame(()=>{Tb.N5(!0,mb)})}}iTb(va){return this.performance[va]=this.performance[va]||new sb(sc)}Iac(){const va={};Object.keys(this.performance).forEach(mb=>{this.performance[mb].RHd();var Tb=this.performance[mb];va[mb]={metrics:Tb.u2,durations:Tb.Ejb}});return`{"usage":${JSON.stringify(this.usage)},"resultLengths":${JSON.stringify(this.VWc)},"performance":${JSON.stringify(va)},"details":${JSON.stringify(this.details)}}`}}
Object(Aa.a)(Fa,"ValuePreviewTelemetry",null,[]);const sc=[50,80,100,130,150,170,200],Kc=(va,mb)=>{mb=void 0===mb?!1:mb;const Tb=Fa.instance;if(Object(Cc.c)(va))return mb&&Tb.C6b("none"),null;if("string"==typeof va){va=Ne.a.tOc[va.toLowerCase()];if(Object(Cc.c)(va))return mb&&Tb.C6b("badString"),null;mb&&Tb.C6b("string");return va}if("number"==typeof va)return mb&&Tb.C6b("number"),null;mb&&Tb.C6b("other");return null};class qd{constructor(va,mb){this.$=va;this.pluginScheduler=mb;this.jT=new Eb(w);
this.F_c=!0;this.Nlj=Gc.EwaSettings.isChangeGateEnabled("OfficeVSO:8544629_ValuePreviewFailureCaching");this.UWb=Gc.EwaSettings.isChangeGateEnabled("OfficeVSO:8501487_ValuePreviewDetectVolatile");this.rKc=Gc.EwaSettings.isChangeGateEnabled("OfficeVSO:8561808_ValuePreviewSnapshotActiveCell");this.Wvf=(Tb,yc,Nc)=>{const zd=this;return xo(function*(){return new Promise((fe,Ud)=>{const P={Formula:yc,IsWholeFormula:Tb===yc,ActiveCell:zd.RXi(Nc)};var Da=zd.$.oa.ta;fe=zd.p0j(fe);Ud=zd.o0j(Ud);const eb=Da.Za(1,
null);eb.evaluationParameters=P;ze.h(Da,"EvaluatePartialFormula",eb,fe,Ud,null,null,128)})})};this.p0j=Tb=>yc=>{if(Object(Cc.c)(yc.Result))Tb({kind:"Failure",reason:"No result",stateId:yc.StateId});else{var Nc=yc.Result,zd=r(Nc.Value);Object(Cc.b)(zd)?Tb({kind:"Failure",reason:zd,stateId:yc.StateId}):Tb({kind:"Success",value:Nc.Value,unformattedValue:Nc.UnformattedValue,operKind:Nc.OperKind,color:Nc.Color,stateId:yc.StateId})}};this.o0j=Tb=>yc=>{yc=ld.a.$j(yc.data);yc=Ed.a.fi(yc);Tb(`Request failed, Errors: ${yc}`)};
this.da=Object(Ia.f)(this.$);this.WF=la.a.lh(db.Gc);this.dKg=new ge(this.$,this.da);this.kD=Fa.getInstance(va)}clearCache(){this.jT.clear()}Wle(va,mb,Tb){Tb=void 0===Tb?!1:Tb;const yc=this;return xo(function*(){yc.F_c=Tb;const Nc=yc.request(va);let zd;const fe=new Promise(Ud=>{zd=window.setTimeout(()=>{Ud({kind:"Failure",timeout:!0})},mb)});return Promise.race([Nc,fe]).finally(()=>{window.clearTimeout(zd)})})}request(va){const mb=this;return xo(function*(){return v(mb.jT,va,()=>xo(function*(){var Tb;
let yc=null;var Nc=null;mb.rKc&&(yc=Object(Fc.q)(mb.da.ha.pa.activeCell,mb.$),Nc={sheetName:null===(Tb=mb.$.la)||void 0===Tb?void 0:Tb.sheetId,namedObjectName:null,firstRow:yc.FirstRow,firstColumn:yc.FirstColumn});Nc=mb.rKc?Object.assign({},va,{activeCell:Nc}):va;Tb=mb.dKg.BPd();Nc=yield mb.pluginScheduler.requester().valuePreview(Nc,mb.WF?mb.WF.c6a:fd.PluginGroup.Excel,null);if("Done"!==Nc.kind)return"Superseded"===Nc.kind&&mb.jT.delete(va),null;Nc=Nc.payload;if(Object(Cc.c)(Nc))return{kind:"Failure"};
mb.F_c&&(mb.kD.bKg="client",void mb.dKg.bXh(va,Nc,Tb,mb.Wvf,yc));switch(Nc.kind){case "Failure":return mb.Nlj&&mb.jT.delete(va),{kind:"Failure"};case "Success":return mb.UWb&&Nc.isVolatile&&mb.jT.delete(va),mb.Hel(Nc);case "Unavailable":return void mb.yDj(va.text,Nc),mb.jT.delete(va),mb.wtk({text:va.text,index:Nc.index,length:Nc.length},va,va.text,Nc.evaluatedFormula,yc,!Nc.isVolatile)}}))})}Hel(va){va=Object.assign({},va,{color:Kc(va.color,this.F_c)});const mb=r(va.value);return Object(Cc.b)(mb)?
(ub.ULS.sendTraceTag(509871621,1,15,`FormulaAssistanceValuePreviewRequester.validateClientSuccessResult: formula failure:${mb}, kind:${va.kind}`),{kind:"Failure"}):va}wtk(va,mb,Tb,yc,Nc,zd){const fe=this;return xo(function*(){return f(fe.jT,va,mb,zd,()=>(new Promise((Ud,P)=>xo(function*(){try{const Da=yield fe.Wvf(Tb,yc,Nc);fe.F_c&&(fe.kD.bKg="server");"Success"===Da.kind?Ud({kind:"Success",value:Da.value,index:va.index,length:va.length,color:Da.color,operKind:Da.operKind}):(ub.ULS.sendTraceTag(508831818,
1,50,`FormulaAssistanceValuePreviewRequester.requestFromServer: evaluatePartialFormula failed, ${Da.reason}`),Ud({kind:"Failure"}))}catch(Da){ub.ULS.sendTraceTag(520495426,1,15,`FormulaAssistanceValuePreviewRequester.requestFromServer: evaluatePartialFormula rejected, ${Da}`),P(Da)}}))).catch(()=>{fe.jT.delete(va);fe.jT.delete(mb);return{kind:"Failure"}}))})}yDj(va,mb){return xo(function*(){var Tb=yield la.a.resolve(db.Dc,{va:1});const yc=Qb.Range.yi(0,0),Nc=Tb.anonymize(va,yc);Tb=Tb.anonymize(mb.evaluatedFormula,
yc);ub.ULS.sendTraceTag(507799744,1,50,`FormulaAssistanceValuePreviewRequester.logUnavailableResult: ${JSON.stringify({formula:Nc,evaluatedFormula:Tb,reason:mb.reason})}`)})}RXi(va){const mb=Object(Fc.q)(this.da.ha.pa.activeCell,this.$);if(this.rKc&&Object(Cc.b)(va)){const Tb=Object(Fc.e)(va,mb);0<Tb.length&&ub.ULS.sendTraceTag(507777487,1,20,`FormulaAssistanceValuePreviewRequester.getSheetCell: cell diffs: ${Tb.join(",")}`)}return this.rKc?va:mb}}Object(Aa.a)(qd,"FormulaAssistanceValuePreviewRequester",
null,[]);class Eb{constructor(va){this.F2c=va;this.map=new Map}has(va){va=this.F2c(va);return this.map.has(va)}get(va){va=this.F2c(va);return this.map.get(va)}set(va,mb){va=this.F2c(va);this.map.set(va,mb);return this}delete(va){va=this.F2c(va);return this.map.delete(va)}clear(){this.map.clear()}}Object(Aa.a)(Eb,"RequestMap",null,[]);Object(la.b)(db.Jc,{rk:"singleton"})(va=>xo(function*(){const mb=yield la.a.resolve(db.Ob,va),Tb=yield la.a.resolve(Hf.f,va);return new qd(mb,Tb)}));Object(la.b)(db.Kc)(va=>
xo(function*(){yield la.a.resolve(db.Vb,va);return excelOnlineCalc.FormulaAuthoringHelperSingletonGlobal.instance()}));var vc;let Kd=vc=class extends ob.a{constructor(va){super(va,vc.featureName);this.aXf=!0}get el(){return Cb.a.IJd}show(va,mb,Tb,yc,Nc,zd,fe,Ud){zd=void 0===zd?null:zd;return this.nyb(void 0===fe?null:fe,P=>{appChrome.renderFormulaSuggestionCard(va,mb,this.domElement,P.y,P.x,P.y+P.height,P.x+P.width,Tb,yc,Nc,zd,this.yxb,Ud?{explanationKey:Ud.explanationKey,replacements:Ud.explanationReplacements,
notifyExplanationSuccessful:Ud.MPc}:void 0)})}Kue(va,mb,Tb,yc,Nc,zd,fe,Ud,P,Da,eb){return this.nyb(eb,bc=>{appChrome.renderRowNumberingSuggestionCard(va,mb,this.domElement,bc.y,bc.x,bc.y+bc.height,bc.x+bc.width,Tb,yc,Nc,zd,fe,Ud,P,Da,this.yxb)})}d_(va,mb,Tb){Gc.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FBEPluginDebugUI",!1)&&(this.s5&&va.equals(this.w2d)||(this.s5&&document.body.removeChild(this.s5),this.w2d=va,va=this.grid.yh(va),va=this.grid.getCellBounds(va.cell,!0),this.s5=document.createElement("div"),
this.s5.setAttribute("style",`position:fixed;
        left: ${va.x+va.width}px;
        top: ${va.y+va.height/2}px`),document.body.appendChild(this.s5)),va=new pc.a(-847286761,0,this.$.ji,0,null),this.$.Ia.qh(va,{["CalloutName"]:15,["Target"]:this.s5,["NewState"]:mb,["Reason"]:Tb}))}};Kd=vc=Object(ea.__decorate)([Object(la.d)(db.Mc),Object(ea.__param)(0,Object(db.Ob)())],Kd);Object(Aa.a)(Kd,"FormulaByExampleCardUIControl",ob.a,[724]);class Zd{constructor(va,mb,Tb){this.pluginScheduler=va;this.Nw=mb;this.Fab=Tb;this.dCd=Gc.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FBEPluginDebugUI",
!1)}BIg(va,mb){const Tb=this;return xo(function*(){var yc,Nc,zd,fe;let Ud=null;Tb.Nw.Tja(mb,0);var P={context:Object(Fc.hb)(va)};Tb.dCd&&Tb.Fab.CSk(va);P=yield Tb.pluginScheduler.requester().columnFormulaSuggestion(P,fd.PluginGroup.Excel,mb.toString());"Done"===P.kind&&(null===(yc=P.payload)||void 0===yc?0:yc.suggestions)&&P.payload.suggestions[0]&&(yc=P.payload.suggestions[0],P=yc.metadata,"ColumnFormulaSuggestion"===yc.kind?(Tb.Nw.Tja(mb,5,{formula:P.rawFormula,Gaa:P.anonymizedFormula,tT:null!==
(Nc=P.seenCount)&&void 0!==Nc?Nc:null,kba:null!==(zd=P.isCacheHit)&&void 0!==zd?zd:null,cpa:null!==(fe=P.latestOutcome)&&void 0!==fe?fe:null}),Ud=Tb.MNi(yc),Tb.dCd&&Tb.Fab.KWg(va,`formula found: "${yc.metadata.rawFormula||yc.formula}"`)):("no formula found"===yc.reason?Tb.Nw.Tja(mb,1,{errorMessage:null,tT:P.seenCount,kba:P.isCacheHit,cpa:P.latestOutcome}):Tb.Nw.Tja(mb,1,{errorMessage:yc.reason,tT:null,kba:null,cpa:null}),Tb.dCd&&Tb.Fab.KWg(va,yc.reason)));Tb.Nw.Ujb(mb);return Ud})}Lgg(va,mb){const Tb=
this;return xo(function*(){yield Tb.pluginScheduler.eventEmitter().FBEOutcomeUpdate({flowId:va,suggestionOutcome:{outcome:mb}});return!0})}MNi(va){if(!va||!va.evalResults)return null;const mb=va.evalResults.map(Tb=>{if("FormulaSuggestionEvalFailureResult"===Tb.kind)return{kind:"Failure",cell:Object(Fc.eb)(Tb.cell),value:Tb.error};let yc,Nc;switch(Tb.value.kind){case "number":Nc="Success";yc=Tb.value.num;break;case "string":Nc="Success";yc=Tb.value.text;break;case "boolean":Nc="Success";yc=Tb.value.flag;
break;case "error":Nc="ExcelAppError",yc=Tb.value.errorValue}return{kind:Nc,cell:Object(Fc.eb)(Tb.cell),value:yc,format:Tb.formatted}});return{flowId:Number(va.suggestionID),columnRange:Object(Fc.eb)(va.columnRange),tableName:va.tableName,tableColumnName:va.tableColumnName,suggestions:[{formula:va.formula,Gaa:va.metadata.formulaAnonymized,cells:mb,tableName:va.tableName,explanation:{explanationKey:va.metadata.explanationKey,explanationReplacements:va.metadata.explanationReplacements},metadata:va.metadata}]}}}
Object(Aa.a)(Zd,"FormulaByExamplePluginCommunicator",null,[779]);var nb=a(285);class ic{constructor(va,mb){this.da=va;this.Mj=mb;this.ptf=new Set;this.pZ=(Tb,yc)=>{if(Tb=this.da.oh.Ml(yc.Gq,!1))if(yc=this.Q_i(Tb,yc.Gq.left))this.ptf.has(yc)?(this.Exh(),this.da.Dh.J2(this.pZ)):this.ptf.add(yc)};this.Exh=()=>{nb.a.GV("XLS-FormulaByExample-Treatment;XLS-FormulaByExample-Control")};this.Q_i=(Tb,yc)=>{const Nc=this.Mj.e0a(Tb);if(!Nc)return null;const zd=Tb.usedRange,fe=yc-zd.left;return 0>fe||fe>=Nc.length?
(ub.ULS.sendTraceTag(537161876,306,10,`FormulaByExampleSuggestionCache.getUniqueTableColumnIdentifier: invalid inputs. tableRange: ${zd}, columnNumber: ${yc}, `+`areAllTableHeadersAvailable: ${this.Mj.v7e(Tb,Nc)}`),null):(yc=Nc[fe])?Tb.name+"_"+yc:null};this.da.Dh.zX(this.pZ)}}Object(Aa.a)(ic,"FormulaByExampleScorecardTriggerReporter",null,[]);var Bc;(function(va){va.PreviewAlreadyShowing="PreviewAlreadyShowing";va.StrictDataMismatch="StrictDataMismatch";va.LackingPrefetchedResults="LackingPrefetchedResults";
va.RangeNotLoaded="RangeNotLoaded";va.InvalidCalcResults="InvalidCalcResults";va.ErrorsInEvaluation="ErrorsInEvaluation";va.InternalPreviewError="InternalPreviewError";va.WorkbookModelUpdateFailed="WorkbookModelUpdateFailed";va.FailedToPreviewActiveCell="FailedToPreviewActiveCell";va.Unknown="Unknown"})(Bc||(Bc={}));Object(Aa.b)("FormulaPreviewErrorKind",Bc);var Qc=a(121);class pd{constructor(va,mb,Tb,yc){this.$=va;this.da=mb;this.qhb=Tb;this.KJd=yc;this.bD=null;this.vYc=()=>{ub.ULS.sendTraceTag(537161889,
306,50,"FormulaByExampleManager.SendByExampleFeedback: opening send feedback dialog after click on card.");const Nc={};Nc[Xa.a.QM]="FormulaByExampleCard";this.$.oi(802602464,0,8,Nc)};this.$Tb=()=>{};this.nia=(Nc,zd)=>{0===zd.zx&&576!==zd.Xl.operation.operationName&&(this.bD&&this.bD.eba(`UserOperation: ${Qc.a(zd.Xl.operation.operationName)}`),this.$.userOperationManager.vu(this.nia))}}pTk(va,mb,Tb,yc){yc=void 0===yc?!1:yc;const Nc=this;return xo(function*(){try{const zd=Object(Fc.F)(mb.columnRange),
fe=Tb.cells.map(t),Ud=yield Nc.KJd.rTk(Tb.formula,zd,Pc=>{Nc.$Tb(Pc,va,mb,Tb)},{stateId:0,results:fe},yc);if(!Ud.success)return{z2:"UNSEEN",lLb:`FormulaByExampleUIManager.showFormulaPreview failed: ${Ud.error}`,P7a:null};Nc.bD=Ud.bD;const P=Nc.$.isFeedbackEnabled?Nc.vYc:null;let Da=null,eb=!1,bc;Gc.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaByExample.ShowRowNumberingCard",!1)&&x(Tb.Gaa)?(Da={isAcceptAsValues:!1,maxTooltipOpenDurationMS:0,isFurtherExplanationHyperlinkClicked:!1,
disableApplyAsValue:1E4<Tb.cells.length},bc=()=>Nc.qhb.Kue(Tb.formula,zd.toString(),()=>{Nc.bD.Uta("CardUI")},()=>{Da.isAcceptAsValues=!0;Nc.bD.Uta("CardUI")},Da.disableApplyAsValue,()=>Nc.bD.pIa("CardUI"),Pc=>{Da.maxTooltipOpenDurationMS=Math.max(Da.maxTooltipOpenDurationMS,Pc)},()=>{Da.isFurtherExplanationHyperlinkClicked=!0},P,()=>eb=!0,va)):bc=()=>Nc.qhb.show(Tb.formula,zd.toString(),()=>Nc.bD.Uta("CardUI"),()=>Nc.bD.pIa("CardUI"),P,()=>eb=!0,va,Tb.explanation&&Tb.explanation.explanationReplacements?
Object.assign({},Tb.explanation,{MPc:()=>{}}):void 0);bc();Nc.bD.f6e(()=>{Nc.qhb.hide()});Nc.bD.wqd(()=>{bc()});Nc.$.userOperationManager.qw(Nc.nia);return Nc.bD.a7b.then(Pc=>{Nc.qhb.hide();Nc.$.userOperationManager.vu(Nc.nia);return Object.assign({},Pc,{P7a:Da,qRk:eb})})}catch(zd){return{z2:"UNSEEN",lLb:`FormulaByExampleUIManager.showSuggestionPreview failed: ${zd}`,P7a:null}}})}CSk(va){this.qhb.d_(va,7)}KWg(va,mb){this.qhb.d_(va,8,mb)}}Object(Aa.a)(pd,"FormulaByExampleUIManager",null,[]);var Xd=
a(192),ue=a(216);Object(la.b)(db.Nc)(va=>xo(function*(){const mb=yield la.a.resolve(db.Ob,va),Tb=yield la.a.resolve(db.Rc,va),yc=yield la.a.resolve(db.G,va),Nc=yield la.a.resolve(db.Mc,va),zd=Ia.f(mb);let fe=null;if(yield Hd.a.h2a(mb))fe=(yield la.a.resolve(db.xg,va)).Taa();const Ud=yield la.a.resolve(Hf.f,va),P=yield la.a.resolve(db.Oc);return new Ie(mb,zd,new ic(zd,yc),Nc,fe,Tb,Ud,P,yc)}));class Ie{constructor(va,mb,Tb,yc,Nc,zd,fe,Ud,P){this.$=va;this.da=mb;this.cH=yc;this.W9a=Nc;this.KJd=zd;this.Mj=
P;this.mHa=null;this.requestId=1;this.D8j=Gc.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaByExamplePluginCommunication",!1);this.SYk=Gc.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaByExamplePluginEvaluationEnabled",!1);this.RYk=Gc.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaByExamplePluginSuggestionShowing",!1);this.LNa=(Da,eb)=>{const bc=eb.f6.range,Pc=eb.TJc;void this.JSc.BIg(bc,-1).then(gd=>void this.upg(gd,bc,Pc,{yrf:"EditStart"}))};
this.pZ=(Da,eb)=>{Da=eb.Gq;eb.committed&&(eb=this.requestId++,this.yOg(Da,eb,!1,"EditEnd"))};this.onPaste=(Da,eb)=>{(Da=eb.gqf)&&1===Da.length&&(Da=Da[0],Da.QY&&(eb=eb.uo)&&1804571062!==eb&&1766348718!==eb&&this.da.SD(Da)&&this.yOg(Da.center,this.requestId++,!0,"Paste"))};this.kae=Da=>{void this.JSc.Lgg(Da.flowId,"UNDO")};(this.TAi=Hd.a.MLa(this.$))&&this.D8j&&(this.xne=Gc.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.FormulaByExampleRowsBelowRangeTableToQuery",1),this.Fab=new pd(this.$,this.da,
this.cH,this.KJd),this.JSc=new Zd(fe,Ud.COf("Plugin"),this.Fab),this.da.Dh.fM(this.LNa),this.da.Dh.zX(this.pZ),this.$.qa.zi(254,Da=>{Da.bJb(this.onPaste)}))}yOg(va,mb,Tb,yc){Tb=void 0===Tb?!0:Tb;this.O6b();this.mHa=this.da.za.QNa(()=>{const Nc=()=>{this.Mj.Z5b(Nc);void this.JSc.BIg(va,mb).then(zd=>{Tb&&void this.upg(zd,va,!1,{yrf:yc})})};this.Mj.QIb(Nc)})}upg(va,mb,Tb,yc){Tb=void 0===Tb?!1:Tb;const Nc=this;return xo(function*(){var zd,fe;if(Nc.SYk&&va&&va.suggestions&&0<va.suggestions.length){const Da=
va.suggestions[0];if(Nc.yQi(mb)&&Nc.RYk){var Ud=yield Nc.Fab.pTk(mb,va,Da,Tb);if("UNSEEN"!==Ud.z2){"ACCEPT"===Ud.z2&&((null===(zd=Ud.P7a)||void 0===zd?0:zd.isAcceptAsValues)?Nc.$Jh(Nc.zLd(mb),Da.cells,va.tableName):Nc.KJh(Nc.zLd(mb),Da.formula,mb),Nc.t5a=(eb,bc)=>{0===bc.zx&&(170===bc.Xl.operation.operationName&&Nc.kae(va),Nc.$.userOperationManager.vu(Nc.t5a),Nc.t5a=null)},Nc.$.userOperationManager.qw(Nc.t5a));yield Nc.JSc.Lgg(va.flowId,Ud.z2);zd=Object(Fc.F)(va.columnRange);var P=null!==Da.tableName;
Ud={["flowId"]:va.flowId,["caller"]:Ud.lLb,["displayTrigger"]:yc.yrf,["formulaAnonymized"]:Da.Gaa,["originalFormulaAnonymized"]:Da.Gaa,["suggestionOutcome"]:Ud.z2,["annotationRange"]:zd.toString(),["isFullyInViewport"]:Nc.da.SD(zd),["showFormulaClicked"]:Ud.qRk,["isSuggestionOnTable"]:P,["dataCulture"]:Nc.$.m9,["UICulture"]:Nc.$.dataCultureTag,["formulaExplanation"]:{explanationKey:null===(fe=Da.explanation)||void 0===fe?void 0:fe.explanationKey},["IsPlugin"]:!0};ub.ULS.sendTraceTag(388780100,306,
20,`FormulaByExampleManager.handlePreviewResult: FormulaByExample flow results: ${JSON.stringify(Ud)}`)}}}})}KJh(va,mb,Tb){mb=Object(Ld.a)(new jd.a,{Text:mb});this.da.setCell(mb,Tb,1,127,null,0,{range:va,origin:Tb},2)}$Jh(va,mb,Tb){va={FirstRow:va.top-1,FirstColumn:va.left-1,LastRow:va.bottom-1,LastColumn:va.right-1,SheetName:this.$.sa.la.name,NamedObjectName:Tb};mb=mb.map(yc=>[yc.value.toString()]);this.j7c(va,mb)}j7c(va,mb){const Tb=new ue.a(163,0,(yc,Nc,zd)=>{const fe=this.$.oa.ta,Ud=fe.Za(0);
Ud.rangeToSet=va;Ud.rangeValues=mb;return ze.h(fe,"SetRange",Ud,(P,Da,eb)=>{yc(P,Da,eb)},(P,Da,eb)=>{Nc(P,Da,eb)},zd,this.$.oa.ta.Wh(),0)},65);this.$.userOperationManager.enqueueOperation(Tb,null)}yQi(va){va=this.zLd(va);return null===va||void 0===va?void 0:va.Fk(this.da.Wp)}zLd(va){const mb=this.Vga(va);return mb?new Qb.Range(mb.Gx.top,va.left,mb.Gx.bottom,va.right,!0,!0):null}Vga(va){const mb=this.da.oh.Ml(va,!1);if(mb)return{Gx:Object(Xd.a)(mb),tV:!0,kN:!1};if(this.W9a){const {V4b:Tb,kN:yc}=this.$Oi(va);
if(Tb)return{Gx:Tb,tV:!1,kN:yc}}return null}$Oi(va){const mb=new Qb.Range(va.top-this.xne,va.left,va.bottom,va.right,!0,!0),Tb=this.W9a.BKa(new of.a(mb,Object(ac.d)(this.$.la)),6);if(!Tb)return null;for(const yc of Tb)for(const Nc of yc.table.interpretations)if(2===Nc.orientation&&.5<Nc.confidence)return{V4b:this.g8h(Nc,mb),kN:!Nc.tableLocation.$i(va)};return{V4b:null,kN:!1}}g8h(va,mb){return new Qb.Range(va.tableLocation.top+va.headerRowCount,va.tableLocation.left+va.headerColumnCount,Math.max(va.tableLocation.bottom,
mb.bottom),va.tableLocation.right,!0,!0)}O6b(){var va;null===(va=this.mHa)||void 0===va?void 0:va.call(this);this.mHa=null}}Object(Aa.a)(Ie,"FormulaByExamplePluginTriggersManager",null,[]);const Je={N2:null,Ria:null,formula:null,Gaa:null,errorMessage:null,kba:null,tT:null,cpa:null};let He=class{constructor(){this.S3b=new Map;this.e_b=new Map;this.OId=new Map}COf(va){return new hf(this,va)}Tja(va,mb,Tb,yc){mb=mb?this.S3b:this.e_b;if(!mb.has(va))if(0===Tb)mb.set(va,Object.assign({},Je));else return;
const Nc=mb.get(va);switch(Tb){case 0:Nc.N2=performance.now();break;case 2:mb.set(va,Object.assign({},Nc,yc));break;case 3:case 1:case 5:Nc.Ria=performance.now();mb.set(va,Object.assign({},Nc,yc));break;case 4:Nc.kba||(Nc.Ria=performance.now(),mb.set(va,Object.assign({},Nc,yc)))}}Ujb(va){if("BothComplete"===this.qDc(va))this.Z9f(va);else{const mb=window.setTimeout(()=>{"BothComplete"!==this.qDc(va)&&(this.S3b.has(va)||this.e_b.has(va))&&this.Z9f(va)},15E3);this.OId.set(va,mb)}}Z9f(va){var mb=this.S3b.get(va);
const Tb=this.e_b.get(va);var yc=(null===Tb||void 0===Tb?void 0:Tb.errorMessage)||(null===mb||void 0===mb?void 0:mb.kba)===(null===Tb||void 0===Tb?void 0:Tb.kba)&&(null===mb||void 0===mb?void 0:mb.tT)===(null===Tb||void 0===Tb?void 0:Tb.tT)&&(null===mb||void 0===mb?void 0:mb.cpa)===(null===Tb||void 0===Tb?void 0:Tb.cpa);yc="BothComplete"===this.qDc(va)&&yc&&(null===mb||void 0===mb?void 0:mb.formula)===(null===Tb||void 0===Tb?void 0:Tb.formula)&&(null===mb||void 0===mb?void 0:mb.errorMessage)===(null===
Tb||void 0===Tb?void 0:Tb.errorMessage);const Nc="AwaitTask failed - no annotation found"===(null===mb||void 0===mb?void 0:mb.errorMessage)&&(null===Tb||void 0===Tb?void 0:Tb.N2)&&!(null===Tb||void 0===Tb?0:Tb.Ria);yc||Nc?ub.ULS.sendTraceTag(84165970,306,20,`FBE plugin validator compared successfully: ${JSON.stringify({["flowID"]:va,["pluginStartTime"]:mb.N2,["pluginEndTime"]:mb.Ria,["legacyStartTime"]:Tb.N2,["legacyEndTime"]:Tb.Ria,["pluginRequestDuration"]:mb.Ria-mb.N2,["legacyRequestDuration"]:Tb.Ria-
Tb.N2,["firstStartReported"]:mb.N2<Tb.N2?"Plugin":"Legacy",["error"]:mb.errorMessage,["formula"]:mb.Gaa,["isCacheHit"]:mb.kba,["seenCount"]:mb.tT,["latestOutcome"]:mb.cpa})}`):this.Doj(null===Tb||void 0===Tb?void 0:Tb.errorMessage)&&(mb={["flowId"]:va,["pluginStartTime"]:null===mb||void 0===mb?void 0:mb.N2,["pluginEndTime"]:null===mb||void 0===mb?void 0:mb.Ria,["legacyStartTime"]:null===Tb||void 0===Tb?void 0:Tb.N2,["legacyEndTime"]:null===Tb||void 0===Tb?void 0:Tb.Ria,["successfulFlows"]:this.qDc(va),
["pluginError"]:null===mb||void 0===mb?void 0:mb.errorMessage,["legacyError"]:null===Tb||void 0===Tb?void 0:Tb.errorMessage,["pluginFormula"]:null===mb||void 0===mb?void 0:mb.Gaa,["legacyFormula"]:null===Tb||void 0===Tb?void 0:Tb.Gaa,["pluginCacheHit"]:null===mb||void 0===mb?void 0:mb.kba,["legacyCacheHit"]:null===Tb||void 0===Tb?void 0:Tb.kba,["pluginSeenCount"]:null===mb||void 0===mb?void 0:mb.tT,["legacySeenCount"]:null===Tb||void 0===Tb?void 0:Tb.tT,["pluginLatestOutcome"]:null===mb||void 0===
mb?void 0:mb.cpa,["legacyLatestOutcome"]:null===Tb||void 0===Tb?void 0:Tb.cpa},ub.ULS.sendTraceTag(84165957,306,20,`FBE plugin validator comparison failure: ${JSON.stringify(mb)}`));this.S3b.delete(va);this.e_b.delete(va);if(mb=this.OId.get(va))clearTimeout(mb),this.OId.delete(va)}qDc(va){var mb=this.e_b.get(va),Tb=this.S3b.get(va);va=null===Tb||void 0===Tb?void 0:Tb.N2;Tb=null===Tb||void 0===Tb?void 0:Tb.Ria;const yc=null===mb||void 0===mb?void 0:mb.N2,Nc=null===mb||void 0===mb?void 0:mb.Ria;mb=
Gc.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaByExamplePluginCacheEnabled",!1)?null!==(null===mb||void 0===mb?void 0:mb.kba)||null!==(null===mb||void 0===mb?void 0:mb.errorMessage):!0;return va&&Tb&&yc&&Nc&&mb?"BothComplete":va&&Tb?"PluginComplete":yc&&Nc&&mb?"LegacyComplete":"NoneComplete"}Doj(va){return"signal lock"!==va&&"AL is undefined"!==va&&"tableRange does not intersect loaded range"!==va&&"table return null for table suggestion"!==va&&"column has non uniform data"!==
va&&"consistent block cache callback cancelled"!==va}};He=Object(ea.__decorate)([Object(la.d)(db.Oc)],He);Object(Aa.a)(He,"FormulaByExamplePluginValidator",null,[]);class hf{constructor(va,mb){this.Q9g=va;this.tJc="Plugin"===mb;this.tJc||(this.W7f=new Map)}Tja(va,mb,Tb){(va=this.BOf(va))&&this.Q9g.Tja(va,this.tJc,mb,Tb)}Ujb(va){(va=this.BOf(va))&&this.Q9g.Ujb(va)}oSg(va,mb){this.tJc||this.W7f.set(va,mb)}BOf(va){return this.tJc?va:this.W7f.get(va)}}Object(Aa.a)(hf,"FormulaByExamplePluginValidatorProxy",
null,[]);var rf=a(977);Object(la.b)(db.Pc,{rk:"singleton"})(va=>xo(function*(){const mb=yield la.a.resolve(db.Ob,va),Tb=yield Hd.a.h2a(mb),[yc,Nc,zd,fe,Ud]=yield Promise.all([la.a.resolve(db.G,va),la.a.resolve(db.r,va),Tb?la.a.resolve(db.xg,va):Promise.resolve(null),la.a.resolve(db.zc,va),Gc.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FBEPersistentCache",!1)?la.a.resolve(db.xd):Promise.resolve(null)]);let P,Da,eb;P=yield la.a.resolve(db.Nc,va);Da=yield la.a.resolve(db.Oc,va);eb=Gc.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaByExamplePluginCacheEnabled",
!1)?yield la.a.resolve(Hf.f,va):null;return new rf.a(mb,yc,Nc,zd,fe,P,Tb,Ud,Da,eb)}));class qf extends Map{constructor(va){super();this.aca=va}set(va,mb){if(!this.has(va)&&this.size>=this.aca){const [Tb]=this.entries().next().value;this.delete(Tb)}return super.set(va,mb)}has(va){if(super.has(va)){const mb=this.get(va);this.delete(va);super.set(va,mb);return!0}return!1}}Object(Aa.a)(qf,"LimitedSizeHotMap",Map,[]);const We=va=>`${va.top}_${va.left}`;let Jf=class{constructor(va){this.Lh=va;this.W5a=
new Map;this.Ttb=new Map;this.YHj=Gc.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.FormulaByExampleMinRowsForLocks",3);this.fHj=Gc.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.FormulaByExampleMaxLocksPerSession",3);this.lQa=new qf(this.fHj);this.Upc=!1;this.U0j=(mb,Tb,yc)=>{if(yc.reduce((fe,Ud)=>fe+Ud.bottom-Ud.top+1,0)<this.YHj)ub.ULS.sendTraceTag(508036641,0,50,"FormulaByExampleSignalLocksManager.onSignalSent: not enough rows to lock by");else{this.lQa.has(Tb)&&this.lQa.delete(Tb);
for(const fe of yc){var Nc=this.Lh.Lva("FormulaByExampleSignalLocksManager.onSignalSent",fe);const Ud={j9f:fe,I3d:new Map};try{for(;Nc.$$mn();){const P=Nc.$$cu(),Da=P.Qn.value;Ud.I3d.set(We(P.range),Da)}}finally{Nc&&Nc.dispose()}if(zd)zd.k9f.push(Ud);else{Nc=yc[0].clone();yc.reduce((P,Da)=>{P.union(Da);return P},Nc);var zd={sheetId:rf.a.o1(this.Lh.la),columnId:Tb,NVk:Nc,k9f:[Ud]}}}this.W5a.set(mb,zd);this.Ttb.set(mb,window.setTimeout(()=>{this.W5a.has(mb)&&(this.W5a.delete(mb),this.Ttb.delete(mb),
ub.ULS.sendTraceTag(508036640,0,50,`FormulaByExampleSignalLocksManager.onSignalSent: pending lock timed out, deleting lock for column ${zd.columnId}`))},2E4))}};this.ZTj=mb=>{const Tb=this.Ttb.get(mb);Tb&&(window.clearTimeout(Tb),this.Ttb.delete(mb));this.W5a.has(mb)&&(ub.ULS.sendTraceTag(508036639,0,50,`FormulaByExampleSignalLocksManager.onFormulaFound: pending lock found and deleted for column ${this.W5a.get(mb).columnId}`),this.W5a.delete(mb))};this.$Tj=mb=>{const Tb=this.Ttb.get(mb);Tb&&(window.clearTimeout(Tb),
this.Ttb.delete(mb));if(mb=this.W5a.get(mb))this.lQa.set(mb.columnId,mb),ub.ULS.sendTraceTag(508036638,0,50,`FormulaByExampleSignalLocksManager.onFormulaNotFound: pending lock found, column locked: ${mb.columnId}`),this.Z9g()};this.onBlockCacheItemChanged=(mb,Tb)=>{Tb=Tb.Oj.block;mb=Tb.zj;Tb=this.DQi(mb,rf.a.o1(Tb.la));for(const yc of Tb){Tb=yc.k9f;for(const Nc of Tb)if(Nc.j9f.$i(mb)){Tb=Nc.j9f.clone().Fk(mb);Tb=this.Lh.Lva("FormulaByExampleSignalLocksManager.onBlockCacheItemChanged",Tb);try{for(;Tb.$$mn();){const zd=
Tb.$$cu(),fe=zd.Qn.value,Ud=We(zd.range);Nc.I3d.has(Ud)&&Nc.I3d.get(Ud)!==fe&&(this.lQa.delete(yc.columnId),ub.ULS.sendTraceTag(508036637,0,50,`FormulaByExampleSignalLocksManager.onBlockCacheItemChanged: existing lock's rows content changed, column unlocked: ${yc.columnId}, columnChanged: ${zd.range.left}`),this.Z9g())}}finally{Tb&&Tb.dispose()}}}}}Fjj(va){return this.lQa.has(va)}Z9g(){!this.Upc&&0<this.lQa.size?(this.Lh.sz(this.onBlockCacheItemChanged),this.Lh.bfb(this.onBlockCacheItemChanged),this.Upc=
!0):this.Upc&&0===this.lQa.size&&(this.Lh.Vz(this.onBlockCacheItemChanged),this.Lh.W5b(this.onBlockCacheItemChanged),this.Upc=!1)}DQi(va,mb){const Tb=[];for(const yc of this.lQa.values())yc.sheetId===mb&&yc.NVk.$i(va)&&Tb.push(yc);return Tb}};Jf=Object(ea.__decorate)([Object(la.d)(db.Qc),Object(ea.__param)(0,Object(db.Pc)())],Jf);Object(Aa.a)(Jf,"FormulaByExampleSignalLocksManager",null,[744]);var tf=a(1273),ff=a(327),xf=a(1128),Lf=a(143),Ig=a(452);Object(la.b)(db.Rc,{rk:"singleton"})(va=>xo(function*(){const [mb,
Tb,yc]=yield Promise.all([la.a.resolve(db.Ob,va),la.a.resolve(db.zc,va),la.a.resolve(db.G,va)]),Nc=Ia.f(mb);return new vf(Nc,Nc.DN,yc,Tb)}));class vf{constructor(va,mb,Tb,yc){this.da=va;this.DN=mb;this.Mj=Tb;this.xk=yc;this.tIa=[];this.mjb=[]}rTk(va,mb,Tb,yc,Nc){var zd=!0,fe=!0;zd=void 0===zd?!1:zd;fe=void 0===fe?!1:fe;Nc=void 0===Nc?!1:Nc;const Ud=this;return xo(function*(){if(Ud.DN.isActive)return rg("PreviewAlreadyShowing");let P;if(yc)P=yc;else{var Da=yield Ud.Vvf(mb,va,fe,void 0);if(!Da.success)return Da.error;
P=Da.results}if(zd&&!Ud.h$g(P))return rg("StrictDataMismatch");if(!Ud.M4c(P).isSuccess)return rg("WorkbookModelUpdateFailed");Da=P.results.find(eb=>"Success"===eb.kind&&eb.value.cell.row+1===Ud.da.ha.pa.activeCell.top&&eb.value.cell.col+1===Ud.da.ha.pa.activeCell.left);if(!Da)return rg("FailedToPreviewActiveCell");try{const eb=yield Ud.DN.T8(mb,bc=>Ud.$Tb(bc,va,mb,zd,fe,eb,Tb),{PreviewCellsRange:{FirstRow:mb.top,FirstColumn:mb.left,LastRow:mb.bottom,LastColumn:mb.right},RetainCellTextOnPreview:!0},
Ud.da.Dh.isEditing?{hQ:af(Da.value).toString(),W_c:Nc}:void 0);eb.wqd(()=>{Ud.M4c(P,!1)});void eb.a7b.then(bc=>{"ACCEPT"===bc.z2&&Ud.M4c(P,!0)});return{success:!0,bD:eb}}catch(eb){return rg("InternalPreviewError",eb)}})}Vvf(va,mb,Tb,yc){const Nc=this;return xo(function*(){const zd=va.Fk(Nc.da.Wp);if(!zd)return{success:!1,error:rg("RangeNotLoaded")};const fe=new Qb.Range(zd.top,zd.left,zd.top,zd.left,!0,!0),Ud=yield Nc.Mj.U5(null,zd,fe,mb,!0);if(!Nc.jIc(Ud))return{success:!1,error:rg("InvalidCalcResults")};
const P=Nc.Lvf(Ud);return 0===P.size||1===P.size&&P.has("Unavailable")?{success:!0,results:Ud}:Tb?Nc.toi(P,mb,yc,zd,fe):{success:!1,error:rg("ErrorsInEvaluation",P)}})}toi(va,mb,Tb,yc,Nc){const zd=this;return xo(function*(){if(!(1===va.size&&va.has("PreviousFailure")||2===va.size&&va.has("PreviousFailure")&&va.has("Unavailable")))return{success:!1,error:rg("ErrorsInEvaluation",va)};var fe=zd.Xdh(Tb);fe=yield zd.Mj.U5(fe,yc,Nc,mb,!0);if(!zd.jIc(fe))return{success:!1,error:rg("InvalidCalcResults")};
const Ud=zd.Lvf(fe);return 0===Ud.size||1===Ud.size&&Ud.has("Unavailable")?{success:!0,results:fe}:{success:!1,error:rg("ErrorsInEvaluation",Ud)}})}$Tb(va,mb,Tb,yc,Nc,zd,fe){const Ud=va.Oj.block,P=Tb.Fk(Ud.zj);if(!P)return!1;this.tIa.push(Ud);this.mjb.push(P);this.YVf&&!this.YVf.contains(P)&&this.gBh(P);void zd.a7b.then(()=>{this.IFg(P)});const Da=()=>{const eb=this;return xo(function*(){const bc=yield eb.wPj(mb,yc,Nc);null===fe||void 0===fe?void 0:fe(va,bc);eb.Mj.Z5b(Da)})};this.Mj.QIb(Da);return!1}gBh(va){this.xff(va,
!0)}IFg(va){this.xff(va,!1)}xff(va,mb){for(let yc=va.top;yc<=va.bottom;yc++)for(let Nc=va.left;Nc<=va.right;Nc++){var Tb=Qb.Range.yi(yc,Nc);if(Tb=this.da.yh(Tb))Tb.cell.Mue=mb&&!Tb.cell.hQ}}wPj(va,mb,Tb){const yc=this;return xo(function*(){if(!yc.tIa.length)return null;const Nc=yc.mjb.reduce((fe,Ud)=>{fe.union(Ud);return fe});var zd=yield yc.Vvf(Nc,va,Tb,yc.tIa.map(fe=>fe.zj));if(!zd.success)return yc.tIa=[],yc.mjb=[],rg("ErrorsInEvaluation",zd.error);if(mb&&!yc.h$g(zd.results))return yc.tIa=[],yc.mjb=
[],rg("StrictDataMismatch");zd=yc.M4c(zd.results);if(!zd.isSuccess)return yc.tIa=[],yc.mjb=[],rg("WorkbookModelUpdateFailed");yc.IFg(Nc);if(zd.isDirty)for(const fe of yc.tIa)yc.DN.g0b(fe);yc.tIa=[];yc.mjb=[];return null})}M4c(va,mb){mb=void 0===mb?!1:mb;var Tb=void 0===Tb?!1:Tb;var yc;let Nc=!1,zd;for(const eb of va.results){if(!Object(tf.a)(eb)){if("Unavailable"===eb.reason.kind)continue;return{isSuccess:!1,isDirty:Nc}}if(va=this.da.yh(jg(eb.value.cell)))if(mb)va.cell.text=va.cell.hQ,(null===(yc=
va.cell.q4b)||void 0===yc?0:yc.HorizontalAlignment)&&va.cell.c_(va.cell.q4b.HorizontalAlignment,!0,!0);else{var fe=eb.value.formatted,Ud=sg(eb.value.value.kind);fe=this.xk.waa(fe,Ud,xf.a,va);if(Object(ff.c)(fe)){Ud=va.cell;if(Ud.l6a){var P=Ud.l6a;var Da=fe.value.numFmt;P=P.Start===Da.Start&&P.End===Da.End&&P.Separator===Da.Separator}else P=Ud.hQ===fe.value.text;P||(Nc=!0);Ud.hQ=fe.value.text;Ud.l6a=fe.value.numFmt;P=1===va.Qn.type?parseFloat(va.Qn.value):va.Qn.value;Da=af(eb.value);Ud.eKg=Da===P;
P=new Ig.a;P.HorizontalAlignment=0===va.cell.horizontalAlignment?fe.value.horizontalAlignment:null;Ud.q4b=P;Tb&&(zd?zd.union(jg(eb.value.cell)):zd=jg(eb.value.cell))}else return{isSuccess:!1,isDirty:Nc}}}this.YVf=zd;return{isSuccess:!0,isDirty:Nc}}h$g(va){const mb=new Set;va=va.results;for(const yc of va.entries()){const [Nc,zd]=yc;if(!Object(tf.a)(zd)){var Tb=jg(zd.reason.cell);if(this.da.jj.Moa(Tb)){va.splice(Nc,1);mb.add("Contains hidden rows");continue}if(!this.da.SD(Tb)){va.splice(Nc,1);mb.add("Contains unavailable cells outside of view");
continue}return{success:!1,$Uc:["Unexpected unavailable cell"]}}Tb=zd.value;const fe=this.da.yh(jg(Tb.cell));if(!fe)continue;const Ud=fe.Qn.type;if(0!==Ud)if(2===Ud){if(2!==Tb.value.kind||Tb.value.value!==fe.Qn.value)return{success:!1,$Uc:["String value mismatch"]}}else{if(1===Ud&&(1!==Tb.value.kind||Tb.value._valueXL!==parseFloat(fe.Qn.value)))return{success:!1,$Uc:["Number value mismatch"]};if(4===Ud&&(8!==Tb.value.kind||Tb.value.type!==parseFloat(fe.Qn.value)))return{success:!1,$Uc:["Error value mismatch"]}}}return{success:!0,
$Uc:Array.from(mb)}}Xdh(va){const mb=[];for(const Tb of va){va=new Lf.a("FormulaColumnPreviewManager.GenerateConstantCellsCloneWrites",this.da,Tb);try{for(;va.moveNext();){const yc=va.get_current();mb.push({row:yc.cell.IH,column:yc.cell.RK,Qn:yc.Qn,formulaBarText:yc.Qn.value,text:yc.cell.text,to:yc.cell.to})}}finally{va&&va.dispose()}}return mb}Lvf(va){const mb=new Set;va=va.results;for(const Tb of va)Object(tf.a)(Tb)||mb.add(Tb.reason.kind);return mb}jIc(va){return(va=va.results)&&va.length?!0:!1}}
Object(Aa.a)(vf,"FormulaColumnPreviewManager",null,[749]);const rg=(va,mb)=>({success:!1,error:{kind:va,data:mb}}),jg=va=>new Qb.Range(va.row+1,va.col+1,va.row+1,va.col+1,!0,!0),sg=va=>{switch(va){case 1:return 1;case 2:return 2;case 8:return 4;case 4:return 3;default:return 0}},af=va=>{va=va.value;return 1===va.kind?va._valueXL:8===va.kind?Lb.a.hkb[va.type-1]:va.value};var Ef=a(41),be=a(431),h=a(265);Object(la.b)(db.Yc,{rk:"singleton"})(va=>xo(function*(){const mb=yield la.a.resolve(db.Ob,va);return new qc(mb)}));
class qc extends Ef.a{constructor(va){super();this.Zmh=[];this.EDf={};this.eKd={};this.W3=null;this.Pka=[];this.ZZa={};this.IXd=this.ked=!1;this.rrj=Hd.a.qrj();this.gmg=(mb,Tb)=>{ub.ULS.sendTraceTag(537161987,0,50,"FunctionInfoManager.OnGetFunctionListPartialSucceeded");this.Ulg(mb,!!Tb&&1!==Tb.FilterType,!0)};this.fmg=()=>{ub.ULS.sendTraceTag(537161986,0,50,"FunctionInfoManager.OnGetFunctionListPartialFailed -  reset varaible to ensure we will re-issue the webservice call");this.W3=null};this.Tlg=
mb=>{ub.ULS.sendTraceTag(537161985,0,50,"FunctionInfoManager.OnFullFunctionListLoaded - full list was loaded");this.bie(mb.bxa,!0,!1)};this.emg=mb=>{ub.ULS.sendTraceTag(537161984,0,50,"FunctionInfoManager.OnGetFunctionListFullSucceeded");this.Ulg(mb,!0,!1)};this.th=va}Cnc(va){this.addHandler("FunctionInfoLoaded",va)}Uje(va){this.removeHandler("FunctionInfoLoaded",va)}get Coa(){return this.ked}get ADf(){return this.W3}get $zc(){return this.Pka}get $(){return this.th}dispose(){const va=la.a.lh(db.Ed);
va&&va.Vje(this.Tlg);this.th=null;super.dispose()}bme(){this.ked=!1;this.W3=null;this.IXd=!0;this.rrj&&this.akb(null)}akb(va,mb){mb=void 0===mb?!1:mb;if(this.Coa)this.IAg();else{ub.ULS.sendTraceTag(537161991,0,50,`Retrieving the list of function names for culture '${this.$.ua.UICultureTag}' from the server.`);let yc=null;(yc=la.a.lh(db.Ed))||ub.ULS.sendTraceTag(537161990,0,50,"instantaneousSupportInformationManager == null");if((null===yc||void 0===yc?0:yc.bxa)&&0<yc.bxa.length)Gc.EwaSettings.Na(114)?
yc.mAi(this.emg):this.bie(yc.bxa,!0,!1);else{var Tb=this.$.oa.ta.Wh();va&&(this.$.fa.ki||mb)&&!this.IXd&&(mb?be.a(this.$.userOperationManager,(Nc,zd,fe)=>ze.p(this.$.oa.ta,va,h.c(Nc,this.gmg),h.b(zd,this.fmg),fe,va,Tb),Nc=>new ue.a(130,0,Nc,16),null):ze.p(this.$.oa.ta,va,this.gmg,this.fmg,null,va,Tb));!this.Coa&&this.$.fa.ki&&(yc?(ub.ULS.sendTraceTag(537161989,0,50,`FunctionInfoManager.EnsureFunctionInfoAsync - Functions not loaded yet, wait for them. IsFullyLoaded=${this.Coa}, IsSessionActive=${this.$.fa.ki}`),
yc.B5e(this.Tlg)):(ub.ULS.sendTraceTag(537161988,0,50,"FunctionInfoManager.EnsureFunctionInfoAsync - instantaneousSupportInformationManager is null"),ze.p(this.$.oa.ta,{FilterType:0},this.emg,null,null,null,Tb),this.IXd=!1))}}}pIf(va){return 0>va||va>=this.W3.length?null:this.W3[va]}qIf(va){return Ra.a.tj(this.eKd,va.toUpperCase())}$lb(va){return Ra.a.tj(this.ZZa,va)}h0f(va){return!va.GroupUI}Ulg(va,mb,Tb){const yc=Ad.a(va);ub.ULS.sendTraceTag(537161955,0,50,`FunctionInfoManager.OnFunctionListSucceeded: areNonStatusMessagesPresentInResult=${yc}`);
yc?(Ia.f(this.$).endEdit(!1,"FunctionInfoManager.OnFunctionListSucceeded"),this.$.fa.yx(va.Errors)):this.bie(va.Result,mb,Tb)}bie(va,mb,Tb){ub.ULS.sendTraceTag(537161954,0,50,`FunctionInfoManager.RefreshFunctionList: functionsInfo count = ${va.length}, isCategorized = ${mb}, partialResult = ${Tb} IsFullyLoaded = ${this.Coa}`);this.Coa||(this.W3=va,this.FPh(mb),this.ked=!Tb,this.IAg())}IAg(){this.raiseEvent("FunctionInfoLoaded")}FPh(va){var mb=Tc.a.instance.ia(1032),Tb=[];this.ZZa={};this.Pka=[];this.ZZa[mb]=
Tb;const yc=Tc.a.instance.ia(1033),Nc=[];this.Pka.push(mb);this.Pka.push(yc);for(let fe=0,Ud=this.W3.length;fe<Ud;fe++){mb=this.W3[fe];mb.IsCompatibility||Nc.push(mb);var zd=mb.NameUI;const P=mb.NameDataStrings;this.EDf[P.toUpperCase()]||(this.EDf[P.toUpperCase()]=mb);this.eKd[zd.toUpperCase()]||(this.eKd[zd.toUpperCase()]=mb);if(!this.h0f(mb)){if(va){zd=mb.GroupUI;let Da=Ra.a.tj(this.ZZa,zd);Da||(Da=[],this.ZZa[zd]=Da,this.Pka.push(zd));Da.push(mb)}mb.IsCommonlyUsed&&Tb.push(mb);mb.IsCompatibility||
this.Zmh.push(P)}}this.ZZa[yc]=Nc;va&&(qc.DEg(Tb,[2,3,0,5,4,9,1,7,8,6]),Tb=Array(14),Tb[0]=0,Tb[1]=1,Tb[2]=7,Tb[3]=11,Tb[4]=5,Tb[5]=2,Tb[6]=6,Tb[7]=10,Tb[8]=9,Tb[9]=3,Tb[10]=4,Tb[11]=13,Tb[12]=12,Tb[13]=8,qc.DEg(this.Pka,Tb),Tb=[],Tb.push(...this.Pka),Tb.splice(13,1),this.Pka=Tb);Tb=(fe,Ud)=>fe.NameUI.localeCompare(Ud.NameUI);this.W3=[...this.W3];this.W3.sort((fe,Ud)=>fe.NameDataStrings.localeCompare(Ud.NameDataStrings));for(let fe=1,Ud=this.Pka.length;fe<Ud&&va;fe++)this.ZZa[this.Pka[fe]].sort(Tb);
for(let fe=0,Ud=this.W3.length;fe<Ud;fe++)this.W3[fe].FunctionIndex=fe}static DEg(va,mb){const Tb=[...va];for(let yc=0;yc<Tb.length&&yc<mb.length;yc++)va[yc]=Tb[mb[yc]]}}Object(Aa.a)(qc,"FunctionInfoManager",Ef.a,[747,748,2]);class ma{constructor(va){this.pluginScheduler=va}request(va){const mb=this;return xo(function*(){var Tb=yield mb.pluginScheduler.requester().gotoCtrlClick(va,fd.PluginGroup.Excel,null);if("Done"!==Tb.kind&&"Superseded"===Tb.kind)return null;Tb=Tb.payload;if(Object(Cc.c)(Tb))return{kind:fd.GotoCtrlClickResultKind.Failure};
switch(Tb.kind){case fd.GotoCtrlClickResultKind.RangeResolutionFailure:case fd.GotoCtrlClickResultKind.NoReferenceFound:case fd.GotoCtrlClickResultKind.Failure:return Tb;case fd.GotoCtrlClickResultKind.ReferenceFound:return Tb;default:return ub.ULS.sendTraceTag(507339545,0,15,"GotoCtrlClickRequester.request: unexpected GotoCtrlClickResultKind"),null}})}}Object(Aa.a)(ma,"GotoCtrlClickRequester",null,[]);class Ab{constructor(va,mb,Tb,yc){this.$=va;this.onHoverEnter=mb;this.onHoverLeave=Tb;this.t$d=
yc;this.d5a=(Nc,zd)=>{switch(zd.state){case 0:(zd=this.getSelection(zd.event,Nc))?(this.hBd=zd,this.onHoverEnter(Nc,zd)):(this.PWb=void 0,this.Ywd());break;case 1:this.Ywd();this.onHoverLeave(Nc);break;case 2:break;default:return zd}};this.GPc=Nc=>{this.PWb!==Nc.ctrlKey&&(this.PWb=Nc.ctrlKey,this.t$d(this.PWb))};this.da=Object(Ia.f)(this.$);this.editBox=this.da.cellTextEditBox;this.formulaBar=Object(Wa.a)(this.$);this.Kp()}Ywd(){this.hBd=void 0}dispose(){this.xo()}Kp(){this.editBox.UIb(this.d5a);
this.formulaBar.UIb(this.d5a);document.addEventListener("keyup",this.GPc,{capture:!0});document.addEventListener("keydown",this.GPc,{capture:!0})}xo(){this.editBox.b6b(this.d5a);this.formulaBar.b6b(this.d5a);document.removeEventListener("keyup",this.GPc,{capture:!0});document.removeEventListener("keydown",this.GPc,{capture:!0})}getSelection(va,mb){va=new Sys.UI.Point(va.clientX,va.clientY);{mb=mb.Xa.dm;var Tb=void 0,{x:yc,y:Nc}=va;Tb=void 0===Tb?document:Tb;va=-1;let zd=null;void 0!==Tb.caretPositionFromPoint?
(Tb=Tb.caretPositionFromPoint(yc,Nc),null!==Tb&&(va=Tb.offset,zd=Tb.offsetNode)):void 0!==Tb.caretRangeFromPoint&&(Tb=Tb.caretRangeFromPoint(yc,Nc),null!==Tb&&(va=Tb.startOffset,zd=Tb.startContainer));null===zd||-1===va?(ub.ULS.sendTraceTag(507339543,0,15,"getEditorCaretPositionFromPoint - failed to get relevant range"),mb=-1):mb.contains(zd)?mb=A(mb,zd,va):(ub.ULS.sendTraceTag(507339542,0,15,"getEditorCaretPositionFromPoint - relavant node not inside root"),mb=-1)}if(!mb||-1===mb)return null;mb=
{index:mb,length:0};return this.Yse(mb)?mb:null}Yse(va){return!this.hBd||!this.Zni(this.hBd,va)}Zni(va,mb){return va.index===mb.index&&va.length===mb.length}}Object(Aa.a)(Ab,"GotoCtrlClickHandler",null,[2]);var ec;(function(va){va.client="client";va.server="server"})(ec||(ec={}));Object(Aa.b)("ResultOrigin",ec);const na=[50,80,100,130,150,170,200];class pb{constructor(va){this.$=va;this.LU=null;this.usage={};this.WWc={};this.performance={};this.$pa=-1;this.Xi=(mb,Tb)=>{Tb.$l||Tb.Aob||this.$.sendBeaconTraceTag(104412034,
50,!1,this.Iac())};this.editBox=Object(Ia.f)(this.$).Dh;va.Pp(this.Xi)}static getInstance(va){return pb.instance||(pb.instance=new pb(va))}tPf(va){Object(Cc.c)(this.LU)||(Object(Cc.c)(this.WWc[this.LU])&&(this.WWc[this.LU]={success:0,error:0}),this.WWc[this.LU][va?"success":"error"]++,this.hHj(va),this.LU=null)}setResult(va,mb){mb=this.hQd(mb);switch(va.kind){case fd.GotoCtrlClickResultKind.NoReferenceFound:mb.noRef++;break;case fd.GotoCtrlClickResultKind.ReferenceFound:mb.resolvedRef++;break;case fd.GotoCtrlClickResultKind.RangeResolutionFailure:mb.unresolvedRef++;
break;case fd.GotoCtrlClickResultKind.Failure:mb.failure++}}Y1i(va,mb){this.$pa=sb.x2c;this.LU=mb;this.hQd(va).click++}formatApplied(va){this.hQd(va).formatApplied++}hHj(va){if(-1!==this.$pa){var mb=z(this.LU);this.iTb(`${mb}_request`).N5(va,this.$pa);var Tb=this.iTb(`${mb}_overall`);window.requestAnimationFrame(()=>{Tb.N5(va,this.$pa)});this.$pa=-1}}hQd(va){va=va===this.editBox?"cellEditor":"formulaBar";Object(Cc.c)(this.usage[va])&&(this.usage[va]={noRef:0,resolvedRef:0,unresolvedRef:0,failure:0,
formatApplied:0,click:0});return this.usage[va]}iTb(va){return this.performance[va]=this.performance[va]||new sb(na)}Iac(){const va={};Object.keys(this.performance).forEach(mb=>{this.performance[mb].RHd();var Tb=this.performance[mb];va[mb]={metrics:Tb.u2,durations:Tb.Ejb}});return`{"usage":${JSON.stringify(this.usage)},"resultSourceCount":${JSON.stringify(this.WWc)},"performance":${JSON.stringify(va)}}`}}Object(Aa.a)(pb,"GotoCtrlClickTelemetry",null,[]);const R={underline:!0,bold:!0};class ua{constructor(va){this.$=
va;this.Bug=void 0}dispose(){this.hide()}show(va,mb){va=Object.assign({},mb,{sB:va});this.tQa(va)&&(this.bra(va)&&this.hide(),this.ix=va,this.LJh())}hide(){this.ix&&(this.tmk(),this.ix=void 0)}tQa(va){var mb;if(!(mb=!this.ix)){mb=this.ix;if(mb===va)va=!0;else if(mb&&va&&mb.sB===va.sB&&mb.kind!==va.kind)if(mb.kind===fd.GotoCtrlClickResultKind.ReferenceFound&&va.kind===fd.GotoCtrlClickResultKind.ReferenceFound){var Tb=mb.sheetRange,yc=va.sheetRange;va=!!Tb&&!!yc&&Tb.sheetName===yc.sheetName&&Tb.firstColumn===
yc.firstColumn&&Tb.firstRow===yc.firstRow&&Tb.lastRow===yc.lastRow&&Tb.lastColumn===yc.lastColumn&&Tb.namedObjectName===yc.namedObjectName&&mb.span.start===va.span.start&&mb.span.end===mb.span.end}else va=!0;else va=!1;mb=!va}return mb}bra(va){var mb;if(mb=this.ix)mb=this.ix,mb=!(mb.sB===va.sB&&mb.span.start===va.span.start&&mb.span.end===va.span.end);return mb}LJh(){const va=this.ix.sB,mb=this.ix.span;this.Bug=va.Xa.getFormattedText();va.Xa.formatText(mb.start,mb.end-mb.start,R);va.Xa.style.cursor=
"pointer";pb.getInstance(this.$).formatApplied(va)}tmk(){const va=this.ix.sB,mb=this.ix.span,Tb=va.text;Tb.length<mb.end?ub.ULS.shipAssertTag(507339544,0,!1,`GotoCtrlClickControl.removeGotoFormat - unexpected editor state: ${Tb.length}:${mb.start}:${mb.end}`):(va.isEditing?this.aGk(va):va.Xa.setFormattedText(this.Bug),va.Xa.style.cursor="text")}aGk(va){va=va.Xa;va.eN=!0;const mb=va.selection,Tb=mb.index,yc=va.text.length;va.selectRange(Math.min(Tb,yc),Math.min(Tb+mb.length,yc));this.ix.sB.n_(null);
va.eN=!1}showCallout(va){const mb=new pc.a(-847286761,Nb.a.ph,va.ji,0,null);va.Ia.qh(mb,{["CalloutName"]:24})}}Object(Aa.a)(ua,"GotoCtrlClickControl",null,[2]);var xb=a(160);const W=(va,mb,Tb,yc)=>(Nc,zd,fe)=>{const Ud=Ia.f(va),P=va.oa.ta.Wh();Nc=h.c(Nc,xa(Tb,yc));zd=h.b(zd,kb(yc));return va.sa.la?ze.y(va.oa.ta,mb,va.sa.la.name,Nc,zd,fe,Ud,P):ze.x(va.oa.ta,mb,-1,Nc,zd,fe,Ud,P)},xa=(va,mb)=>Tb=>{Ad.a(Tb)?mb(Tb):(Tb=Tb.Result,Tb=Fc.m(Tb.Ranges[0],Tb.SheetName),va(Tb))},kb=va=>mb=>{va(mb)};let Pb=class{constructor(va,
mb,Tb){this.$=va;this.pluginScheduler=mb;this.da=Tb;this.onHoverEnter=(yc,Nc)=>{const zd=this;return xo(function*(){zd.iBd=yc;zd.wuc=xb.a.instance.Wk(yc.Xa.domElement);zd.wuc.Ga("mouseup",zd.XS);zd.wuc.Ga("mousedown",zd.cQ,!0);void zd.fck({text:yc.text,index:Nc.index,length:Nc.length},zd.requester.request.bind(zd.requester),yc)})};this.onHoverLeave=()=>{this.reset()};this.t$d=yc=>{var Nc;(this.PWb=yc)&&(null===(Nc=this.Nib)||void 0===Nc?void 0:Nc.kind)===fd.GotoCtrlClickResultKind.ReferenceFound?
this.show(this.Qr.sB,this.Nib):this.hide()};this.l5i=yc=>{const Nc=this;return xo(function*(){Nc.Nib=yc;const zd=Nc.Qr.sB;switch(yc.kind){case fd.GotoCtrlClickResultKind.RangeResolutionFailure:case fd.GotoCtrlClickResultKind.Failure:Nc.hide();ub.ULS.sendTraceTag(507339546,0,15,`GotoCtrlClick.handleResult: Request Failed with error: ${fd.GotoCtrlClickResultKind[yc.kind]}`);break;case fd.GotoCtrlClickResultKind.NoReferenceFound:Nc.hide();break;case fd.GotoCtrlClickResultKind.ReferenceFound:Gc.EwaSettings.isChangeGateEnabled("OfficeVSO:8846243_GotoCtrlClickTeachingCallout")&&
Nc.control.showCallout(Nc.$);Nc.PWb&&Nc.show(zd,yc);break;default:return yc}pb.getInstance(Nc.$).setResult(yc,zd)})};this.XS=yc=>{var Nc;yc.ctrlKey&&(null===(Nc=this.Nib)||void 0===Nc?void 0:Nc.kind)===fd.GotoCtrlClickResultKind.ReferenceFound&&(Nc=(yc=Fc.ib(this.Nib.sheetRange))?"client":"server",pb.getInstance(this.$).Y1i(this.iBd,Nc),yc?this.aJg(yc):(Nc=this.Nib.span,yc=this.$,Nc=new ue.a(562,0,W(yc,this.iBd.text.substring(Nc.start,Nc.end),this.aJg,this.n0j),18,null),yc=yc.userOperationManager.enqueueOperation(Nc,
null),ub.ULS.shipAssertTag(507331929,0,!!yc,"RangeAndSheetNameExtractor.InvokeWebMethodRequest: queueItem is null after scheduling the web method call.")))};this.cQ=yc=>{yc.ctrlKey&&(yc.preventDefault(),yc.stopPropagation())};this.aJg=yc=>{this.reset();this.da.fp(yc,null,null,null,60,"GotoCtrlClick");pb.getInstance(this.$).tPf(!0)};this.n0j=()=>{ub.ULS.sendTraceTag(507331928,0,15,"GotoCtrlClick.onServerOperationFailure: Request Failed");pb.getInstance(this.$).tPf(!1)};this.reset=()=>{var yc;this.hide();
this.iBd=this.Nib=this.Qr=void 0;null===(yc=this.wuc)||void 0===yc?void 0:yc.LM();this.wuc=void 0;this.handler.Ywd()};this.control=new ua(this.$);this.requester=new ma(this.pluginScheduler);this.handler=new Ab(this.$,this.onHoverEnter,this.onHoverLeave,this.t$d);this.Kp()}dispose(){this.xo();this.handler.dispose();this.control.dispose()}Kp(){this.da.Dh.Ox(this.reset);this.da.ha.wGa(this.reset);this.$.fa.mK(this.reset)}xo(){this.da.Dh.Ow(this.reset);this.da.ha.fBa(this.reset);this.$.fa.nL(this.reset)}fck(va,
mb,Tb){const yc=this;return xo(function*(){const Nc=Object.assign({},va,{sB:Tb});yc.Qr=Nc;const zd=yield mb(va);!Object(Cc.c)(zd)&&yc.e_d(Nc)&&(yield yc.l5i(zd))})}show(va,mb){this.control.show(va,mb)}hide(){this.control.hide()}e_d(va){return this.Qr?this.Qr.text===va.text&&this.Qr.index===va.index&&this.Qr.length===va.length&&this.Qr.sB===va.sB:!1}};Pb=Object(ea.__decorate)([Object(la.d)(db.ad),Object(ea.__param)(0,Object(db.Ob)()),Object(ea.__param)(1,Object(Hf.f)()),Object(ea.__param)(2,Object(db.kd)())],
Pb);Object(Aa.a)(Pb,"GotoCtrlClick",null,[2]);Object(la.b)(db.vd,{rk:"singleton"})(()=>xo(function*(){return T}));const T=(va,mb)=>xo(function*(){if(F(va)&&F(mb)){var Tb=D(va),yc=D(mb),Nc=yield Q(Tb),zd=yield Q(yc);var fe=G(Tb.value,yc.value);"different"===fe.kind&&(Tb=G(Tb.unformattedValue,yc.unformattedValue),fe={kind:"different",diff:fe.diff,unformatted:Tb});Nc={cse:Nc,immediate:zd,diagnostic:fe,cellValueFix:Gc.EwaSettings.rHc()};ub.ULS.sendTraceTag(507646813,1,20,`ImmediateCellComparison.compareCells, result: ${JSON.stringify(Nc)}`)}});
let Za=class{constructor(va,mb){this.$=va;this.clearContentNotifier=mb;this.keptData={suggestionsKept:0,suggestionsCommitted:0,suggestionsChanged:0,suggestionsReverted:0,suggestionsDeleted:0};this.im=(Tb,yc)=>{this.K9g()&&yc.committed&&yc.Gq.equals(this.zza.suggestion.Gq)&&this.zza.suggestion.cellText!==yc.cellText&&this.keptData.suggestionsChanged++};this.Esb=()=>{var Tb;if(this.K9g()){var yc=this.da.ha.pa.selectedRanges,Nc=null===(Tb=this.zza)||void 0===Tb?void 0:Tb.suggestion.Gq;yc.some(zd=>zd.contains(Nc))&&
this.keptData.suggestionsDeleted++}};this.uAa=(Tb,yc)=>{0===yc.zx&&(170===yc.Xl.operation.operationName&&this.keptData.suggestionsReverted++,this.$.userOperationManager.vu(this.uAa))};this.da=Ia.f(this.$)}zNd(){this.keptData.suggestionsKept=this.MPi();return this.keptData}nsg(va){this.keptData.suggestionsCommitted++;this.zza={suggestion:va,stateId:this.$.fa.yk};this.Kp()}Kp(){this.da.cellTextEditBox.Ox(this.im);this.clearContentNotifier.Dpd(this.Esb);this.$.userOperationManager.qw(this.uAa)}xo(){this.da.cellTextEditBox.Ow(this.im);
this.clearContentNotifier.wVc(this.Esb)}K9g(){this.xo();if(null!==this.zza&&1===this.$.fa.yk-this.zza.stateId)return!0;this.zza=null;return!1}MPi(){return this.keptData.suggestionsCommitted-(this.keptData.suggestionsChanged+this.keptData.suggestionsDeleted+this.keptData.suggestionsReverted)}};Za=Object(ea.__decorate)([Object(la.d)(db.Jd,{rk:"transient"}),Object(ea.__param)(0,Object(db.Ob)()),Object(ea.__param)(1,Object(db.Z)())],Za);Object(Aa.a)(Za,"KeptTelemetryHandler",null,[]);const Db="PrefetchNotStarted;PrefetchResultCleared;Ctor;EvalInProgress;ResultUnavailable;RangeNotFoundInPrefetchResult;FinalizeNumberFormattedValueFailed;EvalOnCloneFailed;EvalFormulaRangeOnClonedModelFailed;SetCellPrefetchPluginFailed;SetCellPrefetchPluginRequestFailed;Invalid input to Plugin;SetCellPrefetchPlugin: getValueFromCellValue failed;SetCellPrefetchPlugin GetActiveCellFormat result or value is null;SetCellPrefetchPlugin EvalOnCloneResult failed;offScreenCanvasRender: renderValue failed;offScreenCanvasRender: renderHashesValue failed;Invalid OperKind;UndefinedCell".split(";");
var kc;let Wc=kc=class{constructor(va,mb,Tb,yc){this.vy=Tb;this.Hxj=yc;this.a2a=Gc.EwaSettings.isChangeGateEnabled("OfficeVSO:8606468_FinalizeToPrefetchCG");this.P6=Gc.EwaSettings.rHc();this.aTc=Gc.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.SetCellPrefetchPluginEnabled",!1);this.K7=()=>{this.aTc?this.VY=Object(ff.a)({message:"PrefetchNotStarted"}):this.a2a?this.m7=Object(ff.a)({message:"PrefetchNotStarted"}):this.DMa=Object(ff.a)({message:"PrefetchNotStarted"})};this.Wkg=(Nc,zd)=>{Nc=
this.da.ha.pa.activeCell;const fe=this.da.yh(Nc);null!=fe&&this.C$j(Nc,zd.text,fe.cell.to,fe.cell.aG.Zpc,this.da.$.activeItemName)};this.Mj=va;this.da=mb;this.m7=Object(ff.a)({message:"Ctor"});this.DMa=Object(ff.a)({message:"Ctor"});this.VY=Object(ff.a)({message:"Ctor"});va=Gc.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.SetCellEstimationPrefetchMsDebounce",100);this.C$j=Td.a((Nc,zd,fe,Ud,P)=>this.prefetch({text:zd,range:Nc,ifmt:fe,stateId:Ud,sheetName:P}),va);this.da.Dh.Mv(this.K7);this.da.Fp.Lpd(this.Wkg)}dispose(){this.da.Fp.BVc(this.Wkg);
this.da.Dh.Cv(this.K7);this.Qgf()}QFf(va){if(Object(ff.b)(this.DMa))return Object(ff.a)(this.DMa.reason.message);if(kc.msd(va,this.DMa.value.key)){for(const mb of this.DMa.value.results.results)if(Object(ff.c)(mb)&&kc.vrj(va,mb))return mb;return Object(ff.a)("RangeNotFoundInPrefetchResult")}return Object(ff.a)("ResultUnavailable")}PFf(va,mb){return this.aTc?Object(ff.b)(this.VY)?Object(ff.a)(this.VY.reason.message):kc.msd(va,this.VY.value.key)?Object(ff.c)(this.VY)?mb?Object(ff.d)({key:this.VY.value.key,
GQb:void 0,evaluatedResult:this.VY.value.evaluatedResult}):this.VY:Object(ff.a)("RangeNotFoundInPrefetchResult"):Object(ff.a)("ResultUnavailable"):Object(ff.b)(this.m7)?Object(ff.a)(this.m7.reason.message):kc.msd(va,this.m7.value.key)?Object(ff.c)(this.m7)?mb?Object(ff.d)({key:this.m7.value.key,GQb:void 0,evaluatedResult:this.m7.value.evaluatedResult}):this.m7:Object(ff.a)("RangeNotFoundInPrefetchResult"):Object(ff.a)("ResultUnavailable")}Qgf(){this.aTc?this.VY=Object(ff.a)({message:"PrefetchResultCleared"}):
this.a2a?this.m7=Object(ff.a)({message:"PrefetchResultCleared"}):this.DMa=Object(ff.a)({message:"PrefetchResultCleared"})}prefetch(va){if(this.aTc&&this.da.$.isEditMode){this.VY=Object(ff.a)({message:"EvalInProgress",key:va});const mb=this.da.yh(va.range);(null===mb||void 0===mb?0:mb.cell)?void this.Hxj(1).then(Tb=>{const yc={text:va.text,textMaxWidth:mb.cell.textMaxWidth,ifmt:va.ifmt,font:mb.cell.n5};(Tb=Tb.requester().setCellPrefetch(yc,fd.PluginGroup.Excel,void 0))&&Tb.then(Nc=>{"Done"===Nc.kind&&
Nc.payload?this.i6i(va,Nc.payload):this.VY=Object(ff.a)({message:"SetCellPrefetchPluginFailed",key:va})}).catch(Nc=>{this.VY=Object(ff.a)({message:"SetCellPrefetchPluginRequestFailed",key:va});ub.ULS.sendTraceTag(507610177,0,50,`SetCellEstimationPrefetcher.prefetch: setCellPrefetch request rejected with error ${Nc}`)})}):this.VY=Object(ff.a)({message:"UndefinedCell",key:va})}else this.a2a?this.m7=Object(ff.a)({message:"EvalInProgress",key:va}):this.DMa=Object(ff.a)({message:"EvalInProgress",key:va}),
this.Mj.U5([],va.range,va.range,va.text,!0).then(mb=>{if(this.a2a){var Tb=this.da.yh(va.range);mb=mb.results[0];if("Success"===mb.kind&&Tb){const yc=this.vy.$Rb(mb.value);let Nc=void 0;this.P6&&(Nc=this.vy.ZRb(mb.value,this.Mj.config.mathpack));Tb=this.Mj.waa(mb.value.formatted,yc,Tb.cell.textMaxWidth,Tb.cell.n5,va.ifmt,!1,Nc);this.m7="Success"===Tb.kind?Object(ff.d)({key:va,GQb:Tb.value,evaluatedResult:mb.value}):Object(ff.a)({message:"FinalizeNumberFormattedValueFailed"})}else this.m7=Object(ff.a)({message:"EvalOnCloneFailed"})}else this.DMa=
Object(ff.d)({key:va,results:mb})}).catch(mb=>{this.m7=Object(ff.a)({message:"EvalFormulaRangeOnClonedModelFailed"});ub.ULS.sendTraceTag(509219811,0,50,`SetCellEstimationPrefetcher.prefetch: evalFormulaRangeOnClonedModel promise rejected with error ${mb}`)})}i6i(va,mb){if(mb.failureMessage&&void 0!==mb.failureMessage)this.tqj(mb.failureMessage)&&(this.VY=Object(ff.a)({message:mb.failureMessage}));else{const Tb={cell:{row:mb.evaluatedResult.cell.firstRow,col:mb.evaluatedResult.cell.firstColumn},value:mb.evaluatedResult.value.value,
formatted:mb.evaluatedResult.formatted};mb=this.fxi(va,Tb,mb.numberFormattedText);this.VY=Object(ff.d)({key:va,GQb:mb,evaluatedResult:Tb})}}fxi(va,mb,Tb){const yc=this.vy.$Rb(mb);var Nc={units:mb.formatted.units,color:mb.formatted.color,alignment:mb.formatted.alignment};const zd=this.vy.SIf(Nc),fe=this.vy.cIf(Nc),Ud=this.vy.BJd(mb.formatted,Nc);Nc=excelOnlineCalc.numfmt.isHashesValue(Nc);let P=void 0;this.P6&&(P=this.vy.ZRb(mb,this.Mj.config.mathpack));return{text:Tb,valueType:yc,fontColor:fe,format:va.ifmt,
horizontalAlignment:zd,numFmt:Ud,isHashesValue:Nc,cellValue:P}}tqj(va){const mb=0<=Db.findIndex(Tb=>Tb===va);if(!mb)throw Error(`SetCellEstimationPrefetcher.handleSetCellResponse: failureMessage ${va} is not a valid failure message.`);return mb}static msd(va,mb){return va.text===mb.text&&va.range.toString()===mb.range.toString()&&va.ifmt===mb.ifmt&&va.stateId===mb.stateId&&va.sheetName===mb.sheetName}static vrj(va,mb){return va.range.top-1===mb.value.cell.row&&va.range.left-1===mb.value.cell.col}};
Wc=kc=Object(ea.__decorate)([Object(la.d)(db.Of),Object(ea.__param)(0,Object(db.G)()),Object(ea.__param)(1,Object(db.kd)()),Object(ea.__param)(2,Object(db.F)()),Object(ea.__param)(3,Object(Hf.f)({WY:!0}))],Wc);Object(Aa.a)(Wc,"SetCellEstimationPrefetcher",null,[698,2]);var yd=a(432),Od=a(1044);class me extends yd.a{constructor(va){super();this.$=va;this.sn()}create(){(va=>la.a.resolve(db.G).then(mb=>setTimeout(()=>va(mb),0)))(va=>{va=this.$.qa.zh(294)||this.$.qa.Rh(294,new Od.RelativeAndAbsoluteReferencesManager(va));
this.dl(va)})}static Ga(va){va.qa.Rh(295,new me(va))}}Object(Aa.a)(me,"RelativeAndAbsoluteReferencesManagerFactory",yd.a,[]);var De=a(9),Le=a(323);class Pe extends yd.a{constructor(va){super();this.Izk="formulaAssistance";this.$=va;this.sn()}create(){let va=this.$.qa.zh(448);va?this.dl(va):void Object(Le.b)(this.Izk,{va:this.gi}).then(()=>{va=this.$.qa.zh(448);va||(va=this.$.qa.Rh(448,formulaAssistance.FormulaAssistanceUIFactoryGlobal.create({isFeedbackAllowed:this.$.isFeedbackEnabled})),this.$.Fwd(()=>
{const mb={};mb.isFeedbackAllowed=this.$.isFeedbackEnabled;va.updateContext(mb)}));this.dl(va)})}static Ga(va){va.qa.Rh(449,new Pe(va))}}Object(Aa.a)(Pe,"FormulaAssistanceUIControlFactory",yd.a,[]);var ef=a(1125),yf=a(226),Kf=a(257),ig=a(62);class kg{constructor(va){this.scheduler=va;this.BBb=void 0}vVf(){const va=this;return xo(function*(){va.BBb||(va.BBb=yield la.a.resolve(db.r));return va.BBb})}registerOnAnnotation(va,mb,Tb,yc){const Nc=this;return xo(function*(){var zd;const fe=(P,Da)=>{(0,Nc.scheduler.alAnnotationNotifier()[va])(Da.annotation).catch(eb=>
{ub.ULS.sendTraceTag(508048724,0,10,`IALInterop.onAnnotationReceived: Failed to send annotation to x10 handlers. ${eb}`)})},Ud=null!==(zd=Nc.BBb)&&void 0!==zd?zd:yield Nc.vVf();return null===Ud||void 0===Ud?void 0:Ud.register(Ud.k6().I8(Tb).H8(()=>{}).activateAnnotation({annotationType:mb,EA:yc,NV:fe}).build())})}sendSignal(va){const mb=this;return xo(function*(){var Tb;const yc=null!==(Tb=mb.BBb)&&void 0!==Tb?Tb:yield mb.vVf();return null===yc||void 0===yc?void 0:yc.Qyb(va)})}}Object(Aa.a)(kg,"ALProvider",
null,[]);class vg{constructor(va){this.ifl=va;this.value=void 0}LK(){void 0===this.value&&(this.value=this.ifl());return this.value}reset(){this.value=void 0}}Object(Aa.a)(vg,"ResettableLazy",null,[]);class yg{constructor(){this.uZd=new Map;this.Ixj=new vg(()=>xo(function*(){return(yield la.a.resolve(db.xg,{va:0})).Taa()}));this.uZd.set(fd.PluginFactoryName.FormulaByExamplePlugin,new vg(()=>xo(function*(){const va=yield la.a.resolve(db.Ob);return Hd.a.h2a(va)})));this.uZd.set(fd.PluginFactoryName.TestPlugin,
new vg(()=>xo(function*(){return!0})))}getRecognizedRangeTablesInfo(va,mb,Tb,yc,Nc){const zd=this;return xo(function*(){var fe,Ud;if(null===(Ud=yield null===(fe=zd.uZd.get(yc))||void 0===fe?void 0:fe.LK())||void 0===Ud||!Ud)return ub.ULS.sendTraceTag(507794771,306,50,`x10TableIntelligenceService.getRecognizedRangeTablesInfo: plugin ${yc} is not licensed for user`),[];fe=mb?new of.a(Object(Fc.C)(mb),va):null;a:{switch(Tb){case fd.RecognizedTablesMetadataState.Valid:Ud=2;break a;case fd.RecognizedTablesMetadataState.Invalid:Ud=
4;break a;case fd.RecognizedTablesMetadataState.All:Ud=6;break a}Ud=void 0}return(yield zd.Ixj.LK()).BKa(fe,Ud,Nc).map(O)})}}Object(Aa.a)(yg,"X10TableIntelligenceProvider",null,[]);class ag extends yd.a{constructor(va){super();this.$=va;this.euc=null;this.llk=new vg(()=>{const mb=this;return xo(function*(){const Tb=yield mb.cfj.LK();mb.$.qa.Rh(413,Tb);return Tb})});this.cfj=new vg(()=>{const mb=this;return xo(function*(){yield la.a.resolve(db.Vb,{va:mb.gi});const Tb=excelOnlineCalc.PluginSchedulerSingletonGlobal.instance();
if(Pa.a.uV)return Tb;var yc=yield la.a.resolve(db.Ib,{va:mb.gi});excelOnlineCalc.x10.resolveScriptLoaderPromise(yc.OE());Tb.registerALProvider(new kg(Tb));Tb.registerTableIntelligenceProvider(new yg);excelOnlineCalc.x10.setX10Features(mb.TOf());yc=(yield Promise.all([excelOnlineCalc.x10.ensureGroupAttached(fd.PluginAttachGroup.Core),Hd.a.Lob(mb.$)?excelOnlineCalc.x10.ensureGroupAttached(fd.PluginAttachGroup.SmartSuggestionsAutoComplete):0])).reduce((Nc,zd)=>Nc+zd,0);(yield la.a.resolve(Hf.d,{va:mb.gi})).qW.anyPluginInitialized=
0<yc;return Tb})});this.sn()}create(){ub.ULS.sendTraceTag(537154643,0,50,"PluginSchedulerFactory.Create: Loading scheduler slice");Gc.EwaSettings.isChangeGateEnabled("OfficeVSO:8763136_UseNewXPlatEwaX10Init")?this.llk.LK().then(va=>{this.dl(va)},va=>{ub.ULS.sendTraceTag(507381790,0,10,"PluginSchedulerFactory.Create: Error loading scheduler slice: "+va)}):ef.a.then(this.S9h(),va=>{this.dl(va)})}S9h(){if(this.euc)return this.euc;const va=Kf.a.Eib(ig.b(),yf.a.none,"LoadResource","x10Scheduler loading");
if(Gc.EwaSettings.isChangeGateEnabled("OfficeVSO:5789323_disableSchedulerForIE")&&Pa.a.uV){const mb=excelOnlineCalc.PluginSchedulerSingletonGlobal.instance();this.$.qa.Rh(413,mb);va.setResult(mb);return this.euc=va.task}(mb=>la.a.resolve(db.G,{va:this.gi}).then(Tb=>setTimeout(()=>mb(Tb),0)))(()=>{this.bzj(mb=>{const Tb=excelOnlineCalc.PluginSchedulerSingletonGlobal.instance();mb=mb.OE();mb=$f.c(Yc.Task.Ua(mb));Tb.registerALProvider(new kg(Tb));Gc.EwaSettings.isChangeGateEnabled("OfficeVSO:8479330_enableTableIntelligenceInX10")&&
Tb.registerTableIntelligenceProvider(new yg);const yc=this.TOf();Gc.EwaSettings.isChangeGateEnabled("OfficeVSO:7913510_sendSchedulerFeaturesNOtification")&&Tb.notifier().setSchedulerFeatures(yc.map(Nc=>fd.SchedulerFeature[Nc]));Promise.all([excelOnlineCalc.x10.ensureGroupAttachedLegacy(mb,fd.PluginAttachGroup.Core,yc),Hd.a.Lob(this.$)?excelOnlineCalc.x10.ensureGroupAttachedLegacy(mb,fd.PluginAttachGroup.SmartSuggestionsAutoComplete,yc):0]).then(Nc=>Nc.some(zd=>0<zd)).then(Nc=>{this.$.qa.Rh(413,Tb);
va.setResult(Tb);this.$.qa.zi(491,zd=>{zd.qW.anyPluginInitialized=Nc})})})});return this.euc=va.task}bzj(va){void la.a.resolve(db.Ib,{va:this.gi}).then(mb=>va(mb))}TOf(){const va=[];gg.forEach((mb,Tb)=>{mb(this.$)&&va.push(Tb)});return va}static Ga(va){va.qa.Rh(414,new ag(va))}}Object(Aa.a)(ag,"PluginSchedulerFactory",yd.a,[]);const gg=new Map([["ArgumentAssistance",()=>!0],["SimpleAutoComplete",()=>!0],["SmartSuggestionsAutoComplete",va=>Hd.a.Lob(va)],["ValuePreview",()=>Hd.a.Boa()],["ColoredReferences",
()=>!0],["ParenthesisCoupling",()=>!0],["SyntaxErrors",()=>Hd.a.oXb()],["EnumAutoComplete",()=>!0],["GotoCtrlClick",()=>Hd.a.m0f()]]);var ch=a(215);const Eg={selectByArrowKeyCounter:0,selectByMouseHoverCounter:0,commitByTabKeyCounter:0,commitByEnterKeyCounter:0,commitByMouseClickCounter:0,commitWhileRequestPending:0,dismissSmartSuggestionExplicitlyCounter:0,dismissSmartSuggestionImplicitlyCounter:0},ph={formulaAssistanceRequestAttemptedCounter:0,formulaAssistanceRequestOptimizedCounter:0},Rg={argumentAssistanceCardInitialMode:void 0,
argumentAssistanceCollapseCounter:0,argumentAssistanceExpandCounter:0,argumentAssistanceLearnMoreCounter:0,argumentAssistanceDragCounter:0,argumentAssistanceDragTotalCounter:0,argumentAssistanceMoveCounter:0,argumentAssistanceMoveTotalCounter:0,argumentAssistanceCardIsInitialModeDefault:!1},Dg={smartSuggestionShownCounter:0,smartSuggestionSelectedCounter:0,smartSuggestionCommittedCounter:0,smartSuggestionKeptCounter:0,smartSuggestionChangedCounter:0,smartSuggestionDeletedCounter:0,smartSuggestionRevertedCounter:0,
isCellContentOnlyEqualDuringEditCounter:0,isCellContentFormulaCounter:0,smartSuggestionWouldSuggestInsidePivotCounter:0},fb={parenthesesCouplingCounter:0,formulaHighlightsCounter:0},Va={dialogCommittedCounter:0,dialogShownCounter:0,argsDialogOpenedByRibbonCounter:0,argsDialogOpenedByDialogCounter:0,argsDialogCommittedCounter:0},bd={argumentAssistanceFlight:void 0,autoCompleteUIFlight:void 0,smartFormulaBarAutoCompletePluginFlight:void 0,anyPluginInitialized:void 0,formulaAssistanceRedesignFlight:void 0,
smartFormulaSuggestionsFeatureEnabled:void 0,parenthesesCouplingFlight:void 0,coloredReferencesFlight:void 0,uILocale:void 0,dataLocale:void 0,country:void 0,formulaAssistanceUiPositionFlight:void 0,argumentAssistanceUxFlight:void 0};var je;(function(va){va.RenderDown="rd";va.RenderUp="ru";va.Expand="e";va.Collapse="c";va.Drag="d";va.Move="m";va.GiveFeedback="gf";va.InitialModeExpanded="ie";va.InitialModeCollapsed="ic";va.LearnMore="lm";va.ESC="esc";va.SecondESC="2ndEsc"})(je||(je={}));Object(Aa.b)("argumentAssistanceUsageActions",
je);var se=a(61),Xe=a(47),wf=a(107);const Nf={["argumentAssistanceOverall"]:[50,80,100,130,150,170,200],["autoCompleteOverall"]:[50,80,100,130,150,170,200,250,300,350,400],["autoCompleteOverallSimpleAndSmart"]:[50,80,100,130,150,170,200],["autoCompleteOverallSmartOnly"]:[50,80,100,130,150,170,200],["autoCompleteOverallSimpleOnly"]:[50,80,100,130,150,170,200],["tryUpdateHighlightsFromCellContentEditor"]:[50,80,100,130,150,170,200],["autoCompleteComputation"]:[50,80,100,130,150,170,200,250,300,350,
400],["autoCompleteComputationNoResult"]:[50,80,100,130,150,170,200,250,300,350,400]};class fg{constructor(va,mb){this.$=va;this.iYg=mb;this.qMa=Hd.a.IIc();this.OP=null;this.bMc=-1;this.H2d=null;this.I2d=this.cMc=0;this.Sla=Object.assign({},Rg);this.ZU=Object.assign({},Dg);this.Rua=Object.assign({},Eg);this.rtd=Object.assign({},ph);this.MJd=Object.assign({},fb);this.qW=Object.assign({},bd);this.oKb={};this.olb=Object.assign({},Va);this.WJb=[];this.ipc=Gc.EwaSettings.isChangeGateEnabled("OfficeVSO:7376612_argumentAssistanceOrderedActionsTelemetry");
this.nYa={};this.im=(Tb,yc)=>{null!=this.OP&&(1==Math.abs(this.bMc-this.$.fa.yk)&&(Tb=this.$.sa.la.sheetId,yc.committed&&yc.Gq.equals(this.OP.Gq)&&this.H2d===Tb&&this.OP.cellText!==yc.cellText&&this.cMc++),1<=Math.abs(this.bMc-this.$.fa.yk)&&(this.OP=null,this.bMc=-1,this.H2d=null));0<Object.keys(this.nYa).length&&(ub.ULS.sendTraceTag(509658956,0,50,`FormulaAssistanceTelemetryManager.onEditEnded: current edit's completion items data: ${JSON.stringify(this.nYa)}`),this.nYa={})};this.Xi=(Tb,yc)=>{yc.$l||
yc.Aob||(this.SRg(),this.TIk(),this.$.sendBeaconTraceTag(88392384,50,!1,"{0}",this.getJsonForLogging()))};this.Xtb=new wf.a;va.Pp(this.Xi);this.qMa||Ia.f(this.$).Fp.Ox(this.im);this.SRg();this.aDj()}dispose(){!this.qMa&&this.$&&Ia.f(this.$).Fp.Ow(this.im)}EQa(va){va.forEach(mb=>{this.Xtb.mh(mb)||this.Xtb.ga(mb,new sb(Nf[mb]));this.Xtb.ma(mb).C9a()})}O5(va,mb){mb=void 0===mb?!0:mb;va.forEach(Tb=>{this.Xtb.mh(Tb)&&this.Xtb.ma(Tb).N5(mb)})}VDk(va){this.Cla(va?"ie":"ic")}UDk(){this.Sla.argumentAssistanceCardIsInitialModeDefault=
!0}HPb(va){window.requestAnimationFrame(()=>{this.O5([va])})}ssk(va){va.forEach(mb=>{mb=fd.CompletionItemKind[mb.kind];this.c$g(mb);this.oKb[mb].shownCounter++;this.nYa[mb].shownCounter++})}rsk(va){va=fd.CompletionItemKind[va];this.c$g(va);this.oKb[va].committedCounter++;this.nYa[va].committedCounter++}Cla(va){if(this.ipc){const mb=this.WJb.length;0===mb||this.WJb[mb-1][0]!==va?this.WJb.push([va,1]):this.WJb[mb-1][1]++}else switch(va){case "e":this.Sla.argumentAssistanceExpandCounter++;break;case "c":this.Sla.argumentAssistanceCollapseCounter++;
break;case "d":this.Sla.argumentAssistanceDragCounter++;break;case "m":this.Sla.argumentAssistanceMoveCounter++;break;case "lm":this.Sla.argumentAssistanceLearnMoreCounter++;break;case "ie":this.Sla.argumentAssistanceCardInitialMode="Expanded";break;case "ic":this.Sla.argumentAssistanceCardInitialMode="Collapsed"}}UGk(va){this.iYg.nsg(va)}aDj(){ub.ULS.sendTraceTag(509140996,0,50,`FormulaAssistanceTelemetryManager.SessionDetails: ${se.a.Di(this.qW)}`)}getJsonForLogging(){return"{"+this.TX("SessionDetails",
this.qW)+","+this.TX("ArgumentAssistanceUsage",this.Sla)+","+this.TX("argumentAssistanceOrderedActions",this.WJb)+","+this.TX("FormulaSuggestionsUsage",this.ZU)+","+this.TX("FunctionDialogUsage",this.olb)+","+this.TX("AutocompleteCardInteraction",this.Rua)+","+this.TX("AutocompleteRenderOptimization",this.rtd)+","+this.TX("AutocompleteUsageByKind",this.oKb)+","+this.TX("FormulaHighlightsUsage",this.MJd)+","+this.xXi()+"}"}TIk(){if(this.qMa){var va=this.iYg.zNd();this.ZU.smartSuggestionKeptCounter=
va.suggestionsKept;this.ZU.smartSuggestionChangedCounter=va.suggestionsChanged;this.ZU.smartSuggestionDeletedCounter=va.suggestionsDeleted;this.ZU.smartSuggestionRevertedCounter=va.suggestionsReverted}else this.ZU.smartSuggestionChangedCounter=this.cMc,this.ZU.smartSuggestionDeletedCounter=this.I2d,this.ZU.smartSuggestionKeptCounter=this.ZU.smartSuggestionCommittedCounter-this.cMc-this.I2d;for(va=0;va<this.ZU.smartSuggestionKeptCounter;va++)Object(od.c)(xd)}SRg(){this.qW.argumentAssistanceFlight=
"T";this.qW.autoCompleteUIFlight=this.THf("Microsoft.Office.Excel.","AutoCompleteNewUI");this.qW.smartFormulaBarAutoCompletePluginFlight="T";this.qW.formulaAssistanceRedesignFlight="T";this.qW.coloredReferencesFlight="T";this.qW.parenthesesCouplingFlight="T";this.qW.formulaAssistanceUiPositionFlight="T";this.qW.smartFormulaSuggestionsFeatureEnabled=Hd.a.Lob(this.$);this.qW.argumentAssistanceUxFlight="T";this.qW.uILocale=this.$.m9;this.qW.dataLocale=this.$.dataCultureTag;this.qW.country=JSON.parse(this.$.ua.SessionStartInfoJson).LocationCountry}xXi(){const va=
new ch.a;for(const mb of this.Xtb)mb.value.RHd(),va.add(`"${mb.key}":${se.a.Di(mb.value.u2)}`);return`"PerfMeasurements": {${va.toArray().join(",")}}`}THf(va,mb){return xc.a.contains(this.$.ua.FlightHolder.FlightId,mb,!0)?Gc.EwaSettings.getBooleanFeatureGate(va+mb,!1)?"T":"C":"None"}TX(va,mb){return`"${va.toString()}":${Xe.c(mb)}`}c$g(va){this.oKb[va]||(this.oKb[va]={shownCounter:0,committedCounter:0});this.nYa[va]||(this.nYa[va]={shownCounter:0,committedCounter:0})}}Object(Aa.a)(fg,"FormulaAssistanceTelemetryManager",
null,[726]);class Of extends yd.a{constructor(va){super();this.$=va;this.sn()}static Ga(va){va.qa.Rh(492,new Of(va))}create(){void la.a.resolve(db.Jd).then(va=>{var mb;this.dl(null!==(mb=this.$.qa.zh(491))&&void 0!==mb?mb:this.$.qa.Rh(491,new fg(this.$,va)))})}}Object(Aa.a)(Of,"FormulaAssistanceTelemetryManagerFactory",yd.a,[]);var Bg=a(934),uf=a(40),Lg=a(1439);class zg extends ob.a{constructor(va){super(va,zg.featureName);this.aXf=Gc.EwaSettings.isChangeGateEnabled("OfficeVSO:8582031_FormulaByExampleAsYouType")}static init(va){zg.Va?
ub.ULS.sendTraceTag(509122372,1,15,"FormulaSuggestionUIControl.init: unexpected call after already being inited."):zg.Va=new zg(va)}static instance(){return zg.Va}get el(){return Cb.a.IJd}show(va,mb,Tb,yc,Nc,zd,fe,Ud){zd=void 0===zd?null:zd;return this.nyb(void 0===fe?null:fe,P=>{appChrome.renderFormulaSuggestionCard(va,mb,this.domElement,P.y,P.x,P.y+P.height,P.x+P.width,Tb,yc,Nc,zd,this.yxb,Ud?{explanationKey:Ud.explanationKey,replacements:Ud.explanationReplacements,notifyExplanationSuccessful:Ud.MPc}:
void 0)})}Kue(va,mb,Tb,yc,Nc,zd,fe,Ud,P,Da,eb){return this.nyb(eb,bc=>{appChrome.renderRowNumberingSuggestionCard(va,mb,this.domElement,bc.y,bc.x,bc.y+bc.height,bc.x+bc.width,Tb,yc,Nc,zd,fe,Ud,P,Da,this.yxb)})}d_(va,mb,Tb){Gc.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FBECurtainLifterCalloutForTestingOnlyEnabled",!1)&&(this.s5&&va.equals(this.w2d)||(this.s5&&document.body.removeChild(this.s5),this.w2d=va,va=this.grid.yh(va),va=this.grid.getCellBounds(va.cell,!0),this.s5=document.createElement("div"),
this.s5.setAttribute("style",`position:fixed;
        left: ${va.x+va.width}px;
        top: ${va.y+va.height/2}px`),document.body.appendChild(this.s5)),va=new pc.a(-847286761,0,this.$.ji,0,null),this.$.Ia.qh(va,{["CalloutName"]:15,["Target"]:this.s5,["NewState"]:mb,["Reason"]:Tb}))}}Object(Aa.a)(zg,"FormulaByExampleCardUIControl",ob.a,[724]);class mh extends Bg.a{constructor(va){super(va)}sw(){ub.ULS.sendTraceTag(528758224,0,50,"FormulaByExampleCommandHandlerFactory.CreateCommandHandlersAsync: FormulaByExampleCommandHandler init flow started.");const va=jf.GetServiceTaskFactory.dk(this.$.qa,
453,454,1),mb=Object($f.d)(la.a.resolve(db.Pc,{va:this.gi})),Tb=Object($f.d)(la.a.resolve(db.Qc,{va:this.gi}));uf.TaskExtensions.$e(uf.TaskExtensions.Dq([va,mb,Tb],this.ya),()=>{const yc=new Lg.a(mb.result,va.result,zg.instance(),Tb.result);this.Zt([yc]);ub.ULS.sendTraceTag(537161924,0,50,"FormulaByExampleCommandHandlerFactory.CreateCommandHandlersAsync: FormulaByExampleCommandHandler initialized successfully")},this.ya)}static Ga(va){Bg.a.jB(455,new mh(va))}}Object(Aa.a)(mh,"FormulaByExampleCommandHandlerFactory",
Bg.a,[]);var Cg=a(108),Sf=a(1064);class dh{constructor(va,mb,Tb,yc,Nc){this.kind=va;this.value=mb;this.formatted=Tb;this.numFmt=yc;this.cellStyle=Nc}get displayText(){var va;return null!==(va=this.formatted)&&void 0!==va?va:this.value}}Object(Aa.a)(dh,"CloneEvaluatedEdit",null,[]);class jh{constructor(va,mb,Tb){this.status=va;this.bQb=void 0===mb?null:mb;this.zub=Tb}}Object(Aa.a)(jh,"FormulaByExampleFormulaEvalResult",null,[]);var lc=a(1089),md;(function(va){va[va.none=0]="none";va[va.number=1]="number";
va[va.string=2]="string";va[va.boolean=3]="boolean";va[va.error=4]="error"})(md||(md={}));Object(Aa.b)("CellValueType",md);var Yd;(function(va){va[va.none=0]="none";va[va.number=1]="number";va[va.string=2]="string";va[va.boolean=4]="boolean";va[va.error=8]="error";va[va.range=16]="range";va[va.array=32]="array";va[va.missing=64]="missing";va[va.blank=128]="blank";va[va.rich=256]="rich"})(Yd||(Yd={}));Object(Aa.b)("OperKind",Yd);var ke;(function(va){va[va.NoMismatch=0]="NoMismatch";va[va.Mismatch=
1]="Mismatch";va[va.HashesValueMismatch=2]="HashesValueMismatch"})(ke||(ke={}));Object(Aa.b)("EcsMismatchResult",ke);class bf extends Set{constructor(va){super();this.aca=va}add(va){if(this.has(va))return this;if(this.size>=this.aca){const mb=this.entries().next().value[0];this.delete(mb)}return super.add(va)}has(va){const mb=super.has(va);return mb?(this.delete(va),super.add(va),!0):mb}}Object(Aa.a)(bf,"LimitedSizeSet",Set,[]);class cf{constructor(va,mb){this.Lh=null;this.STg=this.$_f=this.BL=!1;
this.C2d=null;this.Kfe=(Tb,yc,Nc)=>{if(!this.jIc(Tb))return Object(Sf.h)(yc,"Result object from EvalOnClone API is empty or null.",this.ep,8),new jh(2);const zd=this.Del(Tb,yc);if(!Nc&&"OnlyPreviousFailureFound"===zd.reason)return new jh(4);if(!zd.success)return Object(Sf.h)(yc,`Evaluated results from calc do not match the user data in the grid or had errors from calc. reason: ${zd.reason}`,this.ep,8),ub.ULS.sendTraceTag(537161880,0,50,"FormulaByExampleModelUpdater:EvalFormulaRangeOnClone:Formula results from Calc.ts do not match grid data."),
new jh(2);this.ep.dw(yc.flowId,11);ub.ULS.sendTraceTag(537161879,0,50,"FormulaByExampleModelUpdater:EvalFormulaRangeOnClone: EvalFormulaRange CSE: Result received from calc.");return new jh(0,Tb.results,zd.zub)};this.Lh=va;this.BL=mb;this.ep=lc.a.getInstance(this.Lh);this.$_f=Gc.EwaSettings.isChangeGateEnabled("OfficeVSO:6327953_FormatOutputResultsOfFBE_V2");this.STg=Gc.EwaSettings.isChangeGateEnabled("OfficeVSO:7549840_DontShowFBESuggestionsWithErrorInTriggerCell")}$ke(va){this.C2d&&this.e7g(this.C2d,
!0,void 0,void 0,va)}dGk(va,mb,Tb,yc,Nc){Tb=void 0===Tb?null:Tb;yc=void 0===yc?!1:yc;mb=va.range.Fk(mb);return mb?this.Tvf(va,mb,Tb).then(zd=>{this.BL&&!yc&&va.flowId&&Object(Sf.f)("CALCULATIONED",va.flowId,Nc);if(2===zd.status)return zd;ub.ULS.sendTraceTag(537161881,0,50,"FormulaByExampleModelUpdater:setFormulaPreviewOnRangeModel: evalFormulaRangeOnClone CSE: Result received from calc.");this.C2d=zd;return this.e7g(zd,yc,va.flowId,Nc)}).catch(zd=>{Object(Sf.h)(va,`failed to setFormulaPreviewOnRangeModel, error in calc API: ${zd.toString()}`,
this.ep,8);return Promise.reject(`FormulaByExampleModelUpdater:setFormulaPreviewOnRangeModel: Unable to EvalFormulaRange, e: ${zd.toString()}`)}):(Object(Sf.h)(va,"Annotation range does not intersect loaded range",this.ep,6),Promise.reject("FormulaByExampleModelUpdater:setFormulaPreviewOnRangeModel: Annotation range does not intersect loaded range."))}Tvf(va,mb,Tb){Tb=void 0===Tb?null:Tb;const yc=this;return xo(function*(){let Nc,zd;const fe=cf.zAi(Tb);yc.ep.dw(va.flowId,7);try{return Gc.EwaSettings.isChangeGateEnabled("OfficeVSO:7974673_FBECircularReferenceFixCalcMitigation")?
(Nc=yield yc.Lh.U5(null,mb,va.originCell,va.formula,!0),zd=yc.Kfe(Nc,va,!1),4===zd.status&&(ub.ULS.sendTraceTag(508683744,0,50,`FormulaByExampleModelUpdater:EvalFormulaRangeOnClone: previous failure found, with no other errors, retry with cloneWrites. flow id: ${va.flowId}`),Nc=yield yc.Lh.U5(fe,mb,va.originCell,va.formula,!0),zd=yc.Kfe(Nc,va,!0))):(Nc=yield yc.Lh.U5(fe,mb,va.originCell,va.formula,!0),zd=yc.Kfe(Nc,va,!0)),zd}catch(Ud){return Object(Sf.h)(va,`failed to EvalFormulaRangeOnClone, error in calc API: ${Ud.toString()}`,
yc.ep,8),Promise.reject(`FormulaByExampleModelUpdater:EvalFormulaOnRange: Unable to EvalFormulaRange, e: ${Ud.toString()}`)}})}K9e(va,mb,Tb){var yc;if(va){var Nc=[];for(const Ud of va){if(!rf.a.OHc(Ud))continue;var zd=Ud;va=N(zd.value.cell);var fe=this.Lh.yh(va);if(!fe)continue;zd=this.kMd(zd);fe=fe.cell;const P=fe.hQ;(null===(yc=zd.cellStyle)||void 0===yc?0:yc.HorizontalAlignment)&&fe.c_(zd.cellStyle.HorizontalAlignment,!0,!0);P||ub.ULS.sendTraceTag(508179167,0,50,`FormulaByExampleModelUpdater:applyFormulaCSE: cell CSE failed for flow ${Tb}`);
fe.text=P;fe.formulaBarText=mb;Nc.push({text:P,value:zd.value,kind:zd.kind,range:va})}H(this.Lh,Nc,Tb)}}static zAi(va){const mb=Tb=>({row:Tb.cell.IH,column:Tb.cell.RK,Qn:Tb.Qn,formulaBarText:Tb.Qn.value,text:Tb.cell.text,to:Tb.cell.to});return va?va.map(mb):null}jIc(va){return(va=va.results)&&va.length?!0:!1}e7g(va,mb,Tb,yc,Nc){var zd=va.bQb;for(const fe of zd){if(!rf.a.OHc(fe)){"Unavailable"!==fe.reason.kind&&(va.status|=2);continue}zd=fe.value.cell;if(!zd){va.status|=2;continue}zd=N(zd);if(Nc&&
!zd.$i(Nc))continue;zd=this.Lh.yh(zd);if(!zd){va.status|=2;continue}const Ud=zd.cell,P=this.kMd(fe);Ud.hQ=P.displayText;Ud.l6a=P.numFmt;Ud.q4b=P.cellStyle;Gc.EwaSettings.isChangeGateEnabled("OfficeVSO:8618122_NLNPreviewChange")&&(Ud.eKg=L(zd,fe));va.status|=1}this.BL&&!mb&&Tb&&Object(Sf.f)("MODELUPDATED",Tb,yc);return va}Del(va,mb){let Tb=null,yc=!1,Nc=!1,zd=!1,fe=!1,Ud=!1,P=!1,Da=!1,eb=!1,bc=!1;va=va.results;const Pc=new bf(5);var gd=va.entries();for(const nd of gd){gd=nd[0];const Vd=this.Eel(nd[1],
mb);Vd.$pb&&(yc=Vd.KOb);Vd.y0d&&(Nc=!0,zd||(zd=Vd.isInViewport),Ud||(Ud=Vd.isInViewport&&!Vd.CXb));fe||(fe=Vd.CXb);P||(P=Vd.aSf);Tb=null!==Tb&&void 0!==Tb?Tb:Vd.gXa;Da||(Da=Vd.L2f);eb||(eb=Vd.Y1f);Vd.KOb&&(Vd.o8e||Vd.n8e)&&Pc.add(`grid: ${Vd.o8e}, clone: ${Vd.n8e}`);(Vd.y0d||Vd.CXb)&&va.splice(gd,1);bc||Vd.Qcg||(bc=!0)}yc?this.ep.dw(mb.flowId,10):this.ep.dw(mb.flowId,9);return Tb?{success:!1,reason:Tb}:Da?{success:!1,reason:"OnlyPreviousFailureFound"}:{success:!0,zub:{["hasUnavailableCells"]:Nc,["hasUnexpectedUnavailableCellsInViewport"]:Ud,
["hasHiddenRows"]:fe,["hasUnavailableCellsInViewport"]:zd,["hasErrorCells"]:P,["hasNumFmtInSuggestion"]:eb,["formattedResultsGridComparisons"]:[...Pc],["renderedPreviewIsDirty"]:bc}}}Eel(va,mb){var Tb;const yc={$pb:!1,y0d:!1,isInViewport:!1,CXb:!1,L2f:!1,gXa:null,aSf:!1,KOb:!1,Y1f:!1,Qcg:!1};if(!rf.a.OHc(va)){va=va.reason;var Nc=Qb.Range.yi(va.cell.row+1,va.cell.col+1);yc.$pb=Nc.equals(mb.originCell);this.DAf(yc,Nc);if("Unavailable"===va.kind)return yc.y0d=!0,yc;if("PreviousFailure"===va.kind)return yc.L2f=
!0,yc;yc.gXa=JSON.stringify({kind:va.kind,innerKind:va.innerKind});yc.gXa=null!==(Tb=yc.gXa)&&void 0!==Tb?Tb:"failure in calc";return yc}var zd=N(va.value.cell);yc.$pb=zd.equals(mb.originCell);this.DAf(yc,zd);Tb=this.Lh.yh(zd);if(!Tb){if(yc.isInViewport&&!yc.CXb)return yc.gXa="formatted grid cell is null",yc;ub.ULS.sendTraceTag(509682371,0,50,"FormulaByExampleModelUpdater:validateCalcResultMatchesCellData: did not fail suggestion when a formatted grid cell is null as this cell is hidden or not in view.");
return yc}Nc=this.kMd(va,this.$_f?Tb:null);if(8===Nc.kind)return yc.aSf=!0,this.STg&&yc.$pb&&(yc.gXa=`suggestion has error of kind ${Nc.value} in cell.`),yc;const fe=Tb.text;if(!fe)return yc.KOb=!0,yc;const Ud=Nc.displayText;yc.KOb=L(Tb,va);yc.n8e=xc.a.g0(Ud);yc.o8e=xc.a.g0(fe);yc.Qcg=Tb.cell.l6a?Tb.cell.l6a===va.value.value.numFmt:Tb.cell.hQ===va.value.value.formattedText;yc.KOb||(zd=mb.r_f(zd)?yc.$pb?"MODIFIEDEXAMPLE":"EXAMPLE":yc.$pb?"MODIFIEDRESTOFRANGE":"RESTOFRANGE",Object(Sf.g)(yc.Y1f?"numFmtMismatch":
"textMismatch",fe,Ud.toString(),Tb.cell.to,"evalFormulaOnCloneToShowPreview",mb,zd,L(Tb,va),Tb.cell.numFmt,Nc.numFmt),yc.gXa="data strings do not match");return yc}DAf(va,mb){va.isInViewport=this.Lh.SD(mb);va.CXb=this.Lh.jj.Moa(mb)}kMd(va,mb){const Tb=va.value.value,yc=Df(va).toString();if(mb&&!Tb.formattedText&&""!==Tb.formattedText){va=va.value.formatted;var Nc=Af(Tb.kind);va=this.Lh.waa(va,Nc,xf.a,mb);Object(ff.c)(va)&&(Tb.formattedText=va.value.text,Tb.numFmt=va.value.numFmt,Nc=new Ig.a,Nc.HorizontalAlignment=
0===mb.cell.horizontalAlignment?va.value.horizontalAlignment:null,Tb.cellStyle=Nc)}return new dh(Tb.kind,yc,Tb.formattedText,Tb.numFmt,Tb.cellStyle)}}Object(Aa.a)(cf,"FormulaByExampleModelUpdater",null,[]);const Df=va=>{va=va.value.value;return 1===va.kind?va._valueXL:8===va.kind?Lb.a.hkb[va.type-1]:va.value},Af=va=>{switch(va){case 1:return 1;case 2:return 2;case 8:return 4;case 4:return 3;default:return 0}};var qg=a(1272),Pg=a(1271);class Mg extends Pg.a{constructor(va,mb,Tb,yc){super(va,mb,Tb,
yc);this.kind="Table"}get table(){void 0===this.feb&&(this.feb=this.Lh.Ml(this.originCell,!1));return this.feb}set table(va){this.feb=va}get Gx(){return this.table?rf.a.Vga(this.table):null}}Object(Aa.a)(Mg,"FormulaByExampleTableSuggestion",Pg.a,[759]);var gh=a(1126),Hh=a(1201),Ph=a(1127),rh=a(1274),eh=a(1234),Yf=a(1412);class Qg{constructor(va){this.PPf=!1;this.Lh=va}Dxh(va){"ACCEPT"===va?this.Lh.oi(-458824895,-1,0,null):"DECLINE"===va?this.Lh.oi(-1726708382,-1,0,null):"IGNORE"===va&&(this.PPf?this.Lh.oi(-1227021552,
-1,0,null):this.PPf=!0)}}Object(Aa.a)(Qg,"FormulaByExampleSurveyManager",null,[]);const uh=[Object(gb.d)("featureNameField","FormulaByExample"),Object(gb.d)("ver","1.0.0")],Kh={eventName:"Office.Excel.FormulaByExample.Seen",eventFlags:od.a,dataFields:[...uh,Object(gb.a)("isFeatureSeen",!0)]},ai={eventName:"Office.Excel.FormulaByExample.Tried",eventFlags:od.a,dataFields:[...uh,Object(gb.a)("isFeatureTried",!0)]},fh={eventName:"Office.Excel.FormulaByExample.Succeeded",eventFlags:od.a,dataFields:[...uh,
Object(gb.a)("isFeatureSucceeded",!0)]};var Uh=a(145),Sg=a(132);class xh extends Sys.EventArgs{constructor(va){super();this.suggestion=va}}Object(Aa.a)(xh,"FormulaByExampleAnnotationArrivedEventArgs",Sys.EventArgs,[]);class Fg{constructor(va,mb,Tb){this.formulaByExampleManager=va;this.xra=mb;this.ep=Tb;this.UEf=yc=>"Table"===yc.kind?this.ep.zAc(yc.table.name,yc.column):this.ep.PRb(yc.Gx,yc.column,yc.sheetId);this.P$d=(yc,Nc)=>{yc=Nc.suggestion;Nc=this.UEf(yc);this.uMb.has(Nc)&&this.uMb.get(Nc).P$d(Z(yc))};
this.aUj=(yc,Nc)=>{yc=Nc.suggestion;Nc=this.UEf(yc);let zd;this.uMb.has(Nc)?(zd=this.uMb.get(Nc),zd.T2g(Z(yc),yc.anonymizedFormula,yc.flowId)):(zd=new Tg(Nc,yc),this.uMb.set(Nc,zd))};this.uMb=new Map;this.formulaByExampleManager.vCh(this.P$d);this.xra.wCh(this.aUj)}}Object(Aa.a)(Fg,"FormulaByExamplePostSuggestionSpiesManager",null,[]);class Tg{constructor(va,mb){this.Grd=va;this.ZLc=null;this.Uhe=new Map;this.T2g(Z(mb),mb.anonymizedFormula,mb.flowId)}T2g(va,mb,Tb){this.e0f(va)||(this.Uhe.set(va,new sh(va,
mb,Tb,!0)),this.ZLc=va)}P$d(va){if(this.ZLc){var mb=this.XLf(this.ZLc);mb?(va!==this.ZLc&&(mb.mqc=!0,this.b$f(mb)),this.e0f(va)&&(va=this.XLf(va),va.zaj(),va.mqc&&(va.Qme=!0),this.b$f(va))):ub.ULS.sendTraceTag(508687501,306,50,`FormulaByExampleColumnSpy.onFormulaAnnotationForColumn: failed to get latest rejected formula records for column ${this.Grd}`)}else ub.ULS.sendTraceTag(508687502,306,15,`FormulaByExampleColumnSpy.onFormulaAnnotationForColumn: unexpected state - latest rejected formula is null for column ${this.Grd}`)}XLf(va){return this.Uhe.get(va)}e0f(va){return this.Uhe.has(va)}b$f(va){ub.ULS.sendTraceTag(137687059,
306,20,`FormulaByExampleColumnSpy.logRejectedFormulaRecords: ${JSON.stringify({["anonymousColumnId"]:this.Grd,["suggestionFlowId"]:va.QYk,["formulaAnonymized"]:va.Gaa,["inPatternEditsPostSuggestion"]:va.jaj,["brokePattern"]:va.mqc,["resumedPattern"]:va.Qme,["latestEditInPattern"]:va.YLc})}`)}}Object(Aa.a)(Tg,"ColumnSpy",null,[]);class sh{constructor(va,mb,Tb,yc){this.AEa=va;this.pgc=mb;this.Yuh=Tb;this.jPe=0;this.Gjd=this.k9c=!1;this.BSe=yc}get formula(){return this.AEa}get Gaa(){return this.pgc}get QYk(){return this.Yuh}get jaj(){return this.jPe}zaj(){this.jPe++}get mqc(){return this.k9c}set mqc(va){if(this.k9c=
va)this.YLc=!1}get Qme(){return this.Gjd}set Qme(va){if(this.Gjd=va)this.YLc=!0}get YLc(){return this.BSe}set YLc(va){this.BSe=va}}Object(Aa.a)(sh,"ColumnSpyFormulaRecords",null,[]);class Vh extends Ef.a{constructor(va,mb,Tb){super();this.CXg=Tb;this.OP=this.BH=this.xra=this.iNa=this.Lh=null;this.Z2a=this.BL=!1;this.bD=null;this.lue=!1;this.$Qb=null;this.WUg=!1;this.vdg=2E3;this.eDf=null;this.g9g=0;this.Hsd=!1;this.ZFc=[];this.Nw=null;this.hGj=1E4;this.E8j=Gc.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaByExamplePluginSuggestionShowing",
!1);this.yQj=yc=>{ub.ULS.sendTraceTag(520987789,306,50,`FormulaByExampleManager.onCloseCallback: closeReason = ${eh.a[yc]}`)};this.RAi=(yc,Nc)=>{var zd,fe,Ud,P,Da,eb;ub.ULS.sendTraceTag(528758222,306,50,"FormulaByExampleManager.formulaByExampleAnnotationHandler: annotation received.");(yc=Nc.annotation)?(Nc=parseInt(yc.guid,10),0>Nc||Gc.EwaSettings.isChangeGateEnabled("OfficeVSO:7417755_FormulaByExampleVerifyDuplicatedAnnotation")&&!this.ep.Q_f(Nc)||(ub.ULS.sendTraceTag(526984792,306,50,`FormulaByExampleManager.formulaByExampleAnnotationHandler: received annotation's flowId: ${Nc}, containsRowPlaceholder: ${null===
(fe=null===(zd=yc.generatedFormula)||void 0===zd?void 0:zd.formula)||void 0===fe?void 0:fe.includes(gh.b)}`),this.ep.dw(Nc,14),zd=this.Q8j(Nc),fe=this.Lh,fe=zd.tV?new Mg(fe,yc,Nc,zd):new gh.a(fe,yc,Nc,zd),this.Nw&&(this.Nw.Tja(Nc,4,{formula:null===(Ud=yc.generatedFormula)||void 0===Ud?void 0:Ud.formula,Gaa:null===(P=yc.generatedFormula)||void 0===P?void 0:P.anonymizedFormula}),this.Nw.Ujb(Nc)),this.raiseEvent("fbeaa",new xh(fe)),Object(Yf.b)(fe)||this.Lh.h2a()?(this.BL&&!this.Z2a&&Object(Sf.f)("ANNOTATIONRECEIVED",
fe.flowId),null!=fe.errorMessage?(ub.ULS.sendTraceTag(527005666,306,10,`FormulaByExampleManager.formulaByExampleAnnotationHandler: annotation arrived with error message: ${fe.errorMessage}, flowId: ${fe.flowId}`),this.ep.dw(fe.flowId,15,{reason:"Annotation arrived with error message"})):fe.formula?(null===(eb=this.CXg)||void 0===eb?void 0:eb.ZTj(fe.flowId),ub.ULS.sendTraceTag(509679808,306,20,`FormulaByExampleManager.formulaByExampleAnnotationHandler: annotation with a formula suggestion arrived. flowId: ${fe.flowId} isTableSuggestion: ${Object(Yf.b)(fe)}}`),
this.ep.dw(fe.flowId,16,{COc:fe.formula}),this.OP=fe,(Ud=this.xra.rfa(fe))?this.WUg||1!==fe.invocationMethod?fe.BE<Ph.a?ub.ULS.sendTraceTag(528758220,306,50,"FormulaByExampleManager.formulaByExampleAnnotationHandler: annotation does not have enough examples to prompt a suggestion."):(ub.ULS.sendTraceTag(527005665,306,50,`FormulaByExampleManager.formulaByExampleAnnotationHandler: annotation with formula suggestion arrived. trying to suggest/apply it. flowID: ${fe.flowId}`),0===fe.invocationMethod?
this.cGk(Ud):(P=Object(Sf.c)(fe.flowId),P>this.vdg?(ub.ULS.sendTraceTag(509636688,306,50,`FormulaByExampleManager.formulaByExampleAnnotationHandler: annotation arrived after the maximal wait time for suggestions. flowId: ${fe.flowId}, duration: ${P}`),this.ep.dw(fe.flowId,6,{reason:"annotation arrived after the maximal wait time for suggestions"})):(P=this.UUg(Ud,zd),P.value?this.R3g(Ud,!1,`${(null===zd||void 0===zd?0:zd.m_)?rf.a.ELd(zd.m_):"UnknownCommand"} - UponAnnotationReceived`,zd):(ub.ULS.sendTraceTag(509636687,
306,50,`FormulaByExampleManager.formulaByExampleAnnotationHandler: shouldShowPreview returned false for suggestion with flowId: ${fe.flowId}, reason: ${P.reason}`),this.ep.dw(fe.flowId,6,{reason:P.reason}))))):ub.ULS.sendTraceTag(523850754,306,50,"FormulaByExampleManager.formulaByExampleAnnotationHandler: session supports suggestions from cache only. returning early after caching suggestion."):ub.ULS.sendTraceTag(509678998,306,15,`FormulaByExampleManager.formulaByExampleAnnotationHandler: failed to cache suggestion for flowId: ${fe.flowId}.`)):
(ub.ULS.sendTraceTag(528758221,306,50,`FormulaByExampleManager.formulaByExampleAnnotationHandler: annotation does not have any formula suggestions. deleting existing entry, if any. flowId: ${fe.flowId}`),this.xra.djb(fe),this.BH.d_(fe.originCell,2),this.ep.dw(fe.flowId,15),null===(Da=this.CXg)||void 0===Da?void 0:Da.$Tj(fe.flowId))):ub.ULS.sendTraceTag(509204251,306,10,"FormulaByExampleManager.formulaByExampleAnnotationHandler: range table suggestions should not be created in this session."))):ub.ULS.sendTraceTag(537161922,
306,15,"FormulaByExampleManager.formulaByExampleAnnotationHandler: annotation is null.")};this.vYc=()=>{ub.ULS.sendTraceTag(537161889,306,50,"FormulaByExampleManager.SendByExampleFeedback: opening send feedback dialog after click on card.");const yc={};yc[Xa.a.QM]="FormulaByExampleCard";this.Lh.oi(802602464,0,8,yc)};this.Srg=yc=>{this.lue=!0;ub.ULS.sendTraceTag(537161888,306,50,`FormulaByExampleManager.OnShowFormula: user clicked ShowFormula button in the card for flow ${yc}`)};this.$Tb=yc=>{ub.ULS.sendTraceTag(528758219,
306,50,"FormulaByExampleManager.HandleNewBlocksDuringPreview: new block arrived during preview mode.");const Nc=yc.Oj.block,zd=this.OP.Gx,fe=this.OP.range.Fk(Nc.zj);this.iNa.$ke(fe);const Ud=(new Qb.Range(zd.top,zd.left,zd.bottom,zd.right,!0,!0)).Fk(Nc.zj),P=Array.from(this.Lh.Lga(Ud,Nc));ub.ULS.sendTraceTag(537161886,306,50,`FormulaByExampleManager.HandleNewBlocksDuringPreview: putting skeleton for preview cells in new block ${yc.Oj.hash}.`);this.ZFc.includes(yc.Oj.hash)||this.IBe(fe,!0);const Da=
()=>{this.Uvf(this.OP,Ud,P).then(eb=>{ub.ULS.sendTraceTag(537161885,306,50,`FormulaByExampleManager.HandleNewBlocksDuringPreview: putting calculated data into model and demanding re-render for block ${yc.Oj.hash}.`);this.ZFc.includes(yc.Oj.hash)||this.IBe(fe,!1);eb.zub.renderedPreviewIsDirty&&this.Lh.g0b(yc.Oj.block);ub.ULS.sendTraceTag(512508567,306,50,`FormulaByExampleManager.handleNewBlocksDuringPreview: new FormulaByExample suggestion block rendered during preview. results: ${JSON.stringify({["flowId"]:this.OP.flowId,
["originalFlowId"]:this.OP.yZ.flowId,["formulaAnonymized"]:this.OP.anonymizedFormula,["originalFormulaAnonymized"]:this.OP.yZ.anonymizedFormula,["annotationRange"]:this.OP.range.toString(),["previewCellsMetadata"]:eb.zub})}`);return!0}).catch(eb=>{Object(Sf.h)(this.OP,`Exception when rendering new block during preview. ${eb}`);ub.ULS.sendTraceTag(537161884,306,50,`FormulaByExampleManager.HandleNewBlocksDuringPreview: caught exception: ${eb}.`)})};if(Gc.EwaSettings.isChangeGateEnabled("OfficeVSO:8198794_FBEPreviewAwaitsDataFlushToCalc")){const eb=
()=>{this.Lh.Z5b(eb);Da()};this.Lh.QIb(eb)}else Da();return!0};this.wFg=()=>{this.Lh.vu(this.t5a);this.t5a=null};this.nia=(yc,Nc)=>{0!=Nc.zx||Gc.EwaSettings.isChangeGateEnabled("OfficeVSO:8190374_FixDDARequestCloseFBE")&&576===Nc.Xl.operation.operationName||(this.Z2a&&this.bD.eba(`UserOperation: ${rf.a.ygh(Nc.Xl.operation.operationName)}`),this.Lh.vu(this.nia))};this.kae=yc=>{const Nc=yc.suggestion.flowId;ub.ULS.sendTraceTag(528023709,306,20,`FormulaByExampleManager.onImmediateUndo: undo operation queued following a formula by example suggestion application. flowId=${Nc} originalFlowId=${yc.suggestion.yZ.flowId} isTableSuggestion=${Object(Yf.b)(yc.suggestion)}`);
this.xra.$Rg(yc,"UNDO");this.Nw&&Gc.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaByExamplePluginCacheEnabled",!1)&&void this.Lh.pluginScheduler.eventEmitter().FBEOutcomeUpdate({flowId:Nc,suggestionOutcome:{outcome:"UNDO"}})};this.WUg=Gc.EwaSettings.isChangeGateEnabled("OfficeVSO:6169955_ShowFormulaByExampleSuggestionsUponArrivalFromServer");this.vdg=Gc.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.FormulaByExampleMaximalWaitingTimeForSuggestionsMs",2E3);this.Hsd=Gc.EwaSettings.isChangeGateEnabled("OfficeVSO:8582031_FormulaByExampleAsYouType");
this.Lh=va;this.$Qb=new Map;this.BH=mb;this.ep=lc.a.getInstance(this.Lh);this.bfe=!1;va.g2a()?this.init():ub.ULS.sendTraceTag(537161923,306,10,"FormulaByExampleManager.Ctor: not expected to be constructed when FG is off.")}B2j(va,mb){const Tb=mb.LRc;this.$Qb.set(va,mb);this.bfe=!1;const yc=this.xra.$_i(mb,va);if(yc){this.Nw&&Gc.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaByExamplePluginCacheEnabled",!1)&&(this.Nw.Tja(va,3,{formula:yc.suggestion.formula,Gaa:yc.suggestion.anonymizedFormula,
kba:!0,tT:yc.tT,cpa:yc.state}),this.Nw.Ujb(va));this.ep.dw(va,4);yc.suggestion.flowId=va;yc.suggestion.originCell=Tb;var Nc=this.UUg(yc,mb);Nc.value?(ub.ULS.sendTraceTag(529109774,306,50,"FormulaByExampleManager.onUserInput: A cached formula suggestion found for current input."),this.R3g(yc,!0,`${mb.m_?rf.a.ELd(mb.m_):"UnknownCommand"} - FromCache`,mb)):(this.ep.dw(va,6,{reason:Nc.reason}),this.ufl(va,yc.suggestion,Tb))}else this.ep.dw(va,5),this.Nw&&Gc.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaByExamplePluginCacheEnabled",
!1)&&this.Nw.Tja(va,2,{kba:!1,cpa:Hh.b.unseen,tT:0})}vCh(va){this.addHandler("fbeaa",va)}ufl(va,mb,Tb){Gc.EwaSettings.isChangeGateEnabled("OfficeVSO:7041480_FormulaByExampleFlowAggregatorFixed")&&this.Lh.evalFormula(mb.formula,Tb,rf.a.o1(this.Lh.la),excelOnlineCalc.calc.evalFormulaFormatOrigin()).then(yc=>{var Nc=this.Lh.yh(Tb);const zd=Nc.text;Nc=Nc.cell.to;yc=yc.value.value.toString();xc.a.equals(zd,yc,!1)?this.ep.dw(va,10):(Object(Sf.g)("textMismatch",zd,yc,Nc,"evalFormulaToVeriySuggestionWithoutShowingPreview",
mb,mb.r_f(Tb)?"MODIFIEDEXAMPLE":"MODIFIEDRESTOFRANGE",null),this.ep.dw(va,9))}).catch(yc=>{yc=`Failed to evalFormula, error in calc API: ${yc.toString()}`;ub.ULS.sendTraceTag(512341207,306,50,`FormulaByExampleMangaer.verifySuggestionOnEditedCell: ${yc}`);this.ep.dw(va,9,{reason:yc})})}dispose(){this.Lh.vu(this.nia);this.wFg();this.Lh.u7k();super.dispose()}init(){const {FormulaByExampleAutoSuggestActor:va}=a(1477);this.Lh.Kch(this.yQj,{annotationType:qg.a.getTypeName(),EA:!1,NV:this.RAi});this.BL=
Object(Sf.a)(this.Lh);new va(this.Lh,this.BL);this.xra=new Yf.a(this.Lh,this.BH,this.ep);this.iNa=new cf(this.Lh,this.BL);this.eDf=new Qg(this.Lh);Gc.EwaSettings.isChangeGateEnabled("OfficeVSO:7959804_FormulaByExampleSpies")&&new Fg(this,this.xra,this.ep);this.Nw=this.Lh.Nw;ub.ULS.sendTraceTag(528758223,306,50,"FormulaByExampleManager.init: init complete.")}Q8j(va){if(!this.$Qb.has(va))return null;const mb=this.$Qb.get(va);this.$Qb.delete(va);return mb}cGk(va){const mb=va.suggestion;this.iNa.Tvf(mb,
mb.range,null).then(Tb=>{this.asd(va,1===Tb.status?Tb.bQb:null,!1);return null}).catch(()=>{ub.ULS.sendTraceTag(537161921,306,50,"FormulaByExampleManager.setFormulaOnRangeExplicit: client estimation failed for explicit by example flow.");this.asd(va,null,!1)})}R3g(va,mb,Tb,yc){ub.ULS.sendTraceTag(527713160,306,20,`FormulaByExampleManager.tryDisplayFormulaSuggestionPreview: starting flow to show a formula suggestion. isFromCache: ${mb} isTableSuggestion: ${Object(Yf.b)(va.suggestion)} flowId: ${va.suggestion.flowId})}`);
const Nc=va.suggestion;this.BL&&!this.Z2a&&Object(Sf.f)("CALCULATIONSTART",Nc.flowId,mb);const zd=this.gIf(Nc.Gx);var fe=Promise.resolve();Gc.EwaSettings.isChangeGateEnabled("OfficeVSO:8198743_FormulaByExampleTier1Langs")&&Nc.formula&&(fe=this.Lh.localizeEnglishFormula(Nc.formula,this.Lh.b_c,Nc.originCell).then(vd=>{if(Object(ff.c)(vd))return Nc.XAi=vd.value,Promise.resolve();vd=`FormulaByExampleManager.tryDisplayFormulaSuggestionPreview: failed to print formula. error: ${JSON.stringify(vd.reason.kind)}`;
ub.ULS.sendTraceTag(508160210,306,10,vd);return Promise.reject(vd)}));fe=fe.then(()=>this.Uvf(Nc,this.Lh.getLoadedRange(),zd,mb));let Ud=0,P=null,Da=null,eb=!1,bc=!1,Pc=void 0,gd=!1,nd=null,Vd=!1;const ie=fe.then(vd=>{const Sd={FirstRow:Nc.range.top,FirstColumn:Nc.range.left,LastRow:Nc.range.bottom,LastColumn:Nc.range.right};let te=void 0;if(this.Hsd&&504848446===yc.m_){const ne=vd.bQb.find(Ce=>N(Ce.value.cell).equals(Nc.originCell));te=Df(ne).toString()}return this.Lh.T8(Nc.range,this.$Tb,Gc.EwaSettings.isChangeGateEnabled("OfficeVSO:8618122_NLNPreviewChange")?
{PreviewCellsRange:Sd,RetainCellTextOnPreview:!0}:void 0,te?{hQ:te,W_c:yc.W_c}:void 0).then(ne=>{this.Z2a=!0;this.bD=ne;this.bD.f6e((df,da)=>{this.BH.hide();Ud++;1===Ud?P=da.reason:Da=da.reason});this.bD.wqd(()=>{const df=this.gvg(Nc,Nc.generatedFormula.explanationReplacements);this.iNa.$ke();({XVd:Vd,P7a:nd}=this.rVg(Nc,ne,Ce,"Success"===df.kind?{explanationKey:Nc.generatedFormula.explanationKey,explanationReplacements:df.explanationReplacements,MPc:da=>{gd=da}}:void 0));Vd||(this.bD.eba("CardUI failure"),
this.qme());eb=!0});if(this.bD.didPrime)this.iNa.$ke(),bc=!0;else if(Gc.EwaSettings.isChangeGateEnabled("OfficeVSO:8560939_FormulaByExampleAsYouTypeVerifiesContentOnEndEdit")&&te){const df=(da,hb)=>{ub.ULS.sendTraceTag(6370629,306,20,JSON.stringify({flowId:Nc.flowId,npl:te===hb.cellText,opl:hb.committed}));this.Lh.J2(df)};this.Lh.zX(df)}let Ce=null;Ce=Gc.EwaSettings.isChangeGateEnabled("OfficeVSO:7858168_FBEHideFeedbackButton")?this.Lh.isFeedbackEnabled?this.vYc:null:this.vYc;const Qe=this.gvg(Nc,
Nc.generatedFormula.explanationReplacements);"Failure"===Qe.kind&&"FG disabled"!==Qe.failureReason&&ub.ULS.sendTraceTag(507593605,306,10,`FormulaByExampleManager.tryDisplayFormulaSuggestionPreview: failed to parse explanation replacements. error: ${Qe.failureReason}, flowId: ${Nc.flowId}`);({XVd:Vd,P7a:nd}=this.rVg(Nc,ne,Ce,"Success"===Qe.kind?{explanationKey:Nc.generatedFormula.explanationKey,explanationReplacements:Qe.explanationReplacements,MPc:df=>{gd=df}}:void 0));if(Gc.EwaSettings.isChangeGateEnabled("OfficeVSO:8329602_AbortPreviewIfCardFailedToRender")&&
!Vd)return this.bD.eba("CardUI failure"),this.qme(),Promise.reject("Failed to show card UI");this.Lh.qw(this.nia);this.BH.d_(Nc.originCell,0);this.BL&&rf.a.xLg(()=>{var df,da;Object(Sf.f)("PREVIEWRENDERED",Nc.flowId,mb);const hb={["flowId"]:Nc.flowId,["originalFlowId"]:Nc.yZ.flowId,["displayTrigger"]:Tb,["formulaAnonymized"]:Nc.anonymizedFormula,["originalFormulaAnonymized"]:Nc.yZ.anonymizedFormula,["annotationRange"]:Nc.range.toString(),["isFullyInViewport"]:this.Lh.SD(Nc.range),["isCachedSuggestion"]:mb,
["exampleCount"]:Nc.BE,["originalExampleCount"]:Nc.yZ.BE,["seenCount"]:va.tT,["previewCellsMetadata"]:vd.zub,["previewShownDurations"]:Object(Sf.e)(mb,Nc.flowId),["isSuggestionOnTable"]:Object(Yf.b)(Nc),["isNewRowPrediction"]:!Object(Yf.b)(Nc)&&Nc.TXb,["sheetId"]:Nc.sheetId,["areAllHeadersLoaded"]:Object(Yf.b)(Nc)?null===(df=Nc.table.c9)||void 0===df?void 0:df.IsFullTableHeaders:"nonTableSuggestion",["tableRange"]:null===(da=Nc.Gx)||void 0===da?void 0:da.toString(),["dataCulture"]:this.Lh.$.dataCultureTag,
["UICulture"]:this.Lh.$.m9};this.Lh.f2a()&&(Pc=this.sXh(vd.bQb,Nc.originCell));ub.ULS.sendTraceTag(84165903,306,50,`FormulaByExampleManager.TryDisplayFormulaSuggestionPreview: Suggestion shown, awaiting user decision. flowData: ${JSON.stringify(hb)}`)},this.Lh.ya);return ne.a7b})});Promise.all([fe,ie]).then(vd=>{var [Sd,te]=vd;this.bfe=!0;this.s5i(Sd,te,va,mb,Tb,{["softIgnoreCount"]:Ud,["softIgnoreReasons"]:[P,Da],["didReshow"]:eb,["didPrime"]:bc},{$ni:Pc},gd,nd)}).catch(vd=>{Object(Sf.h)(Nc,`Failed to show formula preview due to a promise (model update or preview render) rejection. rejection reason: ${vd}`);
ub.ULS.sendTraceTag(537161920,306,15,`FormulaByExampleManager.TryDisplayFormulaSuggestionPreview: failed to show formula preview due to promise rejection. rejection reason: ${vd}`);this.BH.d_(Nc.originCell,5,vd);va.state=Hh.b.unseen})}rVg(va,mb,Tb,yc){if(Gc.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaByExample.ShowRowNumberingCard",!1)&&this.Jrj(va.anonymizedFormula)){const Nc={isAcceptAsValues:!1,maxTooltipOpenDurationMS:0,isFurtherExplanationHyperlinkClicked:!1,disableApplyAsValue:va.range.zz>
this.hGj};return{XVd:this.BH.Kue(va.formula,va.range.toString(),()=>{mb.Uta("CardUI")},()=>{Nc.isAcceptAsValues=!0;mb.Uta("CardUI")},Nc.disableApplyAsValue,()=>mb.pIa("CardUI"),zd=>{Nc.maxTooltipOpenDurationMS=Math.max(Nc.maxTooltipOpenDurationMS,zd)},()=>{Nc.isFurtherExplanationHyperlinkClicked=!0},Tb,()=>this.Srg(va.flowId),va.originCell),P7a:Nc}}return{XVd:this.BH.show(va.formula,va.range.toString(),()=>{mb.Uta("CardUI")},()=>mb.pIa("CardUI"),Tb,()=>this.Srg(va.flowId),va.originCell,yc),P7a:null}}Jrj(va){const mb=
/^ROW\(\) [-+] ROW\(\w+\)( [-+] \d+)?$/;return/^ROW\(\) [-+] \d+$/.test(va)||"ROW()"===va||Gc.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaByExampleReferenceRowFormula",!1)&&mb.test(va)}gvg(va,mb){var Tb;if(!Gc.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaByExampleExplanations",!1))return{kind:"Failure",failureReason:"FG disabled"};if(!mb||0===mb.length)return{kind:"Failure",failureReason:"No explanation replacements"};const yc=[];for(const fe of mb){if(!["ColumnName",
"LeftColumnName","RightColumnName","ColumnNames"].includes(fe.replacementPlaceHolder)){yc.push(fe);continue}mb=[];"ColumnNames"!==fe.replacementPlaceHolder?mb.push(fe.replacementValue):mb=fe.replacementValue.split(", ");let Ud=0;for(const P of mb){if(Object(Yf.b)(va)){var Nc=this.Lh.extractReferences(`=${P}`,this.Lh.la.name,this.Lh.KDe,!0,va.originCell);if(!Nc||!Nc.Items||1!==Nc.Items.length)return{kind:"Failure",failureReason:`Failed to extract singular ref from column replacement. refs non null: ${!!Nc}, refs count: ${null===
(Tb=null===Nc||void 0===Nc?void 0:Nc.Items)||void 0===Tb?void 0:Tb.length}`};const Da=Nc.Items[0];Nc=va.table.c9.HeadersList.find(eb=>eb.Index===Da.Range.FirstColumn);if(!Nc)return{kind:"Failure",failureReason:`Failed to find header for column replacement index in grid. ref: ${Da.Range.FirstColumn}`};mb[Ud]=Nc.Name}else{Nc=P.replace(gh.b,"");var zd=Object(Fc.D)(`${Nc}:${Nc}`);if(!zd)return{kind:"Failure",failureReason:`Failed to parse column replacement ref. columnLetter: ${Nc}, columnName: ${P}`};
zd=va.headerRow.get(zd.left);mb[Ud]=zd?zd:Nc}Ud++}yc.push({replacementPlaceHolder:fe.replacementPlaceHolder,replacementValue:mb.join(", ")})}return{kind:"Success",explanationReplacements:yc}}sXh(va,mb){const Tb=this.Lh.Lva("FormulaByExampleManager:checkIfPreviewResultsEqualOtherColumn",this.OP.Gx);let yc=null,Nc=!0,zd=0;const fe=[mb.left];let Ud;try{for(;Tb.$$mn();){const P=Tb.$$cu();Ud&&Ud!==P.range.top&&(Nc=!1,yc=null);Ud=P.range.top;if(Nc)zd++;else if(fe.length===zd)return!1;if(!fe.includes(P.range.left)){if(!yc){const Da=
new Qb.Range(P.range.top,mb.left,P.range.bottom,mb.left,!0,!0),eb=va.find(bc=>N(bc.value.cell).equals(Da));yc=Df(eb).toString()}P.Qn.value.toString()===yc||"0"===yc&&""===P.Qn.value.toString()||fe.push(P.range.left)}}}catch(P){throw Error(`Error while iterating over cells: ${P}`);}finally{Tb&&Tb.dispose()}return!0}Uvf(va,mb,Tb,yc){return this.iNa.dGk(va,mb,void 0===Tb?null:Tb,this.Z2a,yc).then(Nc=>{ub.ULS.sendTraceTag(537161887,306,50,`FormulaByExampleManager.EvaluateFormulaAndUpdateModel: model update completed. result: ${Nc.status}.`);
switch(Nc.status){case 3:case 1:return 3===Nc.status&&Object(Sf.h)(va,"Preview shown, but only partially. some cells failed to evaluate."),Promise.resolve(Nc);case 2:return Promise.reject("Calc estimation or model update failed");default:return Promise.reject("Calc estimation failed")}})}s5i(va,mb,Tb,yc,Nc,zd,fe,Ud,P){const Da=this.lue;this.qme();const eb=Tb.suggestion;this.BL&&Object(Sf.f)("USERINPUTARRIVED",eb.flowId,yc);const bc=Gc.EwaSettings.isChangeGateEnabled("OfficeVSO:8215633_FixFBEFreezeFrameBigTable")?
eb.range.Fk(this.Lh.getLoadedRange()):eb.range;this.IBe(bc,!1);this.BH.hide();rf.a.xLg(()=>{var Pc,gd;this.BL&&Object(Sf.f)("PREVIEWREMOVEDWITHCSE",eb.flowId,yc);const nd={["flowId"]:eb.flowId,["originalFlowId"]:eb.yZ.flowId,["caller"]:mb.lLb,["displayTrigger"]:Nc,["formulaAnonymized"]:eb.anonymizedFormula,["originalFormulaAnonymized"]:eb.yZ.anonymizedFormula,["suggestionOutcome"]:mb.z2,["annotationRange"]:eb.range.toString(),["isFullyInViewport"]:this.Lh.SD(eb.range),["isCachedSuggestion"]:yc,["showFormulaClicked"]:Da,
["exampleCount"]:eb.BE,["originalExampleCount"]:eb.yZ.BE,["seenCount"]:Tb.tT,["previewCellsMetadata"]:va.zub,["previewShownDurations"]:this.BL?Object(Sf.e)(yc,eb.flowId):"none",["previewRemovedDurations"]:this.BL?Object(Sf.d)(yc,eb.flowId):"none",["isSuggestionOnTable"]:Object(Yf.b)(eb),["isNewRowPrediction"]:!Object(Yf.b)(eb)&&eb.TXb,["sheetId"]:eb.sheetId,["areAllHeadersLoaded"]:Object(Yf.b)(eb)?null===(Pc=eb.table.c9)||void 0===Pc?void 0:Pc.IsFullTableHeaders:"nonTableSuggestion",["tableRange"]:null===
(gd=eb.Gx)||void 0===gd?void 0:gd.toString(),["dataCulture"]:this.Lh.$.dataCultureTag,["UICulture"]:this.Lh.$.m9,["previewEvents"]:zd,["Hypotheses"]:{["areHypothesesEnabled"]:this.Lh.f2a(),["isNewColumnHeuristic"]:eb.uYj,["previewEqualsOtherColumn"]:fe.$ni},["formulaExplanation"]:{explanationSuccessful:Ud,explanationKey:eb.generatedFormula.explanationKey},["RowNumbering"]:P?{["isAcceptAsValues"]:P.isAcceptAsValues,["maxTooltipOpenDurationMS"]:P.maxTooltipOpenDurationMS,["isFurtherExplanationHyperlinkClicked"]:P.isFurtherExplanationHyperlinkClicked,
["disableApplyAsValue"]:P.disableApplyAsValue}:null,["IsPlugin"]:!1};ub.ULS.sendTraceTag(388780100,306,Gc.EwaSettings.isChangeGateEnabled("OfficeVSO:7896248_XLFBELogLevelImportant")?20:50,`FormulaByExampleManager.handlePreviewResult: FormulaByExample flow results: ${JSON.stringify(nd)}`);Gc.EwaSettings.isChangeGateEnabled("OfficeVSO:7705932_FBESendsOtelEvents")&&rf.a.sendOtelEvent(Kh);Object(Sf.b)(eb.flowId)},this.Lh.ya);ub.ULS.sendTraceTag(523842074,306,50,`FormulaByExampleManager.handlePreviewResult: User ${mb.z2} the formula via ${mb.lLb}`);
this.xra.$Rg(Tb,mb.z2,null===P||void 0===P?void 0:P.isAcceptAsValues);"ACCEPT"===mb.z2?(this.asd(Tb,va.bQb,null===P||void 0===P?void 0:P.isAcceptAsValues),this.Nw&&Gc.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaByExamplePluginCacheEnabled",!1)&&void this.Lh.pluginScheduler.eventEmitter().FBEOutcomeUpdate({flowId:eb.flowId,suggestionOutcome:{outcome:"ACCEPT"}}),Gc.EwaSettings.isChangeGateEnabled("OfficeVSO:7705932_FBESendsOtelEvents")&&rf.a.sendOtelEvent(ai)):"IGNORE"===mb.z2?
this.Nw&&Gc.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaByExamplePluginCacheEnabled",!1)&&void this.Lh.pluginScheduler.eventEmitter().FBEOutcomeUpdate({flowId:eb.flowId,suggestionOutcome:{outcome:"IGNORE"}}):"DECLINE"===mb.z2&&(this.Nw&&Gc.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaByExamplePluginCacheEnabled",!1)&&void this.Lh.pluginScheduler.eventEmitter().FBEOutcomeUpdate({flowId:eb.flowId,suggestionOutcome:{outcome:"DECLINE"}}),this.g9g++,3===this.g9g&&
Cg.Health.instance.recordQosError(Uh.a.SAi,[Sg.a.VAi],!0,!0,!1,!1,{jya:!0}));this.eDf.Dxh(mb.z2);this.Lh.vu(this.nia)}qme(){this.Z2a=!1;this.bD=null;this.lue=!1}asd(va,mb,Tb){const yc=va.suggestion;Tb?(Gc.EwaSettings.isChangeGateEnabled("OfficeVSO:8656119_FormulaByExample_RowNumbering_ApplyFormulaCSE")&&this.iNa.K9e(mb,null,yc.flowId),this.Lh.U5(null,yc.range,yc.originCell,yc.formula,!0).then(Nc=>{Nc=Nc.results.map(zd=>[this.u3h(zd)]);this.Lh.j7c({FirstRow:yc.range.top-1,FirstColumn:yc.range.left-
1,LastRow:yc.range.bottom-1,LastColumn:yc.range.right-1,SheetName:this.Lh.b_c.name,NamedObjectName:"Table"===yc.kind?yc.table.name:null},Nc);ub.ULS.sendTraceTag(507604995,306,50,`FormulaByExampleManager.applyFormulaSuggestionOnRange: applied values on table, range: ${yc.range}`)}).catch(Nc=>{ub.ULS.sendTraceTag(507585377,306,10,`FormulaByExampleManager.applySuggestionOnRange: failed to apply values on table, range: ${yc.range} error: ${Nc}`);this.Lh.lp()})):(Tb=Object(Ld.a)(new jd.a,{Text:yc.formula}),
this.Lh.setCell(Tb,yc.originCell,1,127,null,0,{range:yc.range,origin:yc.originCell},2),this.iNa.K9e(mb,yc.formula,yc.flowId),ub.ULS.sendTraceTag(537161883,306,50,`FormulaByExampleManager.applyFormulaSuggestionOnRange: applied formula on table, range: ${yc.range}`));this.t5a=(Nc,zd)=>{0===zd.zx&&(170==zd.Xl.operation.operationName?this.kae(va):Gc.EwaSettings.isChangeGateEnabled("OfficeVSO:7705932_FBESendsOtelEvents")&&rf.a.sendOtelEvent(fh),this.wFg())};this.Lh.qw(this.t5a)}u3h(va){if(!rf.a.OHc(va))throw Error("FormulaByExampleManager.convertEvalOnCloneResultToString: EvalOnCloneResult is not successful.");
return Df(va).toString()}UUg(va,mb){if(this.E8j)return{value:!1,reason:"Sessions shows plugin suggestions"};const Tb=va.suggestion;mb=this.ujj(Tb.flowId,mb.m_);return mb.value?va.state===Hh.b.decline?(this.BH.d_(va.suggestion.originCell,6,rh.a.ggh),ub.ULS.sendTraceTag(528758217,306,50,`FormulaByExampleManager.shouldShowPreview: user declined this suggestion before, not showing again. flowId: ${Tb.flowId}`),{value:!1,reason:"User declined this suggestion before."}):Tb.BE<Ph.a?(this.BH.d_(va.suggestion.originCell,
6,rh.a.Oeh),ub.ULS.sendTraceTag(528758215,306,50,`FormulaByExampleManager.shouldShowPreview: cached suggestion does not have enough examples. not showing preview. flowId: ${Tb.flowId}`),{value:!1,reason:"Cached suggestion does not have enough examples."}):va.state===Hh.b.ignore&&2<=va.tT?(this.BH.d_(va.suggestion.originCell,6,rh.a.fgh),ub.ULS.sendTraceTag(528758216,306,50,`FormulaByExampleManager.shouldShowPreview: user saw suggestion at least twice and ignored last time. not showing again. flowId: ${Tb.flowId}`),
{value:!1,reason:"User saw suggestion at least twice and ignored last time"}):Gc.EwaSettings.isChangeGateEnabled("OfficeVSO:7654591_FormulaByExampleForbiddenFormulas")&&this.xra.Mmj(Tb)?(ub.ULS.sendTraceTag(509195993,306,20,`FormulaByExampleManager.shouldShowPreview: suggestion is forbidden. not showing preview. flowId: ${Tb.flowId}, anonymizedFormula: ${Tb.anonymizedFormula}`),{value:!1,reason:"Suggestion is forbidden as it wasn't wanted before."}):Gc.EwaSettings.isChangeGateEnabled("OfficeVSO:7300192_FBETextCellsUnsupported")&&
this.gIf(Tb.range).some(yc=>this.Lh.g0d(yc.cell.to))?{value:!1,reason:"At least 1 cell in the loaded suggestion range is formatted as Text"}:Gc.EwaSettings.isChangeGateEnabled("OfficeVSO:7464540_FBENoneValueTypesUnsupported")&&0===Tb.Odi?{value:!1,reason:"suggestion's default value type cannot be none."}:Gc.EwaSettings.isChangeGateEnabled("OfficeVSO:7669810_ValidateRangeIsInsideTableUponShowingSuggestion")&&Object(Yf.b)(Tb)&&!Tb.table?{value:!1,reason:"table suggestion's table object is null."}:{value:!0}:
(this.BH.d_(va.suggestion.originCell,6,rh.a.Cch),{value:!1,reason:mb.reason})}IBe(va,mb){if(va)for(let yc=va.top;yc<=va.bottom;yc++)for(let Nc=va.left;Nc<=va.right;Nc++){var Tb=Qb.Range.yi(yc,Nc);if(Tb=this.Lh.yh(Tb))Tb.cell.Mue=mb&&!Tb.cell.hQ}}ujj(va,mb){if(this.bfe)return ub.ULS.sendTraceTag(528758218,306,50,`FormulaByExampleManager.shouldShowPreview: can't show preview again as preview already was shown for the current edit. flowId: ${va}`),{value:!1,reason:"Preview already shown for the latest edit."};
if(this.Z2a)return ub.ULS.sendTraceTag(527005664,306,50,`FormulaByExampleManager.shouldShowPreview: can't show preview for this suggestion as preview is already showing. flowId: ${va}`),{value:!1,reason:"Preview is already showing."};if(this.Hsd){if(504848446===mb&&!this.Lh.isEditing())return ub.ULS.sendTraceTag(507855E3,306,50,`FormulaByExampleManager.shouldShowPreview: AsYouType UX enabled. can't show preview for this suggestion as user is not editing. flowId: ${va}`),{value:!1,reason:"User is not editing."};
if(324156914===mb)return ub.ULS.sendTraceTag(507836041,306,50,`FormulaByExampleManager.shouldShowPreview: AsYouType UX enabled. preview shown only when editing, or by priming. flowId: ${va}`),{value:!1,reason:"After edit preview only handled by preview priming."}}else if(this.Lh.isEditing())return ub.ULS.sendTraceTag(524813027,306,50,`FormulaByExampleManager.shouldShowPreview: AsYouType UX disabled. can't show preview for this suggestion as user is editing. flowId: ${va}`),{value:!1,reason:"User is editing."};
return{value:!0}}gIf(va){const mb=[];this.ZFc=[];const Tb=this.Lh.Naa(va,this.Lh.activeItemName);for(const yc of Tb)mb.push(...this.Lh.Lga(va.Fk(yc.zj),yc)),this.ZFc.push(yc.Ti);return mb}}Object(Aa.a)(Vh,"FormulaByExampleManager",Ef.a,[731,2]);class Qf extends yd.a{constructor(va){super();this.$=va;this.sn()}create(){ub.ULS.sendTraceTag(528758214,0,50,"FormulaByExampleManagerFactory.Create: starting service creation flow.");const va=Object($f.d)(la.a.resolve(db.Qc,{va:this.gi})),mb=Object($f.d)(la.a.resolve(db.Pc,
{va:this.gi}));uf.TaskExtensions.$e(uf.TaskExtensions.Dq([mb,va],this.ya),()=>{ub.ULS.sendTraceTag(528758213,0,50,"FormulaByExampleManagerFactory.Create: augmentationLoopManager and calcManager creation tasks resolved.");zg.init(this.$);const Tb=new Vh(mb.result,zg.instance(),va.result);this.dl(this.$.qa.zh(453)||this.$.qa.Rh(453,Tb));ub.ULS.sendTraceTag(537161882,0,50,"FormulaByExampleManagerFactory.Create: FormulaByExampleManager initialized successfully")},this.ya)}static Ga(va){va.qa.Rh(454,new Qf(va))}}
Object(Aa.a)(Qf,"FormulaByExampleManagerFactory",yd.a,[]);var vh=a(236);class bg{constructor(va,mb,Tb){this.$=va;this.VCf=mb;this.ariaLiveNotifier=Tb;this.UWb=Gc.EwaSettings.isChangeGateEnabled("OfficeVSO:8501487_ValuePreviewDetectVolatile");this.ocj();this.editBox=Object(Ia.f)(this.$).Dh}get kD(){return Fa.getInstance(this.$)}get zoomManager(){this.gGa||(this.gGa=Object(zb.a)());return this.gGa}dispose(){this.hide()}show(va,mb,Tb,yc){yc=Object.assign({},mb,{sB:va,FDe:Tb,source:yc});if(!this.tQa(yc))return!1;
this.bra(yc)&&this.hide();this.ix=yc;this.kD.setResult(mb,va);this.V8();Tb&&this.G9i();return!0}hide(va){if(!this.ix||Object(Cc.b)(va)&&va!==this.ix.sB)return!1;va=this.ix.FDe;this.chi();va&&this.ymk();this.ix=void 0;return!0}tQa(va){return!this.ix||!ba(this.ix,va,this.UWb)}bra(va){return this.ix&&!K(this.ix,va)}G9i(){const va=this.ix.length;0!==va&&this.ix.sB.Xa.formatText(this.ix.index,va,{background:"rgba(202,234,216,0.6)"})}ymk(){const va=this.ix.sB;va.Xa.formatText(0,va.text.length,{background:!1});
va.n_(null)}V8(){let va;switch(this.ix.kind){case "Success":va={isLoaded:!0,value:this.ix.value,textColor:this.ix.color};break;case "Loading":va={isLoaded:!1,value:null,textColor:null};break;default:return}this.dcl();this.VCf.renderValuePreview(this.UA,this.Vac,va);this.u7j(va)}chi(){this.VCf.dismiss(this.UA)}ocj(){this.UA=document.createElement("div");this.Vac=document.createElement("div");this.Vac.style.position="absolute";this.Vac.style.visibility="hidden";this.$.domElement.appendChild(this.Vac)}dcl(){var va=
this.ix.sB;const mb=this.ix.index,Tb=this.ix.length;var yc=this.ix.source;let Nc;switch(yc.trigger){case "hover":Nc=va.Xa.getBounds(yc.index,1);break;case "shortcut":Nc=va.Xa.getBounds(yc.index);break;case "selection":yc=va.text.substring(mb,mb+Tb).indexOf("\n"),-1!==yc?Nc=va.Xa.getBounds(mb,yc):(yc=va.Xa.getBounds(mb),va=va.Xa.getBounds(mb,Tb),Nc={left:yc.left,top:yc.top,width:va.right-yc.left,height:va.height})}this.ccl(Nc)}ccl(va){const mb=new vh.a(this.Vac.style);mb.jE.left=this.l0c(va.left);
mb.jE.top=this.l0c(va.top);mb.jE.width=this.l0c(va.width);mb.jE.height=this.l0c(va.height);mb.J4()}l0c(va){var mb=this.ix.sB;mb=Object(Cc.b)(this.zoomManager)&&mb===this.editBox;return Y.HelperMethods.Li(mb?this.zoomManager.Zm(va):va)}u7j(va){var {isLoaded:mb,value:Tb}=va;mb?this.ariaLiveNotifier.readText(String.format(Tc.a.instance.sh(179),Tb)):this.ariaLiveNotifier.readText(Tc.a.instance.ia(866))}}Object(Aa.a)(bg,"FormulaAssistanceValuePreviewControl",null,[2]);class Wh{constructor(va){this.cache=
va}clearCache(){this.cache=void 0}}Object(Aa.a)(Wh,"Cacheable",null,[]);class Zg extends Wh{constructor(va,mb){super();this.$=va;this.callbacks=mb;this.d5a=(Tb,yc)=>{const Nc=this.da.Fp;if(!(0<(Nc.isEditing?Nc.Xa.selection:{index:0,length:0}).length))switch(yc.state){case 0:this.onHoverEnter(Tb,yc.event);break;case 1:this.onHoverLeave(Tb);break;case 2:this.zWj(Tb);break;default:return ub.ULS.shipAssertTag(521446489,0,!1,"FormulaAssistanceValuePreviewHandler.onHoverChange unxpected HoverState"),yc}};
this.Vkg=(Tb,yc)=>{const Nc=yc.selection;yc={source:"selection",text:yc.text,index:Nc.index,length:Nc.length};if(0<Nc.length)this.onSelectionChange(Tb,yc);else this.ube(Tb,yc)};this.da=Object(Ia.f)(this.$);this.editBox=this.da.cellTextEditBox;this.Kp(this.editBox);this.formulaBar=Object(Wa.a)(this.$);Object(Cc.b)(this.formulaBar)?this.Kp(this.formulaBar):Object(Wa.b)(this.$,Tb=>{this.formulaBar=Tb;this.Kp(this.formulaBar);ub.ULS.sendTraceTag(509870663,1,50,"FormulaAssistanceValuePreviewHandler: formulaBar async")})}get kD(){return Fa.getInstance(this.$)}dispose(){this.xo(this.editBox);
this.xo(this.formulaBar)}trigger(){const va=this.da.Fp,mb=va.Xa.selection;this.onSelectionChange(va,{source:"shortcut",text:va.text,index:mb.index,length:mb.length})}Kp(va){va.UIb(this.d5a);va.Lpd(this.Vkg)}xo(va){null===va||void 0===va?void 0:va.b6b(this.d5a);null===va||void 0===va?void 0:va.BVc(this.Vkg)}onHoverEnter(va,mb){var Tb=new Sys.UI.Point(mb.clientX,mb.clientY);{mb=va.Xa.dm;var yc=void 0,{x:Nc,y:zd}=Tb;yc=void 0===yc?document:yc;Tb=-1;let fe=null;void 0!==yc.caretPositionFromPoint?(yc=
yc.caretPositionFromPoint(Nc,zd),null!==yc&&(Tb=yc.offset,fe=yc.offsetNode)):void 0!==yc.caretRangeFromPoint&&(yc=yc.caretRangeFromPoint(Nc,zd),null!==yc&&(Tb=yc.startOffset,fe=yc.startContainer));null===fe||-1===Tb?(ub.ULS.sendTraceTag(521446491,0,15,"getEditorCaretPositionFromPoint - failed to get relevant range"),mb=-1):mb.contains(fe)?mb=E(mb,fe,Tb):(ub.ULS.sendTraceTag(521446490,0,15,"getEditorCaretPositionFromPoint - relavant node not inside root"),mb=-1)}if(-1!==mb)this.onSelectionChange(va,
{source:"hover",text:va.text,index:mb,length:0})}onHoverLeave(va){this.ube(va)}zWj(va){this.ube(va)}onSelectionChange(va,mb){this.Yse(mb)&&!va.sha&&(this.cache=mb,this.callbacks.rbe(va,{index:mb.index,length:mb.length,trigger:mb.source}),this.kD.trigger=mb.source)}ube(va,mb){this.uNk(mb)&&(this.clearCache(),this.callbacks.kca(va))}Yse(va){return!this.cache||!U(this.cache,va)}uNk(va){return this.cache&&va?"shortcut"!==this.cache.source||!U(this.cache,va):!0}}Object(Aa.a)(Zg,"FormulaAssistanceValuePreviewHandler",
Wh,[2]);class sa{constructor(va){this.$=va;this.d$b=0;this.S9a=!1;this.yza=null;this.im=()=>{this.da.cellTextEditBox.J2(this.im);this.xda()};this.da=Object(Ia.f)(va)}onShow(){this.S9a||(this.yza=performance.now())}onHide(){this.S9a||null===this.yza||(400<performance.now()-this.yza&&(this.d$b++,this.yza=null),2===this.d$b&&this.zze())}zze(){this.da.isEditing?this.da.cellTextEditBox.zX(this.im):this.xda()}xda(){this.$.oi(1684822464,-1,0,null);this.S9a=!0}}Object(Aa.a)(sa,"ValuePreviewSurveyHandler",
null,[]);class Vb{constructor(va,mb,Tb,yc){this.$=va;this.requester=mb;this.VRk=200;this.HIg=3E3;this.pha=Gc.EwaSettings.isChangeGateEnabled("OfficeVSO:8550405_ValuePreviewDismissOnScroll");this.rbe=(Nc,zd)=>{const fe=this;return xo(function*(){const Ud={text:Nc.text,index:zd.index,length:zd.length};void fe.szg(Ud,fe.Mtk(Ud),Nc,0===Ud.length,zd.trigger)})};this.kca=()=>{this.hide()};this.reset=()=>{this.handler.clearCache();this.requester.clearCache();this.hide()};this.XH=()=>{this.handler.clearCache();
this.requester.clearCache()};this.Vy=()=>{this.hide(this.da.Dh)};this.JPc=Nc=>{this.hide(Nc)};this.da=Object(Ia.f)(this.$);this.control=new bg(this.$,Tb,yc);this.handler=new Zg(this.$,{rbe:this.rbe,kca:this.kca});this.pda=new sa(this.$);this.Kp()}get kD(){return Fa.getInstance(this.$)}trigger(){this.handler.trigger()}dispose(){this.xo();this.handler.dispose();this.control.dispose()}Kp(){this.da.Dh.zX(this.reset);this.da.ha.add_activeCellChanged(this.reset);this.$.fa.mK(this.XH);this.pha&&(this.da.view.uz(this.Vy),
this.da.cellTextEditBox.x5e(this.JPc),Object(Wa.b)(this.$,va=>{va.x5e(this.JPc)}))}xo(){var va;this.da.Dh.J2(this.reset);this.da.ha.remove_activeCellChanged(this.reset);this.$.fa.nL(this.XH);this.pha&&(this.da.view.gy(this.Vy),this.da.cellTextEditBox.qGg(this.JPc),null===(va=Object(Wa.a)(this.$))||void 0===va?void 0:va.qGg(this.JPc))}szg(va,mb,Tb,yc,Nc){const zd=this;return xo(function*(){const fe=Object.assign({},va,{sB:Tb,m_c:yc,trigger:Nc});zd.Qr=fe;const Ud=yield mb;Object(Cc.c)(Ud)||zd.e_d(fe)&&
void zd.KRd(Ud)})}KRd(va){const mb=this;return xo(function*(){const Tb=mb.Qr.text,yc=mb.Qr.sB,Nc=mb.Qr.m_c,zd=mb.Qr.trigger;switch(va.kind){case "Failure":mb.kD.setResult(va,yc);mb.hide();break;case "Success":mb.show(va);break;case "Loading":mb.show(va);void mb.szg({text:Tb,index:va.index,length:va.length},va.promise,yc,Nc,zd);break;default:return va}})}Mtk(va){const mb=this.requester.Wle(va,this.HIg,!0);let Tb;const yc=new Promise(Nc=>{Tb=window.setTimeout(()=>{Nc(Object.assign({},va,{kind:"Loading",
promise:mb}))},this.VRk)});return Promise.race([mb,yc]).finally(()=>{window.clearTimeout(Tb)})}show(va){const mb=this.Qr.index,Tb=this.Qr.sB,yc=this.Qr.m_c,Nc=this.Qr.trigger;this.Qr=void 0;if(this.wrj(va)&&(va=this.control.show(Tb,va,yc,{trigger:Nc,index:mb}),!this.pha||va))this.pda.onShow()}hide(va){va=this.control.hide(va);this.Qr=void 0;if(!this.pha||va)this.pda.onHide()}e_d(va){var mb;if(mb=this.Qr)mb=this.Qr,mb=mb.text===va.text&&mb.index===va.index&&mb.length===va.length&&mb.sB===va.sB&&mb.m_c===
va.m_c;return mb}wrj(va){switch(va.kind){case "Success":return Object(Cc.b)(va.value)&&""!==va.value;case "Loading":return!0;default:return va}}}Object(Aa.a)(Vb,"FormulaAssistanceValuePreview",null,[727,2]);class Sc extends yd.a{constructor(va){super();this.$=va;this.sn()}static Ga(va){va.qa.Rh(497,new Sc(va))}create(){let va=this.$.qa.zh(496);va&&this.dl(va);const mb=jf.GetServiceTaskFactory.dk(this.$.qa,448,449,this.gi),Tb=Object($f.d)(la.a.resolve(db.Gc,{va:this.gi})),yc=Gc.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FixMigrate2AriaLiveNotifier",
!1)?Object($f.d)(la.a.resolve(db.l,{va:this.gi})):jf.GetServiceTaskFactory.dk(this.$.qa,211,212,this.gi),Nc=Object($f.d)(la.a.resolve(db.Jc));uf.TaskExtensions.$e(uf.TaskExtensions.Dq([mb,yc,Nc,Tb],this.ya),()=>{va=this.$.qa.zh(496);va||(va=new Vb(this.$,Nc.result,mb.result,yc.result),this.$.qa.Rh(496,va));this.dl(va)},this.ya,3)}}Object(Aa.a)(Sc,"FormulaAssistanceValuePreviewFactory",yd.a,[]);class ud extends Bg.a{constructor(va){super(va)}sw(){const va=jf.GetServiceTaskFactory.dk(this.$.qa,496,
497,this.gi);uf.TaskExtensions.$e(va,()=>{this.Zt([new tc(va.result)])},this.ya)}static Ga(va){Bg.a.jB(515,new ud(va))}}Object(Aa.a)(ud,"FormulaAssistanceValuePreviewCommandHandlerFactory",Bg.a,[]);String(ja);String(ta);window.___1712031274092_closurehack=ja;window.___1712031274092_closurehack=ta;De.a.hh(me.Ga);(()=>{De.a.hh(va=>{Pe.Ga(va)})})();(()=>{De.a.hh(va=>{ag.Ga(va)})})();(()=>{De.a.hh(va=>{Of.Ga(va)})})();(()=>{De.a.hh(va=>{Qf.Ga(va);mh.Ga(va)})})();(()=>{De.a.hh(va=>{Sc.Ga(va);db.Ic.Ma()||
ud.Ga(va)})})();String(X);String(ia);String(Ma);String(qa);String(Ha);String(ha);String(La);String(fa);String(ta);String(Ka);String(Ga);String(Na);String(cb);String(jb);String(Sa);String(bb);String(oa);String(ka);String(ya);String(Oa);String(za);window.___1712031311647_closurehack=X;window.___1712031311647_closurehack=ia;window.___1712031311647_closurehack=Ma;window.___1712031311647_closurehack=qa;window.___1712031311647_closurehack=Ha;window.___1712031311647_closurehack=ha;window.___1712031311647_closurehack=
La;window.___1712031311647_closurehack=fa;window.___1712031311647_closurehack=ta;window.___1712031311647_closurehack=Ka;window.___1712031311647_closurehack=Ga;window.___1712031311647_closurehack=Na;window.___1712031311647_closurehack=cb;window.___1712031311647_closurehack=jb;window.___1712031311647_closurehack=Sa;window.___1712031311647_closurehack=bb;window.___1712031311647_closurehack=oa;window.___1712031311647_closurehack=ka;window.___1712031311647_closurehack=ya;window.___1712031311647_closurehack=
Oa;window.___1712031311647_closurehack=za},977:function(y,m,a){a.d(m,"a",function(){return D});y=a(0);var c=a(192),b=a(23),e=a(25),k=a(73),d=a(46),u=a(157),n=a(494),v=a(121),f=a(963),w=a(1273);a(123);var r=a(71),t=a(217),l=a(64),x=a(216),A=a(36),z=a(43),F=a(15);class D{constructor(G,Q,O,J,H,N,L,Z,ba,K){this.$=G;this.Mj=Q;this.$o=O;this.nI=J;this.xk=H;this.Imj=L;this.indexedDB=Z;this.pluginScheduler=K;this.da=b.f(G);this.Nw=null===ba||void 0===ba?void 0:ba.COf("Legacy")}lp(){const G=A.a.nj(1,0,0,0,
0,0,"FormulaByExampleApplyAsValueFailed");z.a(this.da.$).lp(G)}j7c(G,Q){const O=new x.a(163,0,(J,H,N)=>{const L=this.$.oa.ta,Z=L.Za(0);Z.rangeToSet=G;Z.rangeValues=Q;return l.h(L,"SetRange",Z,(ba,K,E)=>{F.ULS.sendTraceTag(507585379,306,20,"FormulaByExampleServiceProxy.SetRange: the operation has succeeded");J(ba,K,E)},(ba,K,E)=>{F.ULS.sendTraceTag(507585378,306,10,"FormulaByExampleServiceProxy.SetRange: the operation has failed");H(ba,K,E)},N,this.$.oa.ta.Wh(),0)},65);this.$.userOperationManager.enqueueOperation(O,
null)}zX(...G){return this.da.Dh.zX(...G)}J2(...G){return this.da.Dh.J2(...G)}fM(...G){return this.da.Dh.fM(...G)}HN(...G){return this.da.Dh.HN(...G)}Ml(...G){return this.da.oh.Ml(...G)}tZi(G){return t.a(this.$,G,!1)}T8(...G){return this.da.DN.T8(...G)}g0b(...G){return this.da.DN.g0b(...G)}getLoadedRange(){return this.da.Wp}isEditing(){return this.da.isEditing}Naa(...G){return this.da.za.Naa(...G)}getActiveCell(){return this.da.ha.pa.activeCell}Sba(){return this.da.za.Sba}Ax(...G){return this.da.za.Ax(...G)}qy(...G){return this.da.za.qy(...G)}sz(...G){return this.da.za.sz(...G)}Vz(...G){return this.da.za.Vz(...G)}bfb(...G){return this.da.za.bfb(...G)}W5b(...G){return this.da.za.W5b(...G)}Pnc(...G){return this.da.Pnc(...G)}bJb(...G){this.wxk(Q=>
{Q.bJb(...G)})}yh(...G){return this.da.yh(...G)}Lga(...G){return this.da.Lga(...G)}SD(...G){return this.da.SD(...G)}setCell(...G){return this.da.setCell(...G)}Lva(...G){return this.da.pt(...G)}get jj(){return this.da.jj}QNa(...G){return this.da.za.QNa(...G)}evalFormula(...G){return this.Mj.evalFormula(...G)}U5(...G){return this.Mj.U5(...G)}iIc(...G){return this.Mj.iIc(...G)}g0d(...G){return this.Mj.g0d(...G)}e0a(...G){return this.Mj.e0a(...G)}lKh(...G){return this.Mj.v7e(...G)}extractReferences(...G){return this.Mj.extractReferences(...G)}Hna(...G){return this.Mj.Hna(...G)}Kpd(...G){return this.Mj.Kpd(...G)}QIb(...G){return this.Mj.QIb(...G)}Z5b(...G){return this.Mj.Z5b(...G)}localizeEnglishFormula(...G){return this.Mj.localizeEnglishFormula(...G)}oi(...G){return this.$.oi(...G)}qh(...G){return this.$.Ia.qh(...G)}Pp(...G){return this.$.Pp(...G)}sendBeaconTraceTag(...G){return this.$.sendBeaconTraceTag(...G)}vu(...G){return this.$.userOperationManager.vu(...G)}qw(...G){return this.$.userOperationManager.qw(...G)}get isFeedbackEnabled(){return this.$.isFeedbackEnabled}get ya(){return this.$.ya}get la(){return this.$.la}get activeItemName(){return this.da.$.activeItemName}get b_c(){var G;
return null===(G=this.$.sa)||void 0===G?void 0:G.la}get UC(){return this.$.fa.UC}get displayRtl(){return this.$.la.displayRtl}get KDe(){return this.$.workbookContext.WorkbookFileName}e1i(){return r.a(this.$)}static OHc(G){return Object(w.a)(G)}static sendOtelEvent(...G){return Object(f.c)(...G)}static ygh(...G){return v.a(...G)}static xLg(...G){Object(u.c)(...G)}static ELd(...G){return Object(n.a)(...G)}static Uhl(){return Object(u.f)()}static ABi(...G){return Object(d.H)(...G)}static o1(...G){return Object(k.d)(...G)}h2a(){return this.Imj}MLa(){return e.a.MLa(this.$)}g2a(){return e.a.g2a(this.$)}f2a(){return e.a.f2a()}static Vga(...G){return Object(c.a)(...G)}Sbj(){this.W9a=
this.nI.Taa()}VZk(...G){var Q;return null===(Q=this.W9a)||void 0===Q?void 0:Q.BKa(...G)}AJd(...G){return this.xk.AJd(...G)}waa(...G){return this.xk.waa(...G)}Bkj(){var G=[];return!!this.indexedDB&&this.indexedDB.zl(...G)}Ycj(...G){this.indexedDB.initialize(...G)}RNi(...G){return this.indexedDB.rxa(...G)}Cyk(...G){this.indexedDB.BBa(...G)}deleteDatabase(...G){return this.indexedDB.deleteDatabase(...G)}Kch(G,Q){this.$o.register(this.$o.k6().I8("FormulaByExample").H8(G).activateAnnotation(Q).build())}Hkj(){return!!this.$o}u7k(){this.$o.unregister(...["FormulaByExample"])}tYk(...G){this.$o.Qyb(...G)}m8(G,
Q){this.Nw&&(this.Nw.Tja(G,1,{errorMessage:Q}),this.Nw.Ujb(G))}wxk(G){this.$.qa.zi(254,G)}}Object(y.a)(D,"FormulaByExampleServiceProxy",null,[])}}]);

//# sourceMappingURL=https://artifacts.dev.azure.com/office/_apis/symbol/symsrv/EwaTS.edt.js.map/7dc7cde99451d3d9eaf81ce2db3e2913/EwaTS.edt.js.map