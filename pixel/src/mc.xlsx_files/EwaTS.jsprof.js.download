'use strict';(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[30],{716:function(y,m,a){a.r(m);y={};a.r(y);a.d(y,"JsSelfProfilerManager",function(){return L});m={};a.r(m);var c=a(0),b=a(15),e=a(95),k=a(548),d=a(6),u=a(144),n=a(10),v=a(58),f=a(54),w=a(1),r=a(61);class t{constructor(ba){this.aVk=ba}getCustomProperties(ba){const K=new Map;if(ba.hasOwnProperty("startTimeInMs")&&ba.hasOwnProperty("totalExecutionTimeInMs")){const E=ba.startTimeInMs;ba=this.aVk.retrieveSlowActionsBetweenTimeRange(E,
E+ba.totalExecutionTimeInMs);K.set("actions",r.a.Di(ba))}return K}}Object(c.a)(t,"CallTreeCustomPropertiesRetriever",null,[407]);class l{constructor(ba){this.rxk=ba}getCustomProperties(ba){const K=new Map;if(ba.hasOwnProperty("startTimeInMs")&&ba.hasOwnProperty("totalExecutionTimeInMs")){const E=ba.startTimeInMs;ba=this.rxk.retrieveRumShepherdEventsBetweenTimeRange(E,E+ba.totalExecutionTimeInMs);K.set("rumShepherdData",JSON.stringify(ba))}return K}}Object(c.a)(l,"CallTreeRumShepherdCustomPropertiesRetriever",
null,[407]);class x{constructor(){this.customProperties=new Map}addCustomProperty(ba,K){this.customProperties.set(ba,K)}getCustomProperties(){return this.customProperties}}Object(c.a)(x,"CustomPropertiesRetriever",null,[406]);class A{isFeatureEnabled(ba,K){return w.EwaSettings.getBooleanFeatureGate(ba,K)}}Object(c.a)(A,"ExcelFeatureChecker",null,[405]);class z{isProfilingEnabled(){return!0}}Object(c.a)(z,"ExcelProfilingFeatureChecker",null,[238]);class F{constructor(ba,K){this.j1j=ba;this.l1j=K}onProfilerEvent(ba){switch(ba.eventId){case 1:this.j1j(w.EwaSettings.isChangeGateEnabled("OfficeVSO:6144046_KeepOldCollectedActions"));
break;case 0:this.l1j();break;default:b.ULS.sendTraceTag(537155529,0,15,`JSCPUIJSCPUProfilerObserver.OnProfilerEvent: got unhandled profilerEventId ${ba.eventId}`)}}}Object(c.a)(F,"JSCPUProfilerObserver",null,[237]);class D{constructor(){this.samplingIntervalInMs=0;this.idleIntervalInMs=this.profilingIntervalInMs=this.maximumNumberOfSamplesToTake=null}}Object(c.a)(D,"JSCPUProfilerInitOptions",null,[]);class G{constructor(){this.profilerTraceLoggingChunkSize=this.shouldLogRawProfilerTrace=this.shouldRecordFrameCounts=
this.shouldMakeSerializedCallTreesFullyReconstructible=this.shouldKeepQueryParamsInResourceURLs=this.shouldProcessProfileCapturedWhileUserIsIdle=this.shouldSendProfilesForDeobfuscationImmediately=this.canUseMultipleWebWorkers=this.shouldUseInMemoryLogger=this.featureEnabledChecker=this.deObfuscationRequestQueryParamsRetriever=this.deObfuscationRequestBodyPropertiesRetriever=this.durationThresholdInMsToLogOperationData=this.shouldAlwaysLogOperationsData=this.shouldUseSendBeaconForSendingCallTrees=
this.shouldSendAllCallTreesFromProfileInASingleRequest=this.frameTotalExecutionTimeFilteringThresholdInMs=this.shouldCompressSerializedCallTrees=this.shouldRecordExpandedTimeStamps=this.profilerTraceProcessingWebWorkerSourceURL=this.useMainEventLoopForProfilerTraceProcessing=this.shouldKeepSamplesOutsideOfProfilingInterval=this.shouldProfilingStartInAHiddenDocument=this.shouldProcessProfileCapturedInAHiddenDocument=this.callTreeFilteringThresholdInMs=this.deObfuscationEndpoint=this.ulsInstance=this.buildVersion=
this.appName=null}}Object(c.a)(G,"JSCPUProfilingPackageInitOptions",null,[]);var Q=a(44);class O{filter(ba){var K,E,U;const X=!Q.a.instance.TTSI||(null===(K=ba.serializedFrames[0])||void 0===K?void 0:K.startTimeInMs)<Q.a.instance.v6k;K=(null===(E=ba.propertyBag)||void 0===E?void 0:E.actions)&&"[]"!==ba.propertyBag.actions;ba=0<(null===(U=ba.serializedFrames[0])||void 0===U?void 0:U.totalExecutionTimeInMs);return X&&ba||K}}Object(c.a)(O,"CallTreeCustomFilterer",null,[236]);var J=a(5),H=a(92),N=a(9);
Object(H.b)(J.Hd,{rk:"singleton"})(()=>xo(function*(){const [ba,K]=yield Promise.all([H.a.resolve(J.Ob),H.a.resolve(J.Gd),H.a.resolve(J.oe)]);return new L(ba,K,0)}));Object(H.b)(J.Id,{rk:"singleton"})(()=>new L(N.a.k9a,null,1));class L{constructor(ba,K,E){this.xLa=this.bZg=this.Tfe=this.Jub=this.Ufe=this.yzg=this.Azg=null;this.vck=new Set([1,0]);b.ULS.sendTraceTag(537155528,0,50,"JsSelfProfilerManager.Ctor: creating new JsSelfProfilerManager");this.$=ba;this.xLa=K;this.qej();this.pej();this.Lvj=w.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.JsProfilingSampleIntervalInMs",
16);this.profilingIntervalInMs=w.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.JsProfilingWindowDurationInMs",1E4);this.dkf=w.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.JsProfilingIdleIntervalInMs",3E5);b.ULS.sendTraceTag(507593507,0,50,`JsSelfProfilerManager: starting profiler: ${E.toString()}`);switch(E){case 1:this.QWk(w.EwaSettings.getIntFeatureGate("Microsoft.Office.ExcelOnline.JsProfilerOnBootMaximumProfilingDurationMs",6E4));this.$.fa.rv(()=>{this.KXk()});break;case 0:this.V4j=
w.EwaSettings.getStringFeatureGate("Microsoft.Office.Excel.ProfilerName",""),this.vWk()}}dispose(){b.ULS.sendTraceTag(537155527,0,50,"JsSelfProfilerManager.Dispose");e.a.gh(this.bZg);this.Tfe=this.$=null;this.Ufe.clear();this.Jub.clear()}vWk(){const ba=Math.random()*this.dkf;b.ULS.sendTraceTag(537155526,0,50,`JsSelfProfilerManager.Ctor: starting ContinuousSessionProfiler in: ${ba}`);this.bZg=v.a.instance.create(()=>{this.aLf("ExcelOnlineContinuousSessionProfiler",2).start()},ba,f.a.nLk,!0)}QWk(ba){ba=
void 0===ba?1E4:ba;b.ULS.sendTraceTag(537155524,0,50,"JsSelfProfilerManager.StartManualProfiler: Starting a new profiler");this.aLf("BootProfiler",0,ba).start()}KXk(){var ba=this.GLf("BootProfiler");ba&&ba.stop()}zzg(ba){return this.Jub.has(ba)}createProfiler(ba,K,E,U,X,ia){b.ULS.sendTraceTag(537155521,0,50,"JsSelfProfilerManager.CreateProfiler: Creating a new profiler");const Ma=new D;Ma.samplingIntervalInMs=K;Ma.maximumNumberOfSamplesToTake=E;Ma.idleIntervalInMs=U;Ma.profilingIntervalInMs=X;return this.d$h(ba,
ia,Ma)}pej(){const ba=new z,K=new G;K.ulsInstance=new k.a;K.deObfuscationEndpoint="ProfilerReporting.ashx";K.shouldCompressSerializedCallTrees=!1;K.shouldKeepSamplesOutsideOfProfilingInterval=!1;K.shouldSendAllCallTreesFromProfileInASingleRequest=!w.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.ShouldSendEachCallTreeIndividuallyFromProfile",!1);K.shouldUseSendBeaconForSendingCallTrees=w.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.ShouldUseSendBeaconForSendingCallTrees",!1);
K.callTreeFilteringThresholdInMs=w.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.JsProfilerCallTreeFilteringThresholdInMs",-1);K.frameTotalExecutionTimeFilteringThresholdInMs=w.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.JsProfilerFrameTotalExecutionTimeFilteringThresholdInMs",-1);K.shouldRecordFrameCounts=!0;K.deObfuscationRequestQueryParamsRetriever=this.N6h();K.deObfuscationRequestBodyPropertiesRetriever=this.M6h();K.featureEnabledChecker=new A;K.useMainEventLoopForProfilerTraceProcessing=
!1;K.profilerTraceProcessingWebWorkerSourceURL=this.$.ua.JSProfilerProcessingWebWorkerJsScriptUrl;K.shouldProcessProfileCapturedWhileUserIsIdle=w.EwaSettings.isChangeGateEnabled("OfficeVSO:6144063_ShouldProcessProfileCapturedWhileUserIsIdle");w.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.ShouldLogRawProfilerTrace",!1)&&(K.shouldLogRawProfilerTrace=!0,K.profilerTraceLoggingChunkSize=w.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.ProfilerTraceLoggingChunkSize",30));this.Tfe=this.Azg.retrievePackage(ba,
K).retrieveProfilerFactory()}N6h(){const ba=new x;ba.addCustomProperty(n.a.mAg,d.AFrameworkApplication.userType);ba.addCustomProperty(d.AFrameworkApplication.DRa,d.AFrameworkApplication.userSessionId);ba.addCustomProperty(n.a.v8d,this.$.ua.SkipAuthentication?n.a.fgg:null);ba.addCustomProperty(n.a.sge,this.$.ua.MachineCluster);return ba}M6h(){const ba=new x;ba.addCustomProperty("appName","Excel");ba.addCustomProperty("buildVersion",d.AFrameworkApplication.buildVersion);ba.addCustomProperty("shouldUseSourceMaps",
"true");ba.addCustomProperty("shouldFilterSensitiveResources","true");ba.addCustomProperty("shouldUseJSSelfProfilerSpecificDeobfuscator","false");return ba}d$h(ba,K,E){const U=new x;U.addCustomProperty("ProfilerName",ba);this.yzg.set(ba,U);K=this.Tfe.createProfiler(K,E,U);this.Jub.set(ba,K);return w.EwaSettings.u2a()?w.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.AddRumShepherdDataToCallTree",!1)?this.W5h(K):K:this.k8h(ba,K)}k8h(ba,K){ba=this.l8h(ba);K.subscribeProfilerObserver(ba,this.vck);
ba=new O;K.subscribeCallTreeCustomFilterer(ba);return K}W5h(ba){var K=w.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CollectRumShepherdComponentDataOnly",!1);K=rumShepherd.RumShepherdFactoryGlobal.createAndInitRumShepherdDataRetriever(!K);if(!K)return b.ULS.sendTraceTag(507368864,0,15,"JsSelfProfilerManager.createProfilerWithOptions.createBootProfiler.createAndInitRumShepherdDataRetriever returned null"),ba;K=new l(K);ba.subscribeCallTreeCustomPropertiesRetriever(K);return ba}GLf(ba){return this.zzg(ba)?
this.Jub.get(ba):(b.ULS.shipAssertTag(537155520,0,!1,`JsSelfProfilerManager.GetProfiler: Profiler with such name (${ba}) does not exist`),null)}aLf(ba,K,E){E=void 0===E?null:E;ba=this.V4j||ba;if(this.zzg(ba))return this.GLf(ba);const U=this.Lvj;return this.createProfiler(ba,U,null!=E&&0<U?E/U:2E6,2===K?this.dkf:null,0===K?null:this.profilingIntervalInMs,K)}l8h(ba){var K=this.xLa;if(K){const E=K.Anf();if(E){K=this.Jub.get(ba);const U=new t(E);K.subscribeCallTreeCustomPropertiesRetriever(U);K=new F(X=>
{E.startCollectingSlowActions(X)},Object(u.a)(E,E.stopCollectingSlowActions,"stopCollectingSlowActions"));this.Ufe.set(ba,K);return K}b.ULS.sendTraceTag(537155491,0,15,"JsSelfProfilerManager.CreateInteractivityTrackerObserver: CreateSlowActionsRetriever returned null");return null}b.ULS.sendTraceTag(537155490,0,15,"JsSelfProfilerManager.CreateInteractivityTrackerObserver: call to InteractivityTracker returned null");return null}qej(){this.Azg=officeOnlineCpuProfiling.getJSCPUProfilingPackageRetriever();
this.yzg=new Map;this.Ufe=new Map;this.Jub=new Map}}Object(c.a)(L,"JsSelfProfilerManager",null,[206,2]);var Z=a(323);Object(H.b)(J.oe)(()=>xo(function*(){yield Object(Z.b)("officeOnlineCpuProfiling",{va:0});return officeOnlineCpuProfiling}));window.jsprof=!0;String(y);String(m);window.___1712031311670_closurehack=y;window.___1712031311670_closurehack=m}}]);

//# sourceMappingURL=https://artifacts.dev.azure.com/office/_apis/symbol/symsrv/EwaTS.jsprof.js.map/d533dd047efa9471f43c25037d3044fe/EwaTS.jsprof.js.map